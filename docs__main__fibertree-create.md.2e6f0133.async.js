(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[16],{"0/Pd":function(e,n,t){e.exports=t.p+"static/unitofwork7.3.26f2cb3d.png"},"6QJa":function(e,n,t){e.exports=t.p+"static/unitofwork4.2.26eb5b9b.png"},"9OPI":function(e,n,t){e.exports=t.p+"static/unitofwork0.8ee66bc1.png"},EHsg:function(e,n,t){e.exports=t.p+"static/fibertree-beforecommit.a32107ef.png"},FJ8A:function(e,n,t){e.exports=t.p+"static/unitofwork6.7845b676.png"},Fbj6:function(e,n,t){e.exports=t.p+"static/unitofwork7.2.4d91e021.png"},IBpY:function(e,n,t){e.exports=t.p+"static/unitofwork7.441559c7.png"},IXZb:function(e,n,t){e.exports=t.p+"static/unitofwork2.42a31b2c.png"},L5z8:function(e,n,t){e.exports=t.p+"static/initial-status.72b1581a.png"},PAPi:function(e,n,t){e.exports=t.p+"static/unitofwork7.1.059be157.png"},UQ7S:function(e,n,t){e.exports=t.p+"static/unitofwork1.5ae39fbf.png"},Wqxf:function(e,n,t){e.exports=t.p+"static/status-freshstack.057d7bdf.png"},czq0:function(e,n,t){e.exports=t.p+"static/unitofwork7.4.9b962004.png"},eUcU:function(e,n,t){e.exports=t.p+"static/unitofwork4.1.7a55b0bb.png"},j4Tx:function(e,n,t){"use strict";t.r(n);var l=t("q1tI"),r=t.n(l),a=t("dEAq"),o=t("H1Ra"),c=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("h1",{id:"fiber-\u6811\u6784\u9020\u521d\u6b21\u521b\u5efa"},r.a.createElement(a["AnchorLink"],{to:"#fiber-\u6811\u6784\u9020\u521d\u6b21\u521b\u5efa","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"fiber \u6811\u6784\u9020(\u521d\u6b21\u521b\u5efa)"),r.a.createElement("p",null,"\u672c\u8282\u7684\u5185\u5bb9\u5b8c\u5168\u5efa\u7acb\u5728\u524d\u6587",r.a.createElement(a["Link"],{to:"./fibertree-prepare"},"fiber \u6811\u6784\u9020(\u57fa\u7840\u51c6\u5907)"),"\u4e2d\u4ecb\u7ecd\u7684\u57fa\u7840\u77e5\u8bc6\u4e4b\u4e0a, \u5176\u4e2d\u603b\u7ed3\u4e86",r.a.createElement("code",null,"fiber \u6811\u6784\u9020"),"\u7684 2 \u79cd\u60c5\u51b5:"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u521d\u6b21\u521b\u5efa: \u5728",r.a.createElement("code",null,"React"),"\u5e94\u7528\u9996\u6b21\u542f\u52a8\u65f6, \u754c\u9762\u8fd8\u6ca1\u6709\u6e32\u67d3, \u6b64\u65f6\u5e76\u4e0d\u4f1a\u8fdb\u5165\u5bf9\u6bd4\u8fc7\u7a0b, \u76f8\u5f53\u4e8e\u76f4\u63a5\u6784\u9020\u4e00\u68f5\u5168\u65b0\u7684\u6811."),r.a.createElement("li",null,"\u5bf9\u6bd4\u66f4\u65b0: ",r.a.createElement("code",null,"React"),"\u5e94\u7528\u542f\u52a8\u540e, \u754c\u9762\u5df2\u7ecf\u6e32\u67d3. \u5982\u679c\u518d\u6b21\u53d1\u751f\u66f4\u65b0, \u521b\u5efa",r.a.createElement("code",null,"\u65b0fiber"),"\u4e4b\u524d\u9700\u8981\u548c",r.a.createElement("code",null,"\u65e7fiber"),"\u8fdb\u884c\u5bf9\u6bd4. \u6700\u540e\u6784\u9020\u7684 fiber \u6811\u6709\u53ef\u80fd\u662f\u5168\u65b0\u7684, \u4e5f\u53ef\u80fd\u662f\u90e8\u5206\u66f4\u65b0\u7684.")),r.a.createElement("p",null,"\u672c\u8282\u53ea\u8ba8\u8bba",r.a.createElement("code",null,"\u521d\u6b21\u521b\u5efa"),"\u8fd9\u79cd\u60c5\u51b5, \u4e3a\u4e86\u63a7\u5236\u7bc7\u5e45(\u672c\u8282\u76f4\u51fb\u6838\u5fc3\u6e90\u7801, \u4e0d\u518d\u4ecb\u7ecd\u57fa\u7840\u77e5\u8bc6, \u53ef\u53c2\u7167",r.a.createElement(a["Link"],{to:"./fibertree-prepare"},"fiber \u6811\u6784\u9020(\u57fa\u7840\u51c6\u5907)"),")\u5e76\u7a81\u51fa",r.a.createElement("code",null,"fiber \u6811\u6784\u9020"),"\u8fc7\u7a0b, \u540e\u6587\u4f1a\u5728",r.a.createElement("code",null,"Legacy"),"\u6a21\u5f0f\u4e0b\u8fdb\u884c\u5206\u6790(\u56e0\u4e3a\u53ea\u8ba8\u8bba",r.a.createElement("code",null,"fiber\u6811\u6784\u9020"),"\u539f\u7406, ",r.a.createElement("code",null,"Concurrent"),"\u6a21\u5f0f\u4e0e",r.a.createElement("code",null,"Legacy"),"\u6ca1\u6709\u533a\u522b)."),r.a.createElement("p",null,"\u672c\u8282\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b(",r.a.createElement(a["Link"],{to:"https://codesandbox.io/s/busy-jang-b26hy?file=/src/App.js"},"codesandbox \u5730\u5740"),"):"),r.a.createElement(o["a"],{code:'class App extends React.Component {\n  componentDidMount() {\n    console.log(`App Mount`);\n    console.log(`App \u7ec4\u4ef6\u5bf9\u5e94\u7684fiber\u8282\u70b9: `, this._reactInternals);\n  }\n  render() {\n    return (\n      <div className="app">\n        <header>header</header>\n        <Content />\n      </div>\n    );\n  }\n}\n\nclass Content extends React.Component {\n  componentDidMount() {\n    console.log(`Content Mount`);\n    console.log(`Content \u7ec4\u4ef6\u5bf9\u5e94\u7684fiber\u8282\u70b9: `, this._reactInternals);\n  }\n  render() {\n    return (\n      <React.Fragment>\n        <p>1</p>\n        <p>2</p>\n      </React.Fragment>\n    );\n  }\n}\nexport default App;',lang:"js"}),r.a.createElement("h2",{id:"\u542f\u52a8\u9636\u6bb5"},r.a.createElement(a["AnchorLink"],{to:"#\u542f\u52a8\u9636\u6bb5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u542f\u52a8\u9636\u6bb5"),r.a.createElement("p",null,"\u5728\u524d\u6587",r.a.createElement(a["Link"],{to:"./bootstrap"},"React \u5e94\u7528\u7684\u542f\u52a8\u8fc7\u7a0b"),"\u4e2d\u5206\u6790\u4e86 3 \u79cd\u542f\u52a8\u6a21\u5f0f\u7684\u5dee\u5f02, \u5728\u8fdb\u5165",r.a.createElement("code",null,"react-reconciler"),"\u5305\u4e4b\u524d(\u8c03\u7528",r.a.createElement("code",null,"updateContainer"),"\u4e4b\u524d), \u5185\u5b58\u72b6\u6001\u56fe\u5982\u4e0b:"),r.a.createElement("p",null,r.a.createElement("img",{src:t("pQdL"),alt:""})),r.a.createElement("p",null,"\u6839\u636e\u8fd9\u4e2a\u7ed3\u6784, \u53ef\u4ee5\u5728\u63a7\u5236\u53f0\u4e2d\u6253\u51fa\u5f53\u524d\u9875\u9762\u5bf9\u5e94\u7684",r.a.createElement("code",null,"fiber"),"\u6811(\u7528\u4e8e\u89c2\u5bdf\u5176\u7ed3\u6784):"),r.a.createElement(o["a"],{code:"document.getElementById('root')._reactRootContainer._internalRoot.current;",lang:"js"}),r.a.createElement("p",null,"\u7136\u540e\u8fdb\u5165",r.a.createElement("code",null,"react-reconciler"),"\u5305\u8c03\u7528",r.a.createElement(a["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberReconciler.old.js#L250-L321"},"updateContainer \u51fd\u6570"),":"),r.a.createElement(o["a"],{code:"// ... \u7701\u7565\u4e86\u90e8\u5206\u4ee3\u7801\nexport function updateContainer(\n  element: ReactNodeList,\n  container: OpaqueRoot,\n  parentComponent: ?React$Component<any, any>,\n  callback: ?Function,\n): Lane {\n  // \u83b7\u53d6\u5f53\u524d\u65f6\u95f4\u6233\n  const current = container.current;\n  const eventTime = requestEventTime();\n  // 1. \u521b\u5efa\u4e00\u4e2a\u4f18\u5148\u7ea7\u53d8\u91cf(\u8f66\u9053\u6a21\u578b)\n  const lane = requestUpdateLane(current);\n\n  // 2. \u6839\u636e\u8f66\u9053\u4f18\u5148\u7ea7, \u521b\u5efaupdate\u5bf9\u8c61, \u5e76\u52a0\u5165fiber.updateQueue.pending\u961f\u5217\n  const update = createUpdate(eventTime, lane);\n  update.payload = { element };\n  callback = callback === undefined ? null : callback;\n  if (callback !== null) {\n    update.callback = callback;\n  }\n  enqueueUpdate(current, update);\n\n  // 3. \u8fdb\u5165reconciler\u8fd0\u4f5c\u6d41\u7a0b\u4e2d\u7684`\u8f93\u5165`\u73af\u8282\n  scheduleUpdateOnFiber(current, lane, eventTime);\n  return lane;\n}",lang:"js"}),r.a.createElement("p",null,"\u7531\u4e8e",r.a.createElement("code",null,"update"),"\u5bf9\u8c61\u7684\u521b\u5efa, \u6b64\u65f6\u7684\u5185\u5b58\u7ed3\u6784\u5982\u4e0b:"),r.a.createElement("p",null,r.a.createElement("img",{src:t("qW7x"),alt:""})),r.a.createElement("p",null,"\u6ce8\u610f: \u6700\u521d\u7684",r.a.createElement("code",null,"ReactElement"),"\u5bf9\u8c61",r.a.createElement("code",null,"<App/>"),"\u88ab\u6302\u8f7d\u5230",r.a.createElement("code",null,"HostRootFiber.updateQueue.shared.pending.payload.element"),"\u4e2d, \u540e\u6587",r.a.createElement("code",null,"fiber\u6811\u6784\u9020"),"\u8fc7\u7a0b\u4e2d\u4f1a\u518d\u6b21\u53d8\u52a8."),r.a.createElement("h2",{id:"\u6784\u9020\u9636\u6bb5"},r.a.createElement(a["AnchorLink"],{to:"#\u6784\u9020\u9636\u6bb5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6784\u9020\u9636\u6bb5"),r.a.createElement("p",null,"\u4e3a\u4e86\u7a81\u51fa\u6784\u9020\u8fc7\u7a0b,\u6392\u9664\u5e72\u6270,\u5148\u628a\u5185\u5b58\u72b6\u6001\u56fe\u4e2d\u7684",r.a.createElement("code",null,"FiberRoot"),"\u548c",r.a.createElement("code",null,"HostRootFiber"),"\u5355\u72ec\u63d0\u51fa\u6765(\u540e\u6587\u5728\u6b64\u57fa\u7840\u4e0a\u6dfb\u52a0):"),r.a.createElement("p",null,r.a.createElement("img",{src:t("L5z8"),alt:""})),r.a.createElement("p",null,"\u5728",r.a.createElement(a["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberWorkLoop.old.js#L517-L619"},"scheduleUpdateOnFiber \u51fd\u6570"),"\u4e2d:"),r.a.createElement(o["a"],{code:"// ...\u7701\u7565\u90e8\u5206\u4ee3\u7801\nexport function scheduleUpdateOnFiber(\n  fiber: Fiber,\n  lane: Lane,\n  eventTime: number,\n) {\n  // \u6807\u8bb0\u4f18\u5148\u7ea7\n  const root = markUpdateLaneFromFiberToRoot(fiber, lane);\n  if (lane === SyncLane) {\n    if (\n      (executionContext & LegacyUnbatchedContext) !== NoContext &&\n      (executionContext & (RenderContext | CommitContext)) === NoContext\n    ) {\n      // \u9996\u6b21\u6e32\u67d3, \u76f4\u63a5\u8fdb\u884c`fiber\u6784\u9020`\n      performSyncWorkOnRoot(root);\n    }\n    // ...\n  }\n}",lang:"js"}),r.a.createElement("p",null,"\u53ef\u4ee5\u770b\u5230, \u5728",r.a.createElement("code",null,"Legacy"),"\u6a21\u5f0f\u4e0b\u4e14\u9996\u6b21\u6e32\u67d3\u65f6, \u6709 2 \u4e2a\u51fd\u6570",r.a.createElement(a["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberWorkLoop.old.js#L625-L667"},"markUpdateLaneFromFiberToRoot"),"\u548c",r.a.createElement(a["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberWorkLoop.old.js#L965-L1045"},"performSyncWorkOnRoot"),"."),r.a.createElement("p",null,"\u5176\u4e2d",r.a.createElement("code",null,"markUpdateLaneFromFiberToRoot(fiber, lane)"),"\u51fd\u6570\u5728",r.a.createElement("code",null,"fiber\u6811\u6784\u9020(\u5bf9\u6bd4\u66f4\u65b0)"),"\u4e2d\u624d\u4f1a\u53d1\u6325\u4f5c\u7528, \u56e0\u4e3a\u5728",r.a.createElement("code",null,"\u521d\u6b21\u521b\u5efa"),"\u65f6\u5e76\u6ca1\u6709\u4e0e\u5f53\u524d\u9875\u9762\u6240\u5bf9\u5e94\u7684",r.a.createElement("code",null,"fiber\u6811"),", \u6240\u4ee5\u6838\u5fc3\u4ee3\u7801\u5e76\u6ca1\u6709\u6267\u884c, \u6700\u540e\u76f4\u63a5\u8fd4\u56de\u4e86",r.a.createElement("code",null,"FiberRoot"),"\u5bf9\u8c61."),r.a.createElement("p",null,r.a.createElement("code",null,"performSyncWorkOnRoot"),"\u770b\u8d77\u6765\u6e90\u7801\u5f88\u591a, ",r.a.createElement("code",null,"\u521d\u6b21\u521b\u5efa"),"\u4e2d\u771f\u6b63\u7528\u5230\u7684\u5c31 2 \u4e2a\u51fd\u6570:"),r.a.createElement(o["a"],{code:"function performSyncWorkOnRoot(root) {\n  let lanes;\n  let exitStatus;\n  if (\n    root === workInProgressRoot &&\n    includesSomeLane(root.expiredLanes, workInProgressRootRenderLanes)\n  ) {\n    // \u521d\u6b21\u6784\u9020\u65f6(\u56e0\u4e3aroot=fiberRoot, workInProgressRoot=null), \u6240\u4ee5\u4e0d\u4f1a\u8fdb\u5165\n  } else {\n    // 1. \u83b7\u53d6\u672c\u6b21render\u7684\u4f18\u5148\u7ea7, \u521d\u6b21\u6784\u9020\u8fd4\u56de NoLanes\n    lanes = getNextLanes(root, NoLanes);\n    // 2. \u4eceroot\u8282\u70b9\u5f00\u59cb, \u81f3\u4e0a\u800c\u4e0b\u66f4\u65b0\n    exitStatus = renderRootSync(root, lanes);\n  }\n\n  // \u5c06\u6700\u65b0\u7684fiber\u6811\u6302\u8f7d\u5230root.finishedWork\u8282\u70b9\u4e0a\n  const finishedWork: Fiber = (root.current.alternate: any);\n  root.finishedWork = finishedWork;\n  root.finishedLanes = lanes;\n  // \u8fdb\u5165commit\u9636\u6bb5\n  commitRoot(root);\n\n  // ...\u540e\u9762\u7684\u5185\u5bb9\u672c\u8282\u4e0d\u8ba8\u8bba\n}",lang:"js"}),r.a.createElement("p",null,"\u5176\u4e2d",r.a.createElement("code",null,"getNextLanes"),"\u8fd4\u56de\u672c\u6b21 render \u7684\u6e32\u67d3\u4f18\u5148\u7ea7(\u8be6\u89c1",r.a.createElement(a["AnchorLink"],{to:"./fibertree-prepare#%E4%BC%98%E5%85%88%E7%BA%A7"},"fiber \u6811\u6784\u9020(\u57fa\u7840\u51c6\u5907)"),"\u4e2d",r.a.createElement("code",null,"\u4f18\u5148\u7ea7"),"\u76f8\u5173\u5c0f\u8282)"),r.a.createElement("p",null,r.a.createElement(a["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberWorkLoop.old.js#L1490-L1553"},"renderRootSync")),r.a.createElement(o["a"],{code:"function renderRootSync(root: FiberRoot, lanes: Lanes) {\n  const prevExecutionContext = executionContext;\n  executionContext |= RenderContext;\n  // \u5982\u679cfiberRoot\u53d8\u52a8, \u6216\u8005update.lane\u53d8\u52a8, \u90fd\u4f1a\u5237\u65b0\u6808\u5e27, \u4e22\u5f03\u4e0a\u4e00\u6b21\u6e32\u67d3\u8fdb\u5ea6\n  if (workInProgressRoot !== root || workInProgressRootRenderLanes !== lanes) {\n    // \u5237\u65b0\u6808\u5e27, legacy\u6a21\u5f0f\u4e0b\u90fd\u4f1a\u8fdb\u5165\n    prepareFreshStack(root, lanes);\n  }\n  do {\n    try {\n      workLoopSync();\n      break;\n    } catch (thrownValue) {\n      handleError(root, thrownValue);\n    }\n  } while (true);\n  executionContext = prevExecutionContext;\n  // \u91cd\u7f6e\u5168\u5c40\u53d8\u91cf, \u8868\u660erender\u7ed3\u675f\n  workInProgressRoot = null;\n  workInProgressRootRenderLanes = NoLanes;\n  return workInProgressRootExitStatus;\n}",lang:"js"}),r.a.createElement("p",null,"\u5728",r.a.createElement("code",null,"renderRootSync"),"\u4e2d, \u5728\u6267\u884c",r.a.createElement("code",null,"fiber\u6811\u6784\u9020"),"\u524d(",r.a.createElement("code",null,"workLoopSync"),")\u4f1a\u5148\u5237\u65b0\u6808\u5e27",r.a.createElement("code",null,"prepareFreshStack"),"(\u53c2\u8003",r.a.createElement(a["AnchorLink"],{to:"./fibertree-prepare#%E6%A0%88%E5%B8%A7%E7%AE%A1%E7%90%86"},"fiber \u6811\u6784\u9020(\u57fa\u7840\u51c6\u5907)"),").\u5728\u8fd9\u91cc\u521b\u5efa\u4e86",r.a.createElement("code",null,"HostRootFiber.alternate"),", \u91cd\u7f6e\u5168\u5c40\u53d8\u91cf",r.a.createElement("code",null,"workInProgress"),"\u548c",r.a.createElement("code",null,"workInProgressRoot"),"\u7b49."),r.a.createElement("p",null,r.a.createElement("img",{src:t("Wqxf"),alt:""})),r.a.createElement("h3",{id:"\u5faa\u73af\u6784\u9020"},r.a.createElement(a["AnchorLink"],{to:"#\u5faa\u73af\u6784\u9020","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5faa\u73af\u6784\u9020"),r.a.createElement("p",null,"\u903b\u8f91\u6765\u5230",r.a.createElement("code",null,"workLoopSync"),", \u867d\u7136\u672c\u8282\u5728",r.a.createElement("code",null,"Legacy"),"\u6a21\u5f0f\u4e0b\u8fdb\u884c\u8ba8\u8bba, \u6b64\u5904\u8fd8\u662f\u5bf9\u6bd4\u4e00\u4e0b",r.a.createElement("code",null,"workLoopConcurrent")),r.a.createElement(o["a"],{code:"function workLoopSync() {\n  while (workInProgress !== null) {\n    performUnitOfWork(workInProgress);\n  }\n}\n\nfunction workLoopConcurrent() {\n  // Perform work until Scheduler asks us to yield\n  while (workInProgress !== null && !shouldYield()) {\n    performUnitOfWork(workInProgress);\n  }\n}",lang:"js"}),r.a.createElement("p",null,"\u53ef\u4ee5\u770b\u5230",r.a.createElement("code",null,"workLoopConcurrent"),"\u76f8\u6bd4\u4e8e",r.a.createElement("code",null,"Sync"),", \u4f1a\u591a\u4e00\u4e2a\u505c\u987f\u673a\u5236, \u8fd9\u4e2a\u673a\u5236\u5b9e\u73b0\u4e86",r.a.createElement("code",null,"\u65f6\u95f4\u5207\u7247"),"\u548c",r.a.createElement("code",null,"\u53ef\u4e2d\u65ad\u6e32\u67d3"),"(\u53c2\u8003",r.a.createElement(a["AnchorLink"],{to:"./scheduler#%E6%97%B6%E9%97%B4%E5%88%87%E7%89%87%E5%8E%9F%E7%90%86"},"React \u8c03\u5ea6\u539f\u7406"),")"),r.a.createElement("p",null,"\u7ed3\u5408",r.a.createElement("code",null,"performUnitOfWork\u51fd\u6570"),"(",r.a.createElement(a["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberWorkLoop.old.js#L1642-L1668"},"\u6e90\u7801\u5730\u5740"),")"),r.a.createElement(o["a"],{code:"// ... \u7701\u7565\u90e8\u5206\u65e0\u5173\u4ee3\u7801\nfunction performUnitOfWork(unitOfWork: Fiber): void {\n  // unitOfWork\u5c31\u662f\u88ab\u4f20\u5165\u7684workInProgress\n  const current = unitOfWork.alternate;\n  let next;\n  next = beginWork(current, unitOfWork, subtreeRenderLanes);\n  unitOfWork.memoizedProps = unitOfWork.pendingProps;\n  if (next === null) {\n    // \u5982\u679c\u6ca1\u6709\u6d3e\u751f\u51fa\u65b0\u7684\u8282\u70b9, \u5219\u8fdb\u5165completeWork\u9636\u6bb5, \u4f20\u5165\u7684\u662f\u5f53\u524dunitOfWork\n    completeUnitOfWork(unitOfWork);\n  } else {\n    workInProgress = next;\n  }\n}",lang:"js"}),r.a.createElement("p",null,"\u53ef\u4ee5\u660e\u663e\u7684\u770b\u51fa, \u6574\u4e2a",r.a.createElement("code",null,"fiber\u6811\u6784\u9020"),"\u662f\u4e00\u4e2a\u6df1\u5ea6\u4f18\u5148\u904d\u5386(\u53ef\u53c2\u8003",r.a.createElement(a["Link"],{to:"../algorithm/dfs"},"React \u7b97\u6cd5\u4e4b\u6df1\u5ea6\u4f18\u5148\u904d\u5386"),"), \u5176\u4e2d\u6709 2 \u4e2a\u91cd\u8981\u7684\u53d8\u91cf",r.a.createElement("code",null,"workInProgress"),"\u548c",r.a.createElement("code",null,"current"),"(\u53ef\u53c2\u8003\u524d\u6587",r.a.createElement(a["AnchorLink"],{to:"./fibertree-prepare#%E5%8F%8C%E7%BC%93%E5%86%B2%E6%8A%80%E6%9C%AF"},"fiber \u6811\u6784\u9020(\u57fa\u7840\u51c6\u5907)"),"\u4e2d\u4ecb\u7ecd\u7684",r.a.createElement("code",null,"\u53cc\u7f13\u51b2\u6280\u672f"),"):"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"workInProgress"),"\u548c",r.a.createElement("code",null,"current"),"\u90fd\u89c6\u4e3a\u6307\u9488"),r.a.createElement("li",null,r.a.createElement("code",null,"workInProgress"),"\u6307\u5411\u5f53\u524d\u6b63\u5728\u6784\u9020\u7684",r.a.createElement("code",null,"fiber"),"\u8282\u70b9"),r.a.createElement("li",null,r.a.createElement("code",null,"current = workInProgress.alternate"),"(\u5373",r.a.createElement("code",null,"fiber.alternate"),"), \u6307\u5411\u5f53\u524d\u9875\u9762\u6b63\u5728\u4f7f\u7528\u7684",r.a.createElement("code",null,"fiber"),"\u8282\u70b9. \u521d\u6b21\u6784\u9020\u65f6, \u9875\u9762\u8fd8\u672a\u6e32\u67d3, \u6b64\u65f6",r.a.createElement("code",null,"current = null"),".")),r.a.createElement("p",null,"\u5728\u6df1\u5ea6\u4f18\u5148\u904d\u5386\u4e2d, \u6bcf\u4e2a",r.a.createElement("code",null,"fiber"),"\u8282\u70b9\u90fd\u4f1a\u7ecf\u5386 2 \u4e2a\u9636\u6bb5:"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u63a2\u5bfb\u9636\u6bb5 ",r.a.createElement("code",null,"beginWork")),r.a.createElement("li",null,"\u56de\u6eaf\u9636\u6bb5 ",r.a.createElement("code",null,"completeWork"))),r.a.createElement("p",null,"\u8fd9 2 \u4e2a\u9636\u6bb5\u5171\u540c\u5b8c\u6210\u4e86\u6bcf\u4e00\u4e2a",r.a.createElement("code",null,"fiber"),"\u8282\u70b9\u7684\u521b\u5efa, \u6240\u6709",r.a.createElement("code",null,"fiber"),"\u8282\u70b9\u5219\u6784\u6210\u4e86",r.a.createElement("code",null,"fiber\u6811"),"."),r.a.createElement("h3",{id:"\u63a2\u5bfb\u9636\u6bb5-beginwork"},r.a.createElement(a["AnchorLink"],{to:"#\u63a2\u5bfb\u9636\u6bb5-beginwork","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u63a2\u5bfb\u9636\u6bb5 beginWork"),r.a.createElement("p",null,r.a.createElement("code",null,"beginWork(current, unitOfWork, subtreeRenderLanes)"),"(",r.a.createElement(a["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberBeginWork.old.js#L3083-L3494"},"\u6e90\u7801\u5730\u5740"),")\u9488\u5bf9\u6240\u6709\u7684 Fiber \u7c7b\u578b, \u5176\u4e2d\u7684\u6bcf\u4e00\u4e2a case \u5904\u7406\u4e00\u79cd Fiber \u7c7b\u578b. ",r.a.createElement("code",null,"updateXXX"),"\u51fd\u6570(\u5982: ",r.a.createElement("code",null,"updateHostRoot"),", ",r.a.createElement("code",null,"updateClassComponent")," \u7b49)\u7684\u4e3b\u8981\u903b\u8f91:"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u6839\u636e ",r.a.createElement("code",null,"ReactElement"),"\u5bf9\u8c61\u521b\u5efa\u6240\u6709\u7684",r.a.createElement("code",null,"fiber"),"\u8282\u70b9, \u6700\u7ec8\u6784\u9020\u51fa",r.a.createElement("code",null,"fiber\u6811\u5f62\u7ed3\u6784"),"(\u8bbe\u7f6e",r.a.createElement("code",null,"return"),"\u548c",r.a.createElement("code",null,"sibling"),"\u6307\u9488)"),r.a.createElement("li",null,"\u8bbe\u7f6e",r.a.createElement("code",null,"fiber.flags"),"(\u4e8c\u8fdb\u5236\u5f62\u5f0f\u53d8\u91cf, \u7528\u6765\u6807\u8bb0 ",r.a.createElement("code",null,"fiber"),"\u8282\u70b9 \u7684",r.a.createElement("code",null,"\u589e,\u5220,\u6539"),"\u72b6\u6001, \u7b49\u5f85",r.a.createElement("code",null,"completeWork\u9636\u6bb5\u5904\u7406"),")"),r.a.createElement("li",null,"\u8bbe\u7f6e",r.a.createElement("code",null,"fiber.stateNode"),"\u5c40\u90e8\u72b6\u6001(\u5982",r.a.createElement("code",null,"Class\u7c7b\u578b"),"\u8282\u70b9: ",r.a.createElement("code",null,"fiber.stateNode=new Class()"),")")),r.a.createElement(o["a"],{code:"function beginWork(\n  current: Fiber | null,\n  workInProgress: Fiber,\n  renderLanes: Lanes,\n): Fiber | null {\n  const updateLanes = workInProgress.lanes;\n  if (current !== null) {\n    // update\u903b\u8f91, \u9996\u6b21render\u4e0d\u4f1a\u8fdb\u5165\n  } else {\n    didReceiveUpdate = false;\n  }\n  // 1. \u8bbe\u7f6eworkInProgress\u4f18\u5148\u7ea7\u4e3aNoLanes(\u6700\u9ad8\u4f18\u5148\u7ea7)\n  workInProgress.lanes = NoLanes;\n  // 2. \u6839\u636eworkInProgress\u8282\u70b9\u7684\u7c7b\u578b, \u7528\u4e0d\u540c\u7684\u65b9\u6cd5\u6d3e\u751f\u51fa\u5b50\u8282\u70b9\n  switch (\n    workInProgress.tag // \u53ea\u4fdd\u7559\u4e86\u672c\u4f8b\u4f7f\u7528\u5230\u7684case\n  ) {\n    case ClassComponent: {\n      const Component = workInProgress.type;\n      const unresolvedProps = workInProgress.pendingProps;\n      const resolvedProps =\n        workInProgress.elementType === Component\n          ? unresolvedProps\n          : resolveDefaultProps(Component, unresolvedProps);\n      return updateClassComponent(\n        current,\n        workInProgress,\n        Component,\n        resolvedProps,\n        renderLanes,\n      );\n    }\n    case HostRoot:\n      return updateHostRoot(current, workInProgress, renderLanes);\n    case HostComponent:\n      return updateHostComponent(current, workInProgress, renderLanes);\n    case HostText:\n      return updateHostText(current, workInProgress);\n    case Fragment:\n      return updateFragment(current, workInProgress, renderLanes);\n  }\n}",lang:"js"}),r.a.createElement("p",null,r.a.createElement("code",null,"updateXXX"),"\u51fd\u6570(\u5982: updateHostRoot, updateClassComponent \u7b49)\u867d\u7136 case \u8f83\u591a, \u4f46\u662f\u4e3b\u8981\u903b\u8f91\u53ef\u4ee5\u6982\u62ec\u4e3a 3 \u4e2a\u6b65\u9aa4:"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u6839\u636e",r.a.createElement("code",null,"fiber.pendingProps, fiber.updateQueue"),"\u7b49",r.a.createElement("code",null,"\u8f93\u5165\u6570\u636e"),"\u72b6\u6001, \u8ba1\u7b97",r.a.createElement("code",null,"fiber.memoizedState"),"\u4f5c\u4e3a",r.a.createElement("code",null,"\u8f93\u51fa\u72b6\u6001")),r.a.createElement("li",null,"\u83b7\u53d6\u4e0b\u7ea7",r.a.createElement("code",null,"ReactElement"),"\u5bf9\u8c61",r.a.createElement("ol",null,r.a.createElement("li",null,"class \u7c7b\u578b\u7684 ",r.a.createElement("code",null,"fiber")," \u8282\u70b9",r.a.createElement("ul",null,r.a.createElement("li",null,"\u6784\u5efa",r.a.createElement("code",null,"React.Component"),"\u5b9e\u4f8b"),r.a.createElement("li",null,"\u628a\u65b0\u5b9e\u4f8b\u6302\u8f7d\u5230",r.a.createElement("code",null,"fiber.stateNode"),"\u4e0a"),r.a.createElement("li",null,"\u6267\u884c",r.a.createElement("code",null,"render"),"\u4e4b\u524d\u7684\u751f\u547d\u5468\u671f\u51fd\u6570"),r.a.createElement("li",null,"\u6267\u884c",r.a.createElement("code",null,"render"),"\u65b9\u6cd5, \u83b7\u53d6\u4e0b\u7ea7",r.a.createElement("code",null,"reactElement")),r.a.createElement("li",null,"\u6839\u636e\u5b9e\u9645\u60c5\u51b5, \u8bbe\u7f6e",r.a.createElement("code",null,"fiber.flags")))),r.a.createElement("li",null,"function \u7c7b\u578b\u7684 ",r.a.createElement("code",null,"fiber")," \u8282\u70b9",r.a.createElement("ul",null,r.a.createElement("li",null,"\u6267\u884c function, \u83b7\u53d6\u4e0b\u7ea7",r.a.createElement("code",null,"reactElement")),r.a.createElement("li",null,"\u6839\u636e\u5b9e\u9645\u60c5\u51b5, \u8bbe\u7f6e",r.a.createElement("code",null,"fiber.flags")))),r.a.createElement("li",null,"HostComponent \u7c7b\u578b(\u5982: ",r.a.createElement("code",null,"div, span, button")," \u7b49)\u7684 ",r.a.createElement("code",null,"fiber")," \u8282\u70b9",r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"pendingProps.children"),"\u4f5c\u4e3a\u4e0b\u7ea7",r.a.createElement("code",null,"reactElement")),r.a.createElement("li",null,"\u5982\u679c\u4e0b\u7ea7\u8282\u70b9\u662f\u6587\u672c\u8282\u70b9,\u5219\u8bbe\u7f6e\u4e0b\u7ea7\u8282\u70b9\u4e3a null. \u51c6\u5907\u8fdb\u5165",r.a.createElement("code",null,"completeUnitOfWork"),"\u9636\u6bb5"),r.a.createElement("li",null,"\u6839\u636e\u5b9e\u9645\u60c5\u51b5, \u8bbe\u7f6e",r.a.createElement("code",null,"fiber.flags")))),r.a.createElement("li",null,"\u5176\u4ed6\u7c7b\u578b..."))),r.a.createElement("li",null,"\u6839\u636e",r.a.createElement("code",null,"ReactElement"),"\u5bf9\u8c61, \u8c03\u7528",r.a.createElement("code",null,"reconcileChildren"),"\u751f\u6210",r.a.createElement("code",null,"Fiber"),"\u5b50\u8282\u70b9(\u53ea\u751f\u6210",r.a.createElement("code",null,"\u6b21\u7ea7\u5b50\u8282\u70b9"),")",r.a.createElement("ul",null,r.a.createElement("li",null,"\u6839\u636e\u5b9e\u9645\u60c5\u51b5, \u8bbe\u7f6e",r.a.createElement("code",null,"fiber.flags"))))),r.a.createElement("p",null,"\u4e0d\u540c\u7684",r.a.createElement("code",null,"updateXXX"),"\u51fd\u6570\u5904\u7406\u7684",r.a.createElement("code",null,"fiber"),"\u8282\u70b9\u7c7b\u578b\u4e0d\u540c, \u603b\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u5411\u4e0b\u751f\u6210\u5b50\u8282\u70b9. \u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u628a\u4e00\u4e9b\u9700\u8981\u6301\u4e45\u5316\u7684\u6570\u636e\u6302\u8f7d\u5230",r.a.createElement("code",null,"fiber"),"\u8282\u70b9\u4e0a(\u5982",r.a.createElement("code",null,"fiber.stateNode"),",",r.a.createElement("code",null,"fiber.memoizedState"),"\u7b49); \u628a",r.a.createElement("code",null,"fiber"),"\u8282\u70b9\u7684\u7279\u6b8a\u64cd\u4f5c\u8bbe\u7f6e\u5230",r.a.createElement("code",null,"fiber.flags"),"(\u5982:",r.a.createElement("code",null,"\u8282\u70b9ref"),",",r.a.createElement("code",null,"class\u7ec4\u4ef6\u7684\u751f\u547d\u5468\u671f"),",",r.a.createElement("code",null,"function\u7ec4\u4ef6\u7684hook"),",",r.a.createElement("code",null,"\u8282\u70b9\u5220\u9664"),"\u7b49)."),r.a.createElement("p",null,"\u8fd9\u91cc\u5217\u51fa",r.a.createElement("code",null,"updateHostRoot"),", ",r.a.createElement("code",null,"updateHostComponent"),"\u7684\u4ee3\u7801, \u5bf9\u4e8e\u5176\u4ed6\u5e38\u7528 case \u7684\u5206\u6790(\u5982",r.a.createElement("code",null,"class"),"\u7c7b\u578b, ",r.a.createElement("code",null,"function"),"\u7c7b\u578b), \u5728",r.a.createElement("code",null,"\u72b6\u6001\u7ec4\u4ef6"),"\u7ae0\u8282\u4e2d\u8fdb\u884c\u63a2\u8ba8."),r.a.createElement("p",null,r.a.createElement("code",null,"fiber\u6811"),"\u7684\u6839\u8282\u70b9\u662f",r.a.createElement("code",null,"HostRootFiber"),"\u8282\u70b9, \u6240\u4ee5\u7b2c\u4e00\u6b21\u8fdb\u5165",r.a.createElement("code",null,"beginWork"),"\u4f1a\u8c03\u7528",r.a.createElement(a["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberBeginWork.old.js#L1053-L1122"},"updateHostRoot(current, workInProgress, renderLanes)")),r.a.createElement(o["a"],{code:"// \u7701\u7565\u4e0e\u672c\u8282\u65e0\u5173\u4ee3\u7801\nfunction updateHostRoot(current, workInProgress, renderLanes) {\n  // 1. \u72b6\u6001\u8ba1\u7b97, \u66f4\u65b0\u6574\u5408\u5230 workInProgress.memoizedState\u4e2d\u6765\n  const updateQueue = workInProgress.updateQueue;\n  const nextProps = workInProgress.pendingProps;\n  const prevState = workInProgress.memoizedState;\n  const prevChildren = prevState !== null ? prevState.element : null;\n  cloneUpdateQueue(current, workInProgress);\n  // \u904d\u5386updateQueue.shared.pending, \u63d0\u53d6\u6709\u8db3\u591f\u4f18\u5148\u7ea7\u7684update\u5bf9\u8c61, \u8ba1\u7b97\u51fa\u6700\u7ec8\u7684\u72b6\u6001 workInProgress.memoizedState\n  processUpdateQueue(workInProgress, nextProps, null, renderLanes);\n  const nextState = workInProgress.memoizedState;\n  // 2. \u83b7\u53d6\u4e0b\u7ea7`ReactElement`\u5bf9\u8c61\n  const nextChildren = nextState.element;\n  const root: FiberRoot = workInProgress.stateNode;\n  if (root.hydrate && enterHydrationState(workInProgress)) {\n    // ...\u670d\u52a1\u7aef\u6e32\u67d3\u76f8\u5173, \u6b64\u5904\u7701\u7565\n  } else {\n    // 3. \u6839\u636e`ReactElement`\u5bf9\u8c61, \u8c03\u7528`reconcileChildren`\u751f\u6210`Fiber`\u5b50\u8282\u70b9(\u53ea\u751f\u6210`\u6b21\u7ea7\u5b50\u8282\u70b9`)\n    reconcileChildren(current, workInProgress, nextChildren, renderLanes);\n  }\n  return workInProgress.child;\n}",lang:"js"}),r.a.createElement("p",null,"\u666e\u901a DOM \u6807\u7b7e\u7c7b\u578b\u7684\u8282\u70b9(\u5982",r.a.createElement("code",null,"div"),",",r.a.createElement("code",null,"span"),",",r.a.createElement("code",null,"p"),"),\u4f1a\u8fdb\u5165",r.a.createElement(a["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberBeginWork.old.js#L1124-L1157"},"updateHostComponent"),":"),r.a.createElement(o["a"],{code:"// ...\u7701\u7565\u90e8\u5206\u65e0\u5173\u4ee3\u7801\nfunction updateHostComponent(\n  current: Fiber | null,\n  workInProgress: Fiber,\n  renderLanes: Lanes,\n) {\n  // 1. \u72b6\u6001\u8ba1\u7b97, \u7531\u4e8eHostComponent\u662f\u65e0\u72b6\u6001\u7ec4\u4ef6, \u6240\u4ee5\u53ea\u9700\u8981\u6536\u96c6 nextProps\u5373\u53ef, \u5b83\u6ca1\u6709 memoizedState\n  const type = workInProgress.type;\n  const nextProps = workInProgress.pendingProps;\n  const prevProps = current !== null ? current.memoizedProps : null;\n  // 2. \u83b7\u53d6\u4e0b\u7ea7`ReactElement`\u5bf9\u8c61\n  let nextChildren = nextProps.children;\n  const isDirectTextChild = shouldSetTextContent(type, nextProps);\n\n  if (isDirectTextChild) {\n    // \u5982\u679c\u5b50\u8282\u70b9\u53ea\u6709\u4e00\u4e2a\u6587\u672c\u8282\u70b9, \u4e0d\u7528\u518d\u521b\u5efa\u4e00\u4e2aHostText\u7c7b\u578b\u7684fiber\n    nextChildren = null;\n  } else if (prevProps !== null && shouldSetTextContent(type, prevProps)) {\n    // \u7279\u6b8a\u64cd\u4f5c\u9700\u8981\u8bbe\u7f6efiber.flags\n    workInProgress.flags |= ContentReset;\n  }\n  // \u7279\u6b8a\u64cd\u4f5c\u9700\u8981\u8bbe\u7f6efiber.flags\n  markRef(current, workInProgress);\n  // 3. \u6839\u636e`ReactElement`\u5bf9\u8c61, \u8c03\u7528`reconcileChildren`\u751f\u6210`Fiber`\u5b50\u8282\u70b9(\u53ea\u751f\u6210`\u6b21\u7ea7\u5b50\u8282\u70b9`)\n  reconcileChildren(current, workInProgress, nextChildren, renderLanes);\n  return workInProgress.child;\n}",lang:"js"}),r.a.createElement("h3",{id:"\u56de\u6eaf\u9636\u6bb5-completework"},r.a.createElement(a["AnchorLink"],{to:"#\u56de\u6eaf\u9636\u6bb5-completework","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u56de\u6eaf\u9636\u6bb5 completeWork"),r.a.createElement("p",null,r.a.createElement("code",null,"completeUnitOfWork(unitOfWork)"),"(",r.a.createElement(a["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberWorkLoop.old.js#L1670-L1802"},"\u6e90\u7801\u5730\u5740"),"), \u5904\u7406 ",r.a.createElement("code",null,"beginWork")," \u9636\u6bb5\u5df2\u7ecf\u521b\u5efa\u51fa\u6765\u7684 ",r.a.createElement("code",null,"fiber")," \u8282\u70b9, \u6838\u5fc3\u903b\u8f91:"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u8c03\u7528",r.a.createElement("code",null,"completeWork"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u7ed9",r.a.createElement("code",null,"fiber"),"\u8282\u70b9(tag=HostComponent, HostText)\u521b\u5efa DOM \u5b9e\u4f8b, \u8bbe\u7f6e",r.a.createElement("code",null,"fiber.stateNode"),"\u5c40\u90e8\u72b6\u6001(\u5982",r.a.createElement("code",null,"tag=HostComponent, HostText"),"\u8282\u70b9: fiber.stateNode \u6307\u5411\u8fd9\u4e2a DOM \u5b9e\u4f8b)."),r.a.createElement("li",null,"\u4e3a DOM \u8282\u70b9\u8bbe\u7f6e\u5c5e\u6027, \u7ed1\u5b9a\u4e8b\u4ef6(\u8fd9\u91cc\u5148\u8bf4\u660e\u6709\u8fd9\u4e2a\u6b65\u9aa4, \u8be6\u7ec6\u7684\u4e8b\u4ef6\u5904\u7406\u6d41\u7a0b, \u5728",r.a.createElement("code",null,"\u5408\u6210\u4e8b\u4ef6\u539f\u7406"),"\u4e2d\u8be6\u7ec6\u8bf4\u660e)."),r.a.createElement("li",null,"\u8bbe\u7f6e",r.a.createElement("code",null,"fiber.flags"),"\u6807\u8bb0"))),r.a.createElement("li",null,"\u628a\u5f53\u524d ",r.a.createElement("code",null,"fiber")," \u5bf9\u8c61\u7684\u526f\u4f5c\u7528\u961f\u5217(",r.a.createElement("code",null,"firstEffect"),"\u548c",r.a.createElement("code",null,"lastEffect"),")\u6dfb\u52a0\u5230\u7236\u8282\u70b9\u7684\u526f\u4f5c\u7528\u961f\u5217\u4e4b\u540e, \u66f4\u65b0\u7236\u8282\u70b9\u7684",r.a.createElement("code",null,"firstEffect"),"\u548c",r.a.createElement("code",null,"lastEffect"),"\u6307\u9488."),r.a.createElement("li",null,"\u8bc6\u522b",r.a.createElement("code",null,"beginWork"),"\u9636\u6bb5\u8bbe\u7f6e\u7684",r.a.createElement("code",null,"fiber.flags"),", \u5224\u65ad\u5f53\u524d ",r.a.createElement("code",null,"fiber")," \u662f\u5426\u6709\u526f\u4f5c\u7528(\u589e,\u5220,\u6539), \u5982\u679c\u6709, \u9700\u8981\u5c06\u5f53\u524d ",r.a.createElement("code",null,"fiber")," \u52a0\u5165\u5230\u7236\u8282\u70b9\u7684",r.a.createElement("code",null,"effects"),"\u961f\u5217, \u7b49\u5f85",r.a.createElement("code",null,"commit"),"\u9636\u6bb5\u5904\u7406.")),r.a.createElement(o["a"],{code:"function completeUnitOfWork(unitOfWork: Fiber): void {\n  let completedWork = unitOfWork;\n  // \u5916\u5c42\u5faa\u73af\u63a7\u5236\u5e76\u79fb\u52a8\u6307\u9488(`workInProgress`,`completedWork`\u7b49)\n  do {\n    const current = completedWork.alternate;\n    const returnFiber = completedWork.return;\n    if ((completedWork.flags & Incomplete) === NoFlags) {\n      let next;\n      // 1. \u5904\u7406Fiber\u8282\u70b9, \u4f1a\u8c03\u7528\u6e32\u67d3\u5668(\u8c03\u7528react-dom\u5305, \u5173\u8054Fiber\u8282\u70b9\u548cdom\u5bf9\u8c61, \u7ed1\u5b9a\u4e8b\u4ef6\u7b49)\n      next = completeWork(current, completedWork, subtreeRenderLanes); // \u5904\u7406\u5355\u4e2a\u8282\u70b9\n      if (next !== null) {\n        // \u5982\u679c\u6d3e\u751f\u51fa\u5176\u4ed6\u7684\u5b50\u8282\u70b9, \u5219\u56de\u5230`beginWork`\u9636\u6bb5\u8fdb\u884c\u5904\u7406\n        workInProgress = next;\n        return;\n      }\n      // \u91cd\u7f6e\u5b50\u8282\u70b9\u7684\u4f18\u5148\u7ea7\n      resetChildLanes(completedWork);\n      if (\n        returnFiber !== null &&\n        (returnFiber.flags & Incomplete) === NoFlags\n      ) {\n        // 2. \u6536\u96c6\u5f53\u524dFiber\u8282\u70b9\u4ee5\u53ca\u5176\u5b50\u6811\u7684\u526f\u4f5c\u7528effects\n        // 2.1 \u628a\u5b50\u8282\u70b9\u7684\u526f\u4f5c\u7528\u961f\u5217\u6dfb\u52a0\u5230\u7236\u8282\u70b9\u4e0a\n        if (returnFiber.firstEffect === null) {\n          returnFiber.firstEffect = completedWork.firstEffect;\n        }\n        if (completedWork.lastEffect !== null) {\n          if (returnFiber.lastEffect !== null) {\n            returnFiber.lastEffect.nextEffect = completedWork.firstEffect;\n          }\n          returnFiber.lastEffect = completedWork.lastEffect;\n        }\n        // 2.2 \u5982\u679c\u5f53\u524dfiber\u8282\u70b9\u6709\u526f\u4f5c\u7528, \u5c06\u5176\u6dfb\u52a0\u5230\u5b50\u8282\u70b9\u7684\u526f\u4f5c\u7528\u961f\u5217\u4e4b\u540e.\n        const flags = completedWork.flags;\n        if (flags > PerformedWork) {\n          // PerformedWork\u662f\u63d0\u4f9b\u7ed9 React DevTools\u8bfb\u53d6\u7684, \u6240\u4ee5\u7565\u8fc7PerformedWork\n          if (returnFiber.lastEffect !== null) {\n            returnFiber.lastEffect.nextEffect = completedWork;\n          } else {\n            returnFiber.firstEffect = completedWork;\n          }\n          returnFiber.lastEffect = completedWork;\n        }\n      }\n    } else {\n      // \u5f02\u5e38\u5904\u7406, \u672c\u8282\u4e0d\u8ba8\u8bba\n    }\n\n    const siblingFiber = completedWork.sibling;\n    if (siblingFiber !== null) {\n      // \u5982\u679c\u6709\u5144\u5f1f\u8282\u70b9, \u8fd4\u56de\u4e4b\u540e\u518d\u6b21\u8fdb\u5165`beginWork`\u9636\u6bb5\n      workInProgress = siblingFiber;\n      return;\n    }\n    // \u79fb\u52a8\u6307\u9488, \u6307\u5411\u4e0b\u4e00\u4e2a\u8282\u70b9\n    completedWork = returnFiber;\n    workInProgress = completedWork;\n  } while (completedWork !== null);\n  // \u5df2\u56de\u6eaf\u5230\u6839\u8282\u70b9, \u8bbe\u7f6eworkInProgressRootExitStatus = RootCompleted\n  if (workInProgressRootExitStatus === RootIncomplete) {\n    workInProgressRootExitStatus = RootCompleted;\n  }\n}",lang:"js"}),r.a.createElement("p",null,"\u63a5\u4e0b\u6765\u5206\u6790",r.a.createElement("code",null,"fiber"),"\u5904\u7406\u51fd\u6570",r.a.createElement(a["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberCompleteWork.old.js#L645-L1289"},"completeWork")),r.a.createElement(o["a"],{code:"function completeWork(\n  current: Fiber | null,\n  workInProgress: Fiber,\n  renderLanes: Lanes,\n): Fiber | null {\n  const newProps = workInProgress.pendingProps;\n  switch (workInProgress.tag) {\n    case ClassComponent: {\n      // Class\u7c7b\u578b\u4e0d\u505a\u5904\u7406\n      return null;\n    }\n    case HostRoot: {\n      const fiberRoot = (workInProgress.stateNode: FiberRoot);\n      if (fiberRoot.pendingContext) {\n        fiberRoot.context = fiberRoot.pendingContext;\n        fiberRoot.pendingContext = null;\n      }\n      if (current === null || current.child === null) {\n         // \u8bbe\u7f6efiber.flags\u6807\u8bb0\n         workInProgress.flags |= Snapshot;\n      }\n      return null;\n    }\n    case HostComponent: {\n      popHostContext(workInProgress);\n      const rootContainerInstance = getRootHostContainer();\n      const type = workInProgress.type;\n      if (current !== null && workInProgress.stateNode != null) {\n        // update\u903b\u8f91, \u521d\u6b21render\u4e0d\u4f1a\u8fdb\u5165\n      } else {\n        const currentHostContext = getHostContext();\n        // 1. \u521b\u5efaDOM\u5bf9\u8c61\n        const instance = createInstance(\n          type,\n          newProps,\n          rootContainerInstance,\n          currentHostContext,\n          workInProgress,\n        );\n        // 2. \u628a\u5b50\u6811\u4e2d\u7684DOM\u5bf9\u8c61append\u5230\u672c\u8282\u70b9\u7684DOM\u5bf9\u8c61\u4e4b\u540e\n        appendAllChildren(instance, workInProgress, false, false);\n        // \u8bbe\u7f6estateNode\u5c5e\u6027, \u6307\u5411DOM\u5bf9\u8c61\n        workInProgress.stateNode = instance;\n        if (\n          // 3. \u8bbe\u7f6eDOM\u5bf9\u8c61\u7684\u5c5e\u6027, \u7ed1\u5b9a\u4e8b\u4ef6\u7b49\n          finalizeInitialChildren(\n            instance,\n            type,\n            newProps,\n            rootContainerInstance,\n            currentHostContext,\n          )\n        ) {\n          // \u8bbe\u7f6efiber.flags\u6807\u8bb0(Update)\n          markUpdate(workInProgress);\n        }\n        if (workInProgress.ref !== null) {\n          // \u8bbe\u7f6efiber.flags\u6807\u8bb0(Ref)\n          markRef(workInProgress);\n        }\n        return null;\n    }\n  }\n}",lang:"js"}),r.a.createElement("p",null,"\u53ef\u4ee5\u770b\u5230\u5728\u6ee1\u8db3\u6761\u4ef6\u7684\u65f6\u5019\u4e5f\u4f1a\u8bbe\u7f6e",r.a.createElement("code",null,"fiber.flags"),", \u6240\u4ee5\u8bbe\u7f6e",r.a.createElement("code",null,"fiber.flags"),"\u5e76\u975e\u53ea\u5728",r.a.createElement("code",null,"beginWork"),"\u9636\u6bb5."),r.a.createElement("h2",{id:"\u8fc7\u7a0b\u56fe\u89e3"},r.a.createElement(a["AnchorLink"],{to:"#\u8fc7\u7a0b\u56fe\u89e3","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u8fc7\u7a0b\u56fe\u89e3"),r.a.createElement("p",null,"\u9488\u5bf9\u672c\u8282\u7684\u793a\u4f8b\u4ee3\u7801, \u5c06\u6574\u4e2a",r.a.createElement("code",null,"fiber"),"\u6811\u6784\u9020\u8fc7\u7a0b\u8868\u793a\u51fa\u6765:"),r.a.createElement("p",null,"\u6784\u9020\u524d:"),r.a.createElement("p",null,"\u5728\u4e0a\u6587\u5df2\u7ecf\u8bf4\u660e, \u8fdb\u5165\u5faa\u73af\u6784\u9020\u524d\u4f1a\u8c03\u7528",r.a.createElement("code",null,"prepareFreshStack"),"\u5237\u65b0\u6808\u5e27, \u5728\u8fdb\u5165",r.a.createElement("code",null,"fiber\u6811\u6784\u9020"),"\u5faa\u73af\u4e4b\u524d, \u4fdd\u6301\u8fd9\u8fd9\u4e2a\u521d\u59cb\u5316\u72b6\u6001:"),r.a.createElement("p",null,r.a.createElement("img",{src:t("9OPI"),alt:""})),r.a.createElement("p",null,r.a.createElement("code",null,"performUnitOfWork"),"\u7b2c 1 \u6b21\u8c03\u7528(\u53ea\u6267\u884c",r.a.createElement("code",null,"beginWork"),"):"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u6267\u884c\u524d: ",r.a.createElement("code",null,"workInProgress"),"\u6307\u9488\u6307\u5411",r.a.createElement("code",null,"HostRootFiber.alternate"),"\u5bf9\u8c61, \u6b64\u65f6",r.a.createElement("code",null,"current = workInProgress.alternate"),"\u6307\u5411",r.a.createElement("code",null,"fiberRoot.current"),"\u662f\u975e\u7a7a\u7684(\u521d\u6b21\u6784\u9020, \u53ea\u5728\u6839\u8282\u70b9\u65f6, ",r.a.createElement("code",null,"current"),"\u975e\u7a7a)."),r.a.createElement("li",null,"\u6267\u884c\u8fc7\u7a0b: \u8c03\u7528",r.a.createElement("code",null,"updateHostRoot"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5728",r.a.createElement("code",null,"reconcileChildren"),"\u9636\u6bb5, \u5411\u4e0b\u6784\u9020",r.a.createElement("code",null,"\u6b21\u7ea7\u5b50\u8282\u70b9fiber(<App/>)"),", \u540c\u65f6\u8bbe\u7f6e\u5b50\u8282\u70b9(",r.a.createElement("code",null,"fiber(<App/>)"),")",r.a.createElement(a["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactChildFiber.old.js#L376-L378"},"fiber.flags |= Placement")))),r.a.createElement("li",null,"\u6267\u884c\u540e: \u8fd4\u56de\u4e0b\u7ea7\u8282\u70b9",r.a.createElement("code",null,"fiber(<App/>)"),", \u79fb\u52a8",r.a.createElement("code",null,"workInProgress"),"\u6307\u9488\u6307\u5411\u5b50\u8282\u70b9",r.a.createElement("code",null,"fiber(<App/>)"))),r.a.createElement("p",null,r.a.createElement("img",{src:t("UQ7S"),alt:""})),r.a.createElement("p",null,r.a.createElement("code",null,"performUnitOfWork"),"\u7b2c 2 \u6b21\u8c03\u7528(\u53ea\u6267\u884c",r.a.createElement("code",null,"beginWork"),"):"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u6267\u884c\u524d: ",r.a.createElement("code",null,"workInProgress"),"\u6307\u9488\u6307\u5411",r.a.createElement("code",null,"fiber(<App/>)"),"\u8282\u70b9, \u6b64\u65f6",r.a.createElement("code",null,"current = null")),r.a.createElement("li",null,"\u6267\u884c\u8fc7\u7a0b: \u8c03\u7528",r.a.createElement("code",null,"updateClassComponent"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u672c\u793a\u4f8b\u4e2d, class \u5b9e\u4f8b\u5b58\u5728\u751f\u547d\u5468\u671f\u51fd\u6570",r.a.createElement("code",null,"componentDidMount"),", \u6240\u4ee5\u4f1a\u8bbe\u7f6e",r.a.createElement("code",null,"fiber(<App/>)"),"\u8282\u70b9",r.a.createElement(a["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberClassComponent.old.js#L892-L894"},"workInProgress.flags |= Update")),r.a.createElement("li",null,"\u53e6\u5916\u4e5f\u4f1a\u4e3a\u4e86",r.a.createElement("code",null,"React DevTools"),"\u80fd\u591f\u8bc6\u522b\u72b6\u6001\u7ec4\u4ef6\u7684\u6267\u884c\u8fdb\u5ea6, \u4f1a\u8bbe\u7f6e",r.a.createElement(a["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberBeginWork.old.js#L379"},"workInProgress.flags |= PerformedWork"),"(\u5728",r.a.createElement("code",null,"commit"),"\u9636\u6bb5\u4f1a\u6392\u9664\u8fd9\u4e2a",r.a.createElement("code",null,"flag"),", \u6b64\u5904\u53ea\u662f\u5217\u51fa",r.a.createElement("code",null,"workInProgress.flags"),"\u7684\u8bbe\u7f6e\u573a\u666f, \u4e0d\u8ba8\u8bba",r.a.createElement("code",null,"React DevTools"),")"),r.a.createElement("li",null,"\u9700\u8981\u6ce8\u610f",r.a.createElement("code",null,"classInstance.render()"),"\u5728\u672c\u6b65\u9aa4\u6267\u884c\u540e, \u867d\u7136\u8fd4\u56de\u4e86",r.a.createElement("code",null,"render"),"\u65b9\u6cd5\u4e2d\u6240\u6709\u7684",r.a.createElement("code",null,"ReactElement"),"\u5bf9\u8c61, \u4f46\u662f\u968f\u540e",r.a.createElement("code",null,"reconcileChildren"),"\u53ea\u6784\u9020",r.a.createElement("code",null,"\u6b21\u7ea7\u5b50\u8282\u70b9")),r.a.createElement("li",null,"\u5728",r.a.createElement("code",null,"reconcileChildren"),"\u9636\u6bb5, \u5411\u4e0b\u6784\u9020",r.a.createElement("code",null,"\u6b21\u7ea7\u5b50\u8282\u70b9div")))),r.a.createElement("li",null,"\u6267\u884c\u540e: \u8fd4\u56de\u4e0b\u7ea7\u8282\u70b9",r.a.createElement("code",null,"fiber(div)"),", \u79fb\u52a8",r.a.createElement("code",null,"workInProgress"),"\u6307\u9488\u6307\u5411\u5b50\u8282\u70b9",r.a.createElement("code",null,"fiber(div)"))),r.a.createElement("p",null,r.a.createElement("img",{src:t("IXZb"),alt:""})),r.a.createElement("p",null,r.a.createElement("code",null,"performUnitOfWork"),"\u7b2c 3 \u6b21\u8c03\u7528(\u53ea\u6267\u884c",r.a.createElement("code",null,"beginWork"),"):"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u6267\u884c\u524d: ",r.a.createElement("code",null,"workInProgress"),"\u6307\u9488\u6307\u5411",r.a.createElement("code",null,"fiber(div)"),"\u8282\u70b9, \u6b64\u65f6",r.a.createElement("code",null,"current = null")),r.a.createElement("li",null,"\u6267\u884c\u8fc7\u7a0b: \u8c03\u7528",r.a.createElement("code",null,"updateHostComponent"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5728",r.a.createElement("code",null,"reconcileChildren"),"\u9636\u6bb5, \u5411\u4e0b\u6784\u9020",r.a.createElement("code",null,"\u6b21\u7ea7\u5b50\u8282\u70b9"),"(\u672c\u793a\u4f8b\u4e2d, ",r.a.createElement("code",null,"div"),"\u6709 2 \u4e2a\u6b21\u7ea7\u5b50\u8282\u70b9)"))),r.a.createElement("li",null,"\u6267\u884c\u540e: \u8fd4\u56de\u4e0b\u7ea7\u8282\u70b9",r.a.createElement("code",null,"fiber(header)"),", \u79fb\u52a8",r.a.createElement("code",null,"workInProgress"),"\u6307\u9488\u6307\u5411\u5b50\u8282\u70b9",r.a.createElement("code",null,"fiber(header)"))),r.a.createElement("p",null,r.a.createElement("img",{src:t("nhQy"),alt:""})),r.a.createElement("p",null,r.a.createElement("code",null,"performUnitOfWork"),"\u7b2c 4 \u6b21\u8c03\u7528(\u6267\u884c",r.a.createElement("code",null,"beginWork"),"\u548c",r.a.createElement("code",null,"completeUnitOfWork"),"):"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"beginWork"),"\u6267\u884c\u524d: ",r.a.createElement("code",null,"workInProgress"),"\u6307\u9488\u6307\u5411",r.a.createElement("code",null,"fiber(header)"),"\u8282\u70b9, \u6b64\u65f6",r.a.createElement("code",null,"current = null")),r.a.createElement("li",null,r.a.createElement("code",null,"beginWork"),"\u6267\u884c\u8fc7\u7a0b: \u8c03\u7528",r.a.createElement("code",null,"updateHostComponent"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u672c\u793a\u4f8b\u4e2d",r.a.createElement("code",null,"header"),"\u7684\u5b50\u8282\u70b9\u662f\u4e00\u4e2a",r.a.createElement(a["Link"],{to:"https://github.com/facebook/react/blob/8e5adfbd7e605bda9c5e96c10e015b3dc0df688e/packages/react-dom/src/client/ReactDOMHostConfig.js#L350-L361"},"\u76f4\u63a5\u6587\u672c\u8282\u70b9"),",\u8bbe\u7f6e",r.a.createElement(a["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberBeginWork.old.js#L1147"},"nextChildren = null"),"(\u76f4\u63a5\u6587\u672c\u8282\u70b9\u5e76\u4e0d\u4f1a\u88ab\u5f53\u6210\u5177\u4f53\u7684",r.a.createElement("code",null,"fiber"),"\u8282\u70b9\u8fdb\u884c\u5904\u7406, \u800c\u662f\u5728\u5bbf\u4e3b\u73af\u5883(\u7236\u7ec4\u4ef6)\u4e2d\u901a\u8fc7\u5c5e\u6027\u8fdb\u884c\u8bbe\u7f6e. \u6240\u4ee5\u65e0\u9700\u521b\u5efa",r.a.createElement("code",null,"HostText"),"\u7c7b\u578b\u7684fiber\u8282\u70b9, \u540c\u65f6\u8282\u7701\u4e86\u5411\u4e0b\u904d\u5386\u5f00\u9500.)."),r.a.createElement("li",null,"\u7531\u4e8e",r.a.createElement("code",null,"nextChildren = null"),", \u7ecf\u8fc7",r.a.createElement("code",null,"reconcileChildren"),"\u9636\u6bb5\u5904\u7406\u540e, \u8fd4\u56de\u503c\u4e5f\u662f",r.a.createElement("code",null,"null")))),r.a.createElement("li",null,r.a.createElement("code",null,"beginWork"),"\u6267\u884c\u540e: \u7531\u4e8e\u4e0b\u7ea7\u8282\u70b9\u4e3a",r.a.createElement("code",null,"null"),", \u6240\u4ee5\u8fdb\u5165",r.a.createElement("code",null,"completeUnitOfWork(unitOfWork)"),"\u51fd\u6570, \u4f20\u5165\u7684\u53c2\u6570",r.a.createElement("code",null,"unitOfWork"),"\u5b9e\u9645\u4e0a\u5c31\u662f",r.a.createElement("code",null,"workInProgress"),"(\u6b64\u65f6\u6307\u5411",r.a.createElement("code",null,"fiber(header)"),"\u8282\u70b9)")),r.a.createElement("p",null,r.a.createElement("img",{src:t("eUcU"),alt:""})),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"completeUnitOfWork"),"\u6267\u884c\u524d: ",r.a.createElement("code",null,"workInProgress"),"\u6307\u9488\u6307\u5411",r.a.createElement("code",null,"fiber(header)"),"\u8282\u70b9"),r.a.createElement("li",null,r.a.createElement("code",null,"completeUnitOfWork"),"\u6267\u884c\u8fc7\u7a0b: \u4ee5",r.a.createElement("code",null,"fiber(header)"),"\u4e3a\u8d77\u70b9, \u5411\u4e0a\u56de\u6eaf")),r.a.createElement("p",null,"\u7b2c 1 \u6b21\u5faa\u73af:"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u6267\u884c",r.a.createElement("code",null,"completeWork"),"\u51fd\u6570",r.a.createElement("ul",null,r.a.createElement("li",null,"\u521b\u5efa",r.a.createElement("code",null,"fiber(header)"),"\u8282\u70b9\u5bf9\u5e94\u7684",r.a.createElement("code",null,"DOM"),"\u5b9e\u4f8b, \u5e76",r.a.createElement("code",null,"append"),"\u5b50\u8282\u70b9\u7684",r.a.createElement("code",null,"DOM"),"\u5b9e\u4f8b"),r.a.createElement("li",null,"\u8bbe\u7f6e",r.a.createElement("code",null,"DOM"),"\u5c5e\u6027, \u7ed1\u5b9a\u4e8b\u4ef6\u7b49(\u672c\u793a\u4f8b\u4e2d, \u8282\u70b9",r.a.createElement("code",null,"fiber(header)"),"\u6ca1\u6709\u4e8b\u4ef6\u7ed1\u5b9a)"))),r.a.createElement("li",null,"\u4e0a\u79fb\u526f\u4f5c\u7528\u961f\u5217: \u7531\u4e8e\u672c\u8282\u70b9",r.a.createElement("code",null,"fiber(header)"),"\u6ca1\u6709\u526f\u4f5c\u7528(",r.a.createElement("code",null,"fiber.flags = 0"),"), \u6240\u4ee5\u6267\u884c\u4e4b\u540e\u526f\u4f5c\u7528\u961f\u5217\u6ca1\u6709\u5b9e\u8d28\u53d8\u5316(\u76ee\u524d\u4e3a\u7a7a)."),r.a.createElement("li",null,"\u5411\u4e0a\u56de\u6eaf: \u7531\u4e8e\u8fd8\u6709\u5144\u5f1f\u8282\u70b9, \u628a",r.a.createElement("code",null,"workInProgress"),"\u6307\u9488\u6307\u5411\u4e0b\u4e00\u4e2a\u5144\u5f1f\u8282\u70b9",r.a.createElement("code",null,"fiber(<Content/>)"),", \u9000\u51fa",r.a.createElement("code",null,"completeUnitOfWork"),".")),r.a.createElement("p",null,r.a.createElement("img",{src:t("6QJa"),alt:""})),r.a.createElement("p",null,r.a.createElement("code",null,"performUnitOfWork"),"\u7b2c 5 \u6b21\u8c03\u7528(\u6267\u884c",r.a.createElement("code",null,"beginWork"),"):"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u6267\u884c\u524d:",r.a.createElement("code",null,"workInProgress"),"\u6307\u9488\u6307\u5411",r.a.createElement("code",null,"fiber(<Content/>)"),"\u8282\u70b9."),r.a.createElement("li",null,"\u6267\u884c\u8fc7\u7a0b: \u8fd9\u662f\u4e00\u4e2a",r.a.createElement("code",null,"class"),"\u7c7b\u578b\u7684\u8282\u70b9, \u4e0e\u7b2c 2 \u6b21\u8c03\u7528\u903b\u8f91\u4e00\u81f4."),r.a.createElement("li",null,"\u6267\u884c\u540e: \u8fd4\u56de\u4e0b\u7ea7\u8282\u70b9",r.a.createElement("code",null,"fiber(p)"),", \u79fb\u52a8",r.a.createElement("code",null,"workInProgress"),"\u6307\u9488\u6307\u5411\u5b50\u8282\u70b9",r.a.createElement("code",null,"fiber(p)"))),r.a.createElement("p",null,r.a.createElement("img",{src:t("k55s"),alt:""})),r.a.createElement("p",null,r.a.createElement("code",null,"performUnitOfWork"),"\u7b2c 6 \u6b21\u8c03\u7528(\u6267\u884c",r.a.createElement("code",null,"beginWork"),"\u548c",r.a.createElement("code",null,"completeUnitOfWork"),"):\u4e0e\u7b2c 4 \u6b21\u8c03\u7528\u4e2d\u521b\u5efa",r.a.createElement("code",null,"fiber(header)"),"\u8282\u70b9\u7684\u903b\u8f91\u4e00\u81f4. \u5148\u540e\u4f1a\u6267\u884c",r.a.createElement("code",null,"beginWork"),"\u548c",r.a.createElement("code",null,"completeUnitOfWork"),", \u6700\u540e\u6784\u9020 DOM \u5b9e\u4f8b, \u5e76\u5c06\u628a",r.a.createElement("code",null,"workInProgress"),"\u6307\u9488\u6307\u5411\u4e0b\u4e00\u4e2a\u5144\u5f1f\u8282\u70b9",r.a.createElement("code",null,"fiber(p)"),"."),r.a.createElement("p",null,r.a.createElement("img",{src:t("FJ8A"),alt:""})),r.a.createElement("p",null,r.a.createElement("code",null,"performUnitOfWork"),"\u7b2c 7 \u6b21\u8c03\u7528(\u6267\u884c",r.a.createElement("code",null,"beginWork"),"\u548c",r.a.createElement("code",null,"completeUnitOfWork"),"):"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"beginWork"),"\u6267\u884c\u8fc7\u7a0b: \u4e0e\u4e0a\u6b21\u8c03\u7528\u4e2d\u521b\u5efa",r.a.createElement("code",null,"fiber(p)"),"\u8282\u70b9\u7684\u903b\u8f91\u4e00\u81f4"),r.a.createElement("li",null,r.a.createElement("code",null,"completeUnitOfWork"),"\u6267\u884c\u8fc7\u7a0b: \u4ee5",r.a.createElement("code",null,"fiber(p)"),"\u4e3a\u8d77\u70b9, \u5411\u4e0a\u56de\u6eaf")),r.a.createElement("p",null,"\u7b2c 1 \u6b21\u5faa\u73af:"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u6267\u884c",r.a.createElement("code",null,"completeWork"),"\u51fd\u6570: \u521b\u5efa",r.a.createElement("code",null,"fiber(p)"),"\u8282\u70b9\u5bf9\u5e94\u7684",r.a.createElement("code",null,"DOM"),"\u5b9e\u4f8b, \u5e76",r.a.createElement("code",null,"append"),"\u5b50\u6811\u8282\u70b9\u7684",r.a.createElement("code",null,"DOM"),"\u5b9e\u4f8b"),r.a.createElement("li",null,"\u4e0a\u79fb\u526f\u4f5c\u7528\u961f\u5217: \u7531\u4e8e\u672c\u8282\u70b9",r.a.createElement("code",null,"fiber(p)"),"\u6ca1\u6709\u526f\u4f5c\u7528, \u6240\u4ee5\u6267\u884c\u4e4b\u540e\u526f\u4f5c\u7528\u961f\u5217\u6ca1\u6709\u5b9e\u8d28\u53d8\u5316(\u76ee\u524d\u4e3a\u7a7a)."),r.a.createElement("li",null,"\u5411\u4e0a\u56de\u6eaf: \u7531\u4e8e\u6ca1\u6709\u5144\u5f1f\u8282\u70b9, \u628a",r.a.createElement("code",null,"workInProgress"),"\u6307\u9488\u6307\u5411\u7236\u8282\u70b9",r.a.createElement("code",null,"fiber(<Content/>)"))),r.a.createElement("p",null,r.a.createElement("img",{src:t("IBpY"),alt:""})),r.a.createElement("p",null,"\u7b2c 2 \u6b21\u5faa\u73af:"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u6267\u884c",r.a.createElement("code",null,"completeWork"),"\u51fd\u6570: class \u7c7b\u578b\u7684\u8282\u70b9\u4e0d\u505a\u5904\u7406"),r.a.createElement("li",null,"\u4e0a\u79fb\u526f\u4f5c\u7528\u961f\u5217:",r.a.createElement("ul",null,r.a.createElement("li",null,"\u672c\u8282\u70b9",r.a.createElement("code",null,"fiber(<Content/>)"),"\u7684",r.a.createElement("code",null,"flags"),"\u6807\u5fd7\u4f4d\u6709\u6539\u52a8(",r.a.createElement("code",null,"completedWork.flags > PerformedWork"),"), \u5c06\u672c\u8282\u70b9\u6dfb\u52a0\u5230\u7236\u8282\u70b9(",r.a.createElement("code",null,"fiber(div)"),")\u7684\u526f\u4f5c\u7528\u961f\u5217\u4e4b\u540e(",r.a.createElement("code",null,"firstEffect"),"\u548c",r.a.createElement("code",null,"lastEffect"),"\u5c5e\u6027\u5206\u522b\u6307\u5411\u526f\u4f5c\u7528\u961f\u5217\u7684\u9996\u90e8\u548c\u5c3e\u90e8)."))),r.a.createElement("li",null,"\u5411\u4e0a\u56de\u6eaf: \u628a",r.a.createElement("code",null,"workInProgress"),"\u6307\u9488\u6307\u5411\u7236\u8282\u70b9",r.a.createElement("code",null,"fiber(div)"))),r.a.createElement("p",null,r.a.createElement("img",{src:t("PAPi"),alt:""})),r.a.createElement("p",null,"\u7b2c 3 \u6b21\u5faa\u73af:"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u6267\u884c",r.a.createElement("code",null,"completeWork"),"\u51fd\u6570: \u521b\u5efa",r.a.createElement("code",null,"fiber(div)"),"\u8282\u70b9\u5bf9\u5e94\u7684",r.a.createElement("code",null,"DOM"),"\u5b9e\u4f8b, \u5e76",r.a.createElement("code",null,"append"),"\u5b50\u6811\u8282\u70b9\u7684",r.a.createElement("code",null,"DOM"),"\u5b9e\u4f8b"),r.a.createElement("li",null,"\u4e0a\u79fb\u526f\u4f5c\u7528\u961f\u5217:",r.a.createElement("ul",null,r.a.createElement("li",null,"\u672c\u8282\u70b9",r.a.createElement("code",null,"fiber(div)"),"\u7684\u526f\u4f5c\u7528\u961f\u5217\u4e0d\u4e3a\u7a7a, \u5c06\u5176\u62fc\u63a5\u5230\u7236\u8282\u70b9",r.a.createElement("code",null,"fiber<App/>"),"\u7684\u526f\u4f5c\u7528\u961f\u5217\u540e\u9762."))),r.a.createElement("li",null,"\u5411\u4e0a\u56de\u6eaf: \u628a",r.a.createElement("code",null,"workInProgress"),"\u6307\u9488\u6307\u5411\u7236\u8282\u70b9",r.a.createElement("code",null,"fiber(<App/>)"))),r.a.createElement("p",null,r.a.createElement("img",{src:t("Fbj6"),alt:""})),r.a.createElement("p",null,"\u7b2c 4 \u6b21\u5faa\u73af:"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u6267\u884c",r.a.createElement("code",null,"completeWork"),"\u51fd\u6570: class \u7c7b\u578b\u7684\u8282\u70b9\u4e0d\u505a\u5904\u7406"),r.a.createElement("li",null,"\u4e0a\u79fb\u526f\u4f5c\u7528\u961f\u5217:",r.a.createElement("ul",null,r.a.createElement("li",null,"\u672c\u8282\u70b9",r.a.createElement("code",null,"fiber(<App/>)"),"\u7684\u526f\u4f5c\u7528\u961f\u5217\u4e0d\u4e3a\u7a7a, \u5c06\u5176\u62fc\u63a5\u5230\u7236\u8282\u70b9",r.a.createElement("code",null,"fiber(HostRootFiber)"),"\u7684\u526f\u4f5c\u7528\u961f\u5217\u4e0a."),r.a.createElement("li",null,"\u672c\u8282\u70b9",r.a.createElement("code",null,"fiber(<App/>)"),"\u7684",r.a.createElement("code",null,"flags"),"\u6807\u5fd7\u4f4d\u6709\u6539\u52a8(",r.a.createElement("code",null,"completedWork.flags > PerformedWork"),"), \u5c06\u672c\u8282\u70b9\u6dfb\u52a0\u5230\u7236\u8282\u70b9",r.a.createElement("code",null,"fiber(HostRootFiber)"),"\u7684\u526f\u4f5c\u7528\u961f\u5217\u4e4b\u540e."),r.a.createElement("li",null,"\u6700\u540e\u961f\u5217\u7684\u987a\u5e8f\u662f",r.a.createElement("code",null,"\u5b50\u8282\u70b9\u5728\u524d, \u672c\u8282\u70b9\u5728\u540e")))),r.a.createElement("li",null,"\u5411\u4e0a\u56de\u6eaf: \u628a",r.a.createElement("code",null,"workInProgress"),"\u6307\u9488\u6307\u5411\u7236\u8282\u70b9",r.a.createElement("code",null,"fiber(HostRootFiber)"))),r.a.createElement("p",null,r.a.createElement("img",{src:t("0/Pd"),alt:""})),r.a.createElement("p",null,"\u7b2c 5 \u6b21\u5faa\u73af:"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u6267\u884c",r.a.createElement("code",null,"completeWork"),"\u51fd\u6570: \u5bf9\u4e8e",r.a.createElement("code",null,"HostRoot"),"\u7c7b\u578b\u7684\u8282\u70b9, \u521d\u6b21\u6784\u9020\u65f6\u8bbe\u7f6e",r.a.createElement(a["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberCompleteWork.old.js#L693"},"workInProgress.flags |= Snapshot")),r.a.createElement("li",null,"\u5411\u4e0a\u56de\u6eaf: \u7531\u4e8e\u7236\u8282\u70b9\u4e3a\u7a7a, \u65e0\u9700\u8fdb\u5165\u5904\u7406\u526f\u4f5c\u7528\u961f\u5217\u7684\u903b\u8f91. \u6700\u540e\u8bbe\u7f6e",r.a.createElement("code",null,"workInProgress=null"),", \u5e76\u9000\u51fa",r.a.createElement("code",null,"completeUnitOfWork"))),r.a.createElement("p",null,r.a.createElement("img",{src:t("czq0"),alt:""})),r.a.createElement("p",null,"\u5230\u6b64\u6574\u4e2a",r.a.createElement("code",null,"fiber\u6811\u6784\u9020\u5faa\u73af"),"\u5df2\u7ecf\u6267\u884c\u5b8c\u6bd5, \u62e5\u6709\u4e00\u68f5\u5b8c\u6574\u7684",r.a.createElement("code",null,"fiber\u6811"),", \u5e76\u4e14\u5728",r.a.createElement("code",null,"fiber\u6811"),"\u7684\u6839\u8282\u70b9\u4e0a\u6302\u8f7d\u4e86\u526f\u4f5c\u7528\u961f\u5217, \u526f\u4f5c\u7528\u961f\u5217\u7684\u987a\u5e8f\u662f\u5c42\u7ea7\u8d8a\u6df1\u5b50\u8282\u70b9\u8d8a\u9760\u524d."),r.a.createElement("p",null,r.a.createElement("code",null,"renderRootSync"),"\u51fd\u6570\u9000\u51fa\u4e4b\u524d, \u4f1a\u91cd\u7f6e",r.a.createElement("code",null,"workInProgressRoot = null"),", \u8868\u660e\u6ca1\u6709\u6b63\u5728\u8fdb\u884c\u4e2d\u7684",r.a.createElement("code",null,"render"),". \u4e14\u628a\u6700\u65b0\u7684",r.a.createElement("code",null,"fiber\u6811"),"\u6302\u8f7d\u5230",r.a.createElement("code",null,"fiberRoot.finishedWork"),"\u4e0a. \u8fd9\u65f6\u6574\u4e2a fiber \u6811\u7684\u5185\u5b58\u7ed3\u6784\u5982\u4e0b(\u6ce8\u610f",r.a.createElement("code",null,"fiberRoot.finishedWork"),"\u548c",r.a.createElement("code",null,"fiberRoot.current"),"\u6307\u9488,\u5728",r.a.createElement("code",null,"commitRoot"),"\u9636\u6bb5\u4f1a\u8fdb\u884c\u5904\u7406):"),r.a.createElement("p",null,r.a.createElement("img",{src:t("EHsg"),alt:""})),r.a.createElement("h2",{id:"\u603b\u7ed3"},r.a.createElement(a["AnchorLink"],{to:"#\u603b\u7ed3","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u603b\u7ed3"),r.a.createElement("p",null,"\u672c\u8282\u6f14\u793a\u4e86\u521d\u6b21\u521b\u5efa",r.a.createElement("code",null,"fiber\u6811"),"\u7684\u5168\u90e8\u8fc7\u7a0b, \u8ddf\u8e2a\u4e86\u521b\u5efa\u8fc7\u7a0b\u4e2d\u5185\u5b58\u5f15\u7528\u7684\u53d8\u5316\u60c5\u51b5. ",r.a.createElement("code",null,"fiber\u6811\u6784\u9020\u5faa\u73af"),"\u8d1f\u8d23\u6784\u9020\u65b0\u7684",r.a.createElement("code",null,"fiber"),"\u6811, \u6784\u9020\u8fc7\u7a0b\u4e2d\u540c\u65f6\u6807\u8bb0",r.a.createElement("code",null,"fiber.flags"),", \u6700\u7ec8\u628a\u6240\u6709\u88ab\u6807\u8bb0\u7684",r.a.createElement("code",null,"fiber"),"\u8282\u70b9\u6536\u96c6\u5230\u4e00\u4e2a\u526f\u4f5c\u7528\u961f\u5217\u4e2d, \u8fd9\u4e2a\u526f\u4f5c\u7528\u961f\u5217\u88ab\u6302\u8f7d\u5230\u6839\u8282\u70b9\u4e0a(",r.a.createElement("code",null,"HostRootFiber.alternate.firstEffect"),"). \u6b64\u65f6\u7684",r.a.createElement("code",null,"fiber\u6811"),"\u548c\u4e0e\u4e4b\u5bf9\u5e94\u7684",r.a.createElement("code",null,"DOM\u8282\u70b9"),"\u90fd\u8fd8\u5728\u5185\u5b58\u5f53\u4e2d, \u7b49\u5f85",r.a.createElement("code",null,"commitRoot"),"\u9636\u6bb5\u8fdb\u884c\u6e32\u67d3.")))}));n["default"]=e=>{var n=r.a.useContext(a["context"]),t=n.demos;return r.a.useEffect((()=>{var n;null!==e&&void 0!==e&&null!==(n=e.location)&&void 0!==n&&n.hash&&a["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(c,{demos:t})}},k55s:function(e,n,t){e.exports=t.p+"static/unitofwork5.978ffcd8.png"},nhQy:function(e,n,t){e.exports=t.p+"static/unitofwork3.bb0b3a60.png"},pQdL:function(e,n,t){e.exports=t.p+"static/process-legacy.a0ae413a.png"},qW7x:function(e,n,t){e.exports=t.p+"static/update-container.c77fb762.png"}}]);