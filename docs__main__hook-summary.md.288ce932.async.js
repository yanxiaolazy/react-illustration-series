(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[21],{"7tmu":function(e,n,t){e.exports=t.p+"static/update-before-renderwithhooks.90d66ec2.png"},DHRg:function(e,n,t){e.exports=t.p+"static/hook-linkedlist.bedadbac.png"},DcOI:function(e,n,t){e.exports=t.p+"static/mount-before-renderwithhooks.983b031b.png"},MZF8:function(e,n,t){"use strict";var l=t("ogwx");t.d(n,"a",(function(){return l["b"]}));t("VCU9")},dAi1:function(e,n,t){"use strict";t.r(n);var l=t("q1tI"),a=t.n(l),o=t("dEAq"),r=t("Zxc8"),c=t("H1Ra"),u=a.a.memo((e=>{var n=e.demos,l=n["hook-summary-demo"].component;return a.a.createElement(a.a.Fragment,null,a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"markdown"},a.a.createElement("h1",{id:"hook-\u539f\u7406\u6982\u89c8"},a.a.createElement(o["AnchorLink"],{to:"#hook-\u539f\u7406\u6982\u89c8","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"Hook \u539f\u7406(\u6982\u89c8)"),a.a.createElement("p",null,"\u5728\u524d\u6587",a.a.createElement(o["Link"],{to:"./state-effects"},"\u72b6\u6001\u4e0e\u526f\u4f5c\u7528"),"\u4e2d, \u603b\u7ed3\u4e86",a.a.createElement("code",null,"class\u7ec4\u4ef6, function\u7ec4\u4ef6"),"\u4e2d\u901a\u8fc7",a.a.createElement("code",null,"api"),"\u53bb\u6539\u53d8",a.a.createElement("code",null,"fiber\u8282\u70b9"),"\u7684",a.a.createElement("code",null,"\u72b6\u6001"),"\u548c",a.a.createElement("code",null,"\u526f\u4f5c\u7528"),". \u5176\u4e2d\u5bf9\u4e8e",a.a.createElement("code",null,"function\u7ec4\u4ef6"),"\u6765\u8bb2, \u5176\u5185\u90e8\u5219\u9700\u8981\u4f9d\u9760",a.a.createElement("code",null,"Hook"),"\u6765\u5b9e\u73b0."),a.a.createElement("p",null,"\u5b98\u65b9\u6587\u6863\u4e0a\u4e13\u95e8\u7528\u4e86\u4e00\u4e2a\u7248\u5757\u6765\u4ecb\u7ecd",a.a.createElement(o["Link"],{to:"https://zh-hans.reactjs.org/docs/hooks-intro.html"},"Hook"),", \u8fd9\u91cc\u6458\u6284\u4e86\u51e0\u4e2a\u6bd4\u8f83\u5173\u5fc3\u7684\u95ee\u9898(\u5176\u4ed6",a.a.createElement("code",null,"FAQ"),"\u8bf7\u79fb\u6b65\u5b98\u7f51):"),a.a.createElement("ol",null,a.a.createElement("li",null,a.a.createElement("p",null,a.a.createElement(o["Link"],{to:"https://zh-hans.reactjs.org/docs/hooks-intro.html#motivation"},"\u5f15\u5165",a.a.createElement("code",null,"Hook"),"\u7684\u52a8\u673a?")),a.a.createElement("ul",null,a.a.createElement("li",null,"\u5728\u7ec4\u4ef6\u4e4b\u95f4\u590d\u7528\u72b6\u6001\u903b\u8f91\u5f88\u96be; \u590d\u6742\u7ec4\u4ef6\u53d8\u5f97\u96be\u4ee5\u7406\u89e3; \u96be\u4ee5\u7406\u89e3\u7684 class. \u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e9b\u5b9e\u9645\u5f00\u53d1\u75db\u70b9, \u5f15\u5165\u4e86",a.a.createElement("code",null,"Hook"),"."))),a.a.createElement("li",null,a.a.createElement("p",null,a.a.createElement(o["Link"],{to:"https://zh-hans.reactjs.org/docs/hooks-state.html#whats-a-hook"},a.a.createElement("code",null,"Hook")," \u662f\u4ec0\u4e48? \u4ec0\u4e48\u65f6\u5019\u4f1a\u7528 ",a.a.createElement("code",null,"Hook"),"?")),a.a.createElement("ul",null,a.a.createElement("li",null,a.a.createElement("code",null,"Hook")," \u662f\u4e00\u4e2a\u7279\u6b8a\u7684\u51fd\u6570, \u5b83\u53ef\u4ee5\u8ba9\u4f60\u201c\u94a9\u5165\u201d ",a.a.createElement("code",null,"React")," \u7684\u7279\u6027. \u5982, ",a.a.createElement("code",null,"useState")," \u662f\u5141\u8bb8\u4f60\u5728 ",a.a.createElement("code",null,"React")," \u51fd\u6570\u7ec4\u4ef6\u4e2d\u6dfb\u52a0 ",a.a.createElement("code",null,"state")," \u7684 ",a.a.createElement("code",null,"Hook"),"."),a.a.createElement("li",null,"\u5982\u679c\u4f60\u5728\u7f16\u5199\u51fd\u6570\u7ec4\u4ef6\u5e76\u610f\u8bc6\u5230\u9700\u8981\u5411\u5176\u6dfb\u52a0\u4e00\u4e9b ",a.a.createElement("code",null,"state"),", \u4ee5\u524d\u7684\u505a\u6cd5\u662f\u5fc5\u987b\u5c06\u5176\u8f6c\u5316\u4e3a ",a.a.createElement("code",null,"class"),". \u73b0\u5728\u4f60\u53ef\u4ee5\u5728\u73b0\u6709\u7684\u51fd\u6570\u7ec4\u4ef6\u4e2d\u4f7f\u7528 ",a.a.createElement("code",null,"Hook"),"."))),a.a.createElement("li",null,a.a.createElement("p",null,a.a.createElement(o["Link"],{to:"https://zh-hans.reactjs.org/docs/hooks-faq.html#are-hooks-slow-because-of-creating-functions-in-render"},a.a.createElement("code",null,"Hook")," \u4f1a\u56e0\u4e3a\u5728\u6e32\u67d3\u65f6\u521b\u5efa\u51fd\u6570\u800c\u53d8\u6162\u5417?")),a.a.createElement("ul",null,a.a.createElement("li",null,"\u4e0d\u4f1a. \u5728\u73b0\u4ee3\u6d4f\u89c8\u5668\u4e2d,\u95ed\u5305\u548c\u7c7b\u7684\u539f\u59cb\u6027\u80fd\u53ea\u6709\u5728\u6781\u7aef\u573a\u666f\u4e0b\u624d\u4f1a\u6709\u660e\u663e\u7684\u5dee\u522b. \u9664\u6b64\u4e4b\u5916,\u53ef\u4ee5\u8ba4\u4e3a ",a.a.createElement("code",null,"Hook")," \u7684\u8bbe\u8ba1\u5728\u67d0\u4e9b\u65b9\u9762\u66f4\u52a0\u9ad8\u6548:",a.a.createElement("ul",null,a.a.createElement("li",null,a.a.createElement("code",null,"Hook")," \u907f\u514d\u4e86 ",a.a.createElement("code",null,"class")," \u9700\u8981\u7684\u989d\u5916\u5f00\u652f,\u50cf\u662f\u521b\u5efa\u7c7b\u5b9e\u4f8b\u548c\u5728\u6784\u9020\u51fd\u6570\u4e2d\u7ed1\u5b9a\u4e8b\u4ef6\u5904\u7406\u5668\u7684\u6210\u672c."),a.a.createElement("li",null,"\u7b26\u5408\u8bed\u8a00\u4e60\u60ef\u7684\u4ee3\u7801\u5728\u4f7f\u7528 ",a.a.createElement("code",null,"Hook")," \u65f6\u4e0d\u9700\u8981\u5f88\u6df1\u7684\u7ec4\u4ef6\u6811\u5d4c\u5957. \u8fd9\u4e2a\u73b0\u8c61\u5728\u4f7f\u7528",a.a.createElement("code",null,"\u9ad8\u9636\u7ec4\u4ef6"),"\u3001",a.a.createElement("code",null,"render props"),"\u3001\u548c ",a.a.createElement("code",null,"context")," \u7684\u4ee3\u7801\u5e93\u4e2d\u975e\u5e38\u666e\u904d. \u7ec4\u4ef6\u6811\u5c0f\u4e86, ",a.a.createElement("code",null,"React")," \u7684\u5de5\u4f5c\u91cf\u4e5f\u968f\u4e4b\u51cf\u5c11.")))))),a.a.createElement("p",null,"\u6240\u4ee5",a.a.createElement("code",null,"Hook"),"\u662f",a.a.createElement("code",null,"React"),"\u56e2\u961f\u5728\u5927\u91cf\u5b9e\u8df5\u540e\u7684\u4ea7\u7269, \u66f4\u4f18\u96c5\u7684\u4ee3\u66ff",a.a.createElement("code",null,"class"),", \u4e14\u6027\u80fd\u66f4\u9ad8. \u6545\u4ece\u5f00\u53d1\u4f7f\u7528\u8005\u7684\u89d2\u5ea6\u6765\u8bb2, \u5e94\u8be5\u62e5\u62b1",a.a.createElement("code",null,"Hook"),"\u6240\u5e26\u6765\u7684\u4fbf\u5229."),a.a.createElement("h2",{id:"hook-\u4e0e-fiber"},a.a.createElement(o["AnchorLink"],{to:"#hook-\u4e0e-fiber","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"Hook \u4e0e Fiber"),a.a.createElement("p",null,"\u901a\u8fc7\u5b98\u7f51\u6587\u6863\u7684\u8bb2\u89e3, \u80fd\u5feb\u901f\u638c\u63e1",a.a.createElement("code",null,"Hook"),"\u7684\u4f7f\u7528. \u518d\u7ed3\u5408\u524d\u6587",a.a.createElement(o["Link"],{to:"./state-effects"},"\u72b6\u6001\u4e0e\u526f\u4f5c\u7528"),"\u7684\u4ecb\u7ecd, \u6211\u4eec\u77e5\u9053\u4f7f\u7528",a.a.createElement("code",null,"Hook"),"\u6700\u7ec8\u4e5f\u662f\u4e3a\u4e86\u63a7\u5236",a.a.createElement("code",null,"fiber\u8282\u70b9"),"\u7684",a.a.createElement("code",null,"\u72b6\u6001"),"\u548c",a.a.createElement("code",null,"\u526f\u4f5c\u7528"),". \u4ece",a.a.createElement("code",null,"fiber"),"\u89c6\u89d2, \u72b6\u6001\u548c\u526f\u4f5c\u7528\u76f8\u5173\u7684\u5c5e\u6027\u5982\u4e0b(\u8fd9\u91cc\u4e0d\u518d\u89e3\u91ca\u5355\u4e2a\u5c5e\u6027\u7684\u610f\u4e49, \u53ef\u4ee5\u56de\u987e",a.a.createElement(o["Link"],{to:"./state-effects"},"\u72b6\u6001\u4e0e\u526f\u4f5c\u7528"),"):"),a.a.createElement(c["a"],{code:"export type Fiber = {|\n  // 1. fiber\u8282\u70b9\u81ea\u8eab\u72b6\u6001\u76f8\u5173\n  pendingProps: any,\n  memoizedProps: any,\n  updateQueue: mixed,\n  memoizedState: any,\n\n  // 2. fiber\u8282\u70b9\u526f\u4f5c\u7528(Effect)\u76f8\u5173\n  flags: Flags,\n  nextEffect: Fiber | null,\n  firstEffect: Fiber | null,\n  lastEffect: Fiber | null,\n|};",lang:"js"}),a.a.createElement("p",null,"\u4f7f\u7528",a.a.createElement("code",null,"Hook"),"\u7684\u4efb\u610f\u4e00\u4e2a",a.a.createElement("code",null,"api"),", \u6700\u540e\u90fd\u662f\u4e3a\u4e86\u63a7\u5236\u4e0a\u8ff0\u8fd9\u51e0\u4e2a",a.a.createElement("code",null,"fiber\u5c5e\u6027"),"."),a.a.createElement("h2",{id:"hook-\u6570\u636e\u7ed3\u6784"},a.a.createElement(o["AnchorLink"],{to:"#hook-\u6570\u636e\u7ed3\u6784","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"Hook \u6570\u636e\u7ed3\u6784"),a.a.createElement("p",null,"\u5728",a.a.createElement(o["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberHooks.old.js#L95-L140"},"ReactFiberHooks"),"\u4e2d, \u5b9a\u4e49\u4e86",a.a.createElement("code",null,"Hook"),"\u7684\u6570\u636e\u7ed3\u6784:"),a.a.createElement(c["a"],{code:"type Update<S, A> = {|\n  lane: Lane,\n  action: A,\n  eagerReducer: ((S, A) => S) | null,\n  eagerState: S | null,\n  next: Update<S, A>,\n  priority?: ReactPriorityLevel,\n|};\n\ntype UpdateQueue<S, A> = {|\n  pending: Update<S, A> | null,\n  dispatch: (A => mixed) | null,\n  lastRenderedReducer: ((S, A) => S) | null,\n  lastRenderedState: S | null,\n|};\n\nexport type Hook = {|\n  memoizedState: any, // \u5f53\u524d\u72b6\u6001\n  baseState: any, // \u57fa\u72b6\u6001\n  baseQueue: Update<any, any> | null, // \u57fa\u961f\u5217\n  queue: UpdateQueue<any, any> | null, // \u66f4\u65b0\u961f\u5217\n  next: Hook | null, // next\u6307\u9488\n|};",lang:"js"}),a.a.createElement("p",null,"\u4ece\u5b9a\u4e49\u6765\u770b, ",a.a.createElement("code",null,"Hook"),"\u5bf9\u8c61\u5171\u6709 5 \u4e2a\u5c5e\u6027(\u6709\u5173\u8fd9\u4e9b\u5c5e\u6027\u7684\u5e94\u7528, \u5c06\u5728",a.a.createElement("code",null,"Hook \u539f\u7406(\u72b6\u6001)"),"\u7ae0\u8282\u4e2d\u5177\u4f53\u5206\u6790.):"),a.a.createElement("ol",null,a.a.createElement("li",null,a.a.createElement("code",null,"hook.memoizedState"),": \u4fdd\u6301\u5728\u5185\u5b58\u4e2d\u7684\u5c40\u90e8\u72b6\u6001."),a.a.createElement("li",null,a.a.createElement("code",null,"hook.baseState"),": ",a.a.createElement("code",null,"hook.baseQueue"),"\u4e2d\u6240\u6709",a.a.createElement("code",null,"update"),"\u5bf9\u8c61\u5408\u5e76\u4e4b\u540e\u7684\u72b6\u6001."),a.a.createElement("li",null,a.a.createElement("code",null,"hook.baseQueue"),": \u5b58\u50a8",a.a.createElement("code",null,"update\u5bf9\u8c61"),"\u7684\u73af\u5f62\u94fe\u8868, \u53ea\u5305\u62ec\u9ad8\u4e8e\u672c\u6b21\u6e32\u67d3\u4f18\u5148\u7ea7\u7684",a.a.createElement("code",null,"update\u5bf9\u8c61"),"."),a.a.createElement("li",null,a.a.createElement("code",null,"hook.queue"),": \u5b58\u50a8",a.a.createElement("code",null,"update\u5bf9\u8c61"),"\u7684\u73af\u5f62\u94fe\u8868, \u5305\u62ec\u6240\u6709\u4f18\u5148\u7ea7\u7684",a.a.createElement("code",null,"update\u5bf9\u8c61"),"."),a.a.createElement("li",null,a.a.createElement("code",null,"hook.next"),": ",a.a.createElement("code",null,"next"),"\u6307\u9488, \u6307\u5411\u94fe\u8868\u4e2d\u7684\u4e0b\u4e00\u4e2a",a.a.createElement("code",null,"hook"),".")),a.a.createElement("p",null,"\u6240\u4ee5",a.a.createElement("code",null,"Hook"),"\u662f\u4e00\u4e2a\u94fe\u8868, \u5355\u4e2a",a.a.createElement("code",null,"Hook"),"\u62e5\u6709\u81ea\u5df1\u7684\u72b6\u6001",a.a.createElement("code",null,"hook.memoizedState"),"\u548c\u81ea\u5df1\u7684\u66f4\u65b0\u961f\u5217",a.a.createElement("code",null,"hook.queue"),"(\u6709\u5173 Hook \u72b6\u6001\u7684\u5206\u6790, \u5728",a.a.createElement("code",null,"Hook\u539f\u7406(\u72b6\u6001)"),"\u7ae0\u8282\u4e2d\u89e3\u8bfb)."),a.a.createElement("p",null,a.a.createElement("img",{src:t("DHRg"),alt:""})),a.a.createElement("p",null,"\u6ce8\u610f: \u5176\u4e2d",a.a.createElement("code",null,"hook.queue"),"\u4e0e",a.a.createElement("code",null,"fiber.updateQueue"),"\u867d\u7136\u90fd\u662f",a.a.createElement("code",null,"update\u73af\u5f62\u94fe\u8868"),", \u5c3d\u7ba1",a.a.createElement("code",null,"update\u5bf9\u8c61"),"\u7684\u6570\u636e\u7ed3\u6784\u4e0e\u5904\u7406\u65b9\u5f0f\u90fd\u9ad8\u5ea6\u76f8\u4f3c, \u4f46\u662f\u8fd9 2 \u4e2a\u961f\u5217\u4e2d\u7684",a.a.createElement("code",null,"update\u5bf9\u8c61"),"\u662f\u5b8c\u5168\u72ec\u7acb\u7684. ",a.a.createElement("code",null,"hook.queue"),"\u53ea\u4f5c\u7528\u4e8e",a.a.createElement("code",null,"hook\u5bf9\u8c61"),"\u7684\u72b6\u6001\u7ef4\u62a4, \u5207\u52ff\u4e0e",a.a.createElement("code",null,"fiber.updateQueue"),"\u6df7\u6dc6."),a.a.createElement("h2",{id:"hook-\u5206\u7c7b"},a.a.createElement(o["AnchorLink"],{to:"#hook-\u5206\u7c7b","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"Hook \u5206\u7c7b"),a.a.createElement("p",null,"\u5728",a.a.createElement("code",null,"v17.0.2"),"\u4e2d, \u5171\u5b9a\u4e49\u4e86",a.a.createElement(o["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberHooks.old.js#L111-L125"},"14 \u79cd Hook")),a.a.createElement(c["a"],{code:"export type HookType =\n  | 'useState'\n  | 'useReducer'\n  | 'useContext'\n  | 'useRef'\n  | 'useEffect'\n  | 'useLayoutEffect'\n  | 'useCallback'\n  | 'useMemo'\n  | 'useImperativeHandle'\n  | 'useDebugValue'\n  | 'useDeferredValue'\n  | 'useTransition'\n  | 'useMutableSource'\n  | 'useOpaqueIdentifier';",lang:"js"}),a.a.createElement("p",null,"\u5b98\u7f51\u4e0a\u5df2\u7ecf\u5c06\u5176\u5206\u4e3a\u4e86 2 \u4e2a\u7c7b\u522b, \u72b6\u6001",a.a.createElement("code",null,"Hook"),"(",a.a.createElement("code",null,"State Hook"),"), \u548c\u526f\u4f5c\u7528",a.a.createElement("code",null,"Hook"),"(",a.a.createElement("code",null,"Effect Hook"),")."),a.a.createElement("p",null,"\u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u7ed3\u5408\u524d\u6587",a.a.createElement(o["Link"],{to:"./state-effects"},"\u72b6\u6001\u4e0e\u526f\u4f5c\u7528"),", \u4ece",a.a.createElement("code",null,"fiber"),"\u7684\u89c6\u89d2\u53bb\u7406\u89e3",a.a.createElement("code",null,"\u72b6\u6001Hook"),"\u4e0e",a.a.createElement("code",null,"\u526f\u4f5c\u7528Hook"),"\u7684\u533a\u522b."),a.a.createElement("h3",{id:"\u72b6\u6001-hook"},a.a.createElement(o["AnchorLink"],{to:"#\u72b6\u6001-hook","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"\u72b6\u6001 Hook"),a.a.createElement("p",null,"\u72ed\u4e49\u4e0a\u8bb2, ",a.a.createElement("code",null,"useState, useReducer"),"\u53ef\u4ee5\u5728",a.a.createElement("code",null,"function\u7ec4\u4ef6"),"\u6dfb\u52a0\u5185\u90e8\u7684",a.a.createElement("code",null,"state"),", \u4e14",a.a.createElement("code",null,"useState"),"\u5b9e\u9645\u4e0a\u662f",a.a.createElement("code",null,"useReducer"),"\u7684\u7b80\u6613\u5c01\u88c5, \u662f\u4e00\u4e2a\u6700\u7279\u6b8a(\u7b80\u5355)\u7684",a.a.createElement("code",null,"useReducer"),". \u6240\u4ee5\u5c06",a.a.createElement("code",null,"useState, useReducer"),"\u79f0\u4e3a",a.a.createElement("code",null,"\u72b6\u6001Hook"),"."),a.a.createElement("p",null,"\u5e7f\u4e49\u4e0a\u8bb2, \u53ea\u8981\u80fd\u5b9e\u73b0\u6570\u636e\u6301\u4e45\u5316",a.a.createElement("code",null,"\u4e14\u6ca1\u6709\u526f\u4f5c\u7528"),"\u7684",a.a.createElement("code",null,"Hook"),", \u5747\u53ef\u4ee5\u89c6\u4e3a",a.a.createElement("code",null,"\u72b6\u6001Hook"),", \u6240\u4ee5\u8fd8\u5305\u62ec",a.a.createElement("code",null,"useContext, useRef, useCallback, useMemo"),"\u7b49. \u8fd9\u7c7b",a.a.createElement("code",null,"Hook"),"\u5185\u90e8\u6ca1\u6709\u4f7f\u7528",a.a.createElement("code",null,"useState/useReducer"),", \u4f46\u662f\u5b83\u4eec\u4e5f\u80fd\u5b9e\u73b0\u591a\u6b21",a.a.createElement("code",null,"render"),"\u65f6, \u4fdd\u6301\u5176\u521d\u59cb\u503c\u4e0d\u53d8(\u5373\u6570\u636e\u6301\u4e45\u5316)\u4e14\u6ca1\u6709\u4efb\u4f55",a.a.createElement("code",null,"\u526f\u4f5c\u7528"),"."),a.a.createElement("p",null,"\u5f97\u76ca\u4e8e",a.a.createElement(o["AnchorLink"],{to:"./fibertree-prepare#%E5%8F%8C%E7%BC%93%E5%86%B2%E6%8A%80%E6%9C%AF"},"\u53cc\u7f13\u51b2\u6280\u672f(double buffering)"),", \u5728\u591a\u6b21",a.a.createElement("code",null,"render"),"\u65f6, \u4ee5",a.a.createElement("code",null,"fiber"),"\u4e3a\u8f7d\u4f53, \u4fdd\u8bc1\u590d\u7528\u540c\u4e00\u4e2a",a.a.createElement("code",null,"Hook"),"\u5bf9\u8c61, \u8fdb\u800c\u5b9e\u73b0\u6570\u636e\u6301\u4e45\u5316. \u5177\u4f53\u5b9e\u73b0\u7ec6\u8282, \u5728",a.a.createElement("code",null,"Hook\u539f\u7406(\u72b6\u6001)"),"\u7ae0\u8282\u4e2d\u8ba8\u8bba."),a.a.createElement("h3",{id:"\u526f\u4f5c\u7528-hook"},a.a.createElement(o["AnchorLink"],{to:"#\u526f\u4f5c\u7528-hook","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"\u526f\u4f5c\u7528 Hook"),a.a.createElement("p",null,"\u56de\u5230",a.a.createElement("code",null,"fiber"),"\u89c6\u89d2, ",a.a.createElement("code",null,"\u72b6\u6001Hook"),"\u5b9e\u73b0\u4e86\u72b6\u6001\u6301\u4e45\u5316(\u7b49\u540c\u4e8e",a.a.createElement("code",null,"class\u7ec4\u4ef6"),"\u7ef4\u62a4",a.a.createElement("code",null,"fiber.memoizedState"),"), \u90a3\u4e48",a.a.createElement("code",null,"\u526f\u4f5c\u7528Hook"),"\u5219\u4f1a\u4fee\u6539",a.a.createElement("code",null,"fiber.flags"),". (\u901a\u8fc7\u524d\u6587",a.a.createElement("code",null,"fiber\u6811\u6784\u9020"),"\u7cfb\u5217\u7684\u89e3\u8bfb, \u6211\u4eec\u77e5\u9053\u5728",a.a.createElement("code",null,"performUnitOfWork->completeWork"),"\u9636\u6bb5, \u6240\u6709\u5b58\u5728\u526f\u4f5c\u7528\u7684",a.a.createElement("code",null,"fiber"),"\u8282\u70b9, \u90fd\u4f1a\u88ab\u6dfb\u52a0\u5230\u7236\u8282\u70b9\u7684",a.a.createElement("code",null,"\u526f\u4f5c\u7528\u961f\u5217"),"\u540e, \u6700\u540e\u5728",a.a.createElement("code",null,"commitRoot"),"\u9636\u6bb5\u5904\u7406\u8fd9\u4e9b",a.a.createElement("code",null,"\u526f\u4f5c\u7528\u8282\u70b9"),".)"),a.a.createElement("p",null,"\u53e6\u5916, ",a.a.createElement("code",null,"\u526f\u4f5c\u7528Hook"),"\u8fd8\u63d0\u4f9b\u4e86",a.a.createElement("code",null,"\u526f\u4f5c\u7528\u56de\u8c03"),"(\u7c7b\u4f3c\u4e8e",a.a.createElement("code",null,"class\u7ec4\u4ef6"),"\u7684\u751f\u547d\u5468\u671f\u56de\u8c03), \u6bd4\u5982:"),a.a.createElement(c["a"],{code:"// \u4f7f\u7528useEffect\u65f6, \u9700\u8981\u4f20\u5165\u4e00\u4e2a\u526f\u4f5c\u7528\u56de\u8c03\u51fd\u6570.\n// \u5728fiber\u6811\u6784\u9020\u5b8c\u6210\u4e4b\u540e, commitRoot\u9636\u6bb5\u4f1a\u5904\u7406\u8fd9\u4e9b\u526f\u4f5c\u7528\u56de\u8c03\nuseEffect(() => {\n  console.log('\u8fd9\u662f\u4e00\u4e2a\u526f\u4f5c\u7528\u56de\u8c03\u51fd\u6570');\n}, []);",lang:"js"}),a.a.createElement("p",null,"\u5728",a.a.createElement("code",null,"react"),"\u5185\u90e8, ",a.a.createElement("code",null,"useEffect"),"\u5c31\u662f\u6700\u6807\u51c6\u7684",a.a.createElement("code",null,"\u526f\u4f5c\u7528Hook"),". \u5176\u4ed6\u6bd4\u5982",a.a.createElement("code",null,"useLayoutEffect"),"\u4ee5\u53ca",a.a.createElement("code",null,"\u81ea\u5b9a\u4e49Hook"),", \u5982\u679c\u8981\u5b9e\u73b0",a.a.createElement("code",null,"\u526f\u4f5c\u7528"),", \u5fc5\u987b\u76f4\u63a5\u6216\u95f4\u63a5\u7684\u8c03\u7528",a.a.createElement("code",null,"useEffect"),"."),a.a.createElement("p",null,"\u6709\u5173",a.a.createElement("code",null,"useEffect"),"\u5177\u4f53\u5b9e\u73b0\u7ec6\u8282, \u5728",a.a.createElement("code",null,"Hook\u539f\u7406(\u526f\u4f5c\u7528)"),"\u7ae0\u8282\u4e2d\u8ba8\u8bba."),a.a.createElement("h3",{id:"\u7ec4\u5408-hook"},a.a.createElement(o["AnchorLink"],{to:"#\u7ec4\u5408-hook","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"\u7ec4\u5408 Hook"),a.a.createElement("p",null,"\u867d\u7136\u5b98\u7f51\u5e76\u65e0",a.a.createElement("code",null,"\u7ec4\u5408Hook"),"\u7684\u8bf4\u6cd5, \u4f46\u4e8b\u5b9e\u4e0a\u5927\u591a\u6570",a.a.createElement("code",null,"Hook"),"(\u5305\u62ec\u81ea\u5b9a\u4e49",a.a.createElement("code",null,"Hook"),")\u90fd\u662f\u7531\u4e0a\u8ff0 2 \u79cd ",a.a.createElement("code",null,"Hook"),"\u7ec4\u5408\u800c\u6210, \u540c\u65f6\u62e5\u6709\u8fd9 2 \u79cd Hook \u7684\u7279\u6027."),a.a.createElement("ul",null,a.a.createElement("li",null,"\u5728",a.a.createElement("code",null,"react"),"\u5185\u90e8\u6709",a.a.createElement("code",null,"useDeferredValue, useTransition, useMutableSource, useOpaqueIdentifier"),"\u7b49."),a.a.createElement("li",null,"\u5e73\u65f6\u5f00\u53d1\u4e2d, ",a.a.createElement("code",null,"\u81ea\u5b9a\u4e49Hook"),"\u5927\u90e8\u5206\u90fd\u662f\u7ec4\u5408 Hook.")),a.a.createElement("p",null,"\u6bd4\u5982\u5b98\u7f51\u4e0a\u7684",a.a.createElement(o["Link"],{to:"https://zh-hans.reactjs.org/docs/hooks-custom.html#extracting-a-custom-hook"},"\u81ea\u5b9a\u4e49 Hook"),"\u4f8b\u5b50:"),a.a.createElement(c["a"],{code:"import { useState, useEffect } from 'react';\n\nfunction useFriendStatus(friendID) {\n  // 1. \u8c03\u7528useState, \u521b\u5efa\u4e00\u4e2a\u72b6\u6001Hook\n  const [isOnline, setIsOnline] = useState(null);\n\n  // 2. \u8c03\u7528useEffect, \u521b\u5efa\u4e00\u4e2a\u526f\u4f5c\u7528Hook\n  useEffect(() => {\n    function handleStatusChange(status) {\n      setIsOnline(status.isOnline);\n    }\n    ChatAPI.subscribeToFriendStatus(friendID, handleStatusChange);\n    return () => {\n      ChatAPI.unsubscribeFromFriendStatus(friendID, handleStatusChange);\n    };\n  });\n  return isOnline;\n}",lang:"js"}),a.a.createElement("h2",{id:"\u8c03\u7528-function-\u524d"},a.a.createElement(o["AnchorLink"],{to:"#\u8c03\u7528-function-\u524d","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"\u8c03\u7528 function \u524d"),a.a.createElement("p",null,"\u5728\u8c03\u7528",a.a.createElement("code",null,"function"),"\u4e4b\u524d, ",a.a.createElement("code",null,"react"),"\u5185\u90e8\u8fd8\u9700\u8981\u63d0\u524d\u505a\u4e00\u4e9b\u51c6\u5907\u5de5\u4f5c."),a.a.createElement("h3",{id:"\u5904\u7406\u51fd\u6570"},a.a.createElement(o["AnchorLink"],{to:"#\u5904\u7406\u51fd\u6570","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"\u5904\u7406\u51fd\u6570"),a.a.createElement("p",null,"\u4ece",a.a.createElement("code",null,"fiber\u6811\u6784\u9020"),"\u7684\u89c6\u89d2\u6765\u770b, \u4e0d\u540c\u7684",a.a.createElement("code",null,"fiber"),"\u7c7b\u578b, \u53ea\u9700\u8981\u8c03\u7528\u4e0d\u540c\u7684",a.a.createElement("code",null,"\u5904\u7406\u51fd\u6570"),"\u8fd4\u56de",a.a.createElement("code",null,"fiber\u5b50\u8282\u70b9"),". \u6240\u4ee5\u5728",a.a.createElement(o["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberBeginWork.old.js#L3340-L3354"},"performUnitOfWork->beginWork"),"\u51fd\u6570\u4e2d, \u8c03\u7528\u4e86\u591a\u79cd",a.a.createElement("code",null,"\u5904\u7406\u51fd\u6570"),". \u4ece\u8c03\u7528\u65b9\u6765\u8bb2, \u65e0\u9700\u5173\u5fc3",a.a.createElement("code",null,"\u5904\u7406\u51fd\u6570"),"\u7684\u5185\u90e8\u5b9e\u73b0(\u6bd4\u5982",a.a.createElement("code",null,"updateFunctionComponent"),"\u5185\u90e8\u4f7f\u7528\u4e86",a.a.createElement("code",null,"Hook\u5bf9\u8c61"),", ",a.a.createElement("code",null,"updateClassComponent"),"\u5185\u90e8\u4f7f\u7528\u4e86",a.a.createElement("code",null,"class\u5b9e\u4f8b"),")."),a.a.createElement("p",null,"\u672c\u8282\u8ba8\u8bba",a.a.createElement("code",null,"Hook"),", \u6240\u4ee5\u5217\u51fa\u5176\u4e2d\u7684",a.a.createElement(o["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberBeginWork.old.js#L702-L783"},"updateFunctionComponent"),"\u51fd\u6570:"),a.a.createElement(c["a"],{code:"// \u53ea\u4fdd\u7559FunctionComponent\u76f8\u5173:\nfunction beginWork(\n  current: Fiber | null,\n  workInProgress: Fiber,\n  renderLanes: Lanes,\n): Fiber | null {\n  const updateLanes = workInProgress.lanes;\n  switch (workInProgress.tag) {\n    case FunctionComponent: {\n      const Component = workInProgress.type;\n      const unresolvedProps = workInProgress.pendingProps;\n      const resolvedProps =\n        workInProgress.elementType === Component\n          ? unresolvedProps\n          : resolveDefaultProps(Component, unresolvedProps);\n      return updateFunctionComponent(\n        current,\n        workInProgress,\n        Component,\n        resolvedProps,\n        renderLanes,\n      );\n    }\n  }\n}\n\nfunction updateFunctionComponent(\n  current,\n  workInProgress,\n  Component,\n  nextProps: any,\n  renderLanes,\n) {\n  // ...\u7701\u7565\u65e0\u5173\u4ee3\u7801\n  let context;\n  let nextChildren;\n  prepareToReadContext(workInProgress, renderLanes);\n\n  // \u8fdb\u5165Hooks\u76f8\u5173\u903b\u8f91, \u6700\u540e\u8fd4\u56de\u4e0b\u7ea7ReactElement\u5bf9\u8c61\n  nextChildren = renderWithHooks(\n    current,\n    workInProgress,\n    Component,\n    nextProps,\n    context,\n    renderLanes,\n  );\n  // \u8fdb\u5165reconcile\u51fd\u6570, \u751f\u6210\u4e0b\u7ea7fiber\u8282\u70b9\n  reconcileChildren(current, workInProgress, nextChildren, renderLanes);\n  // \u8fd4\u56de\u4e0b\u7ea7fiber\u8282\u70b9\n  return workInProgress.child;\n}",lang:"js"}),a.a.createElement("p",null,"\u5728",a.a.createElement("code",null,"updateFunctionComponent"),"\u51fd\u6570\u4e2d\u8c03\u7528\u4e86",a.a.createElement(o["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberHooks.old.js#L342-L476"},"renderWithHooks"),"(\u4f4d\u4e8e",a.a.createElement(o["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberHooks.old.js"},"ReactFiberHooks"),") , \u81f3\u6b64",a.a.createElement("code",null,"Fiber"),"\u4e0e",a.a.createElement("code",null,"Hook"),"\u4ea7\u751f\u4e86\u5173\u8054."),a.a.createElement("h3",{id:"\u5168\u5c40\u53d8\u91cf"},a.a.createElement(o["AnchorLink"],{to:"#\u5168\u5c40\u53d8\u91cf","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"\u5168\u5c40\u53d8\u91cf"),a.a.createElement("p",null,"\u5728\u5206\u6790",a.a.createElement("code",null,"renderWithHooks"),"\u51fd\u6570\u524d, \u6709\u5fc5\u8981\u7406\u89e3",a.a.createElement(o["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberHooks.old.js"},"ReactFiberHooks"),"\u5934\u90e8\u5b9a\u4e49\u7684\u5168\u5c40\u53d8\u91cf(\u6e90\u7801\u4e2d\u5747\u6709\u82f1\u6587\u6ce8\u91ca):"),a.a.createElement(c["a"],{code:"// \u6e32\u67d3\u4f18\u5148\u7ea7\nlet renderLanes: Lanes = NoLanes;\n\n// \u5f53\u524d\u6b63\u5728\u6784\u9020\u7684fiber, \u7b49\u540c\u4e8e workInProgress, \u4e3a\u4e86\u548c\u5f53\u524dhook\u533a\u5206, \u6240\u4ee5\u5c06\u5176\u6539\u540d\nlet currentlyRenderingFiber: Fiber = (null: any);\n\n// Hooks\u88ab\u5b58\u50a8\u5728fiber.memoizedState \u94fe\u8868\u4e0a\nlet currentHook: Hook | null = null; // currentHook = fiber(current).memoizedState\n\nlet workInProgressHook: Hook | null = null; // workInProgressHook = fiber(workInProgress).memoizedState\n\n// \u5728function\u7684\u6267\u884c\u8fc7\u7a0b\u4e2d, \u662f\u5426\u518d\u6b21\u53d1\u8d77\u4e86\u66f4\u65b0. \u53ea\u6709function\u88ab\u5b8c\u5168\u6267\u884c\u4e4b\u540e\u624d\u4f1a\u91cd\u7f6e.\n// \u5f53render\u5f02\u5e38\u65f6, \u901a\u8fc7\u8be5\u53d8\u91cf\u53ef\u4ee5\u51b3\u5b9a\u662f\u5426\u6e05\u9664render\u8fc7\u7a0b\u4e2d\u7684\u66f4\u65b0.\nlet didScheduleRenderPhaseUpdate: boolean = false;\n\n// \u5728\u672c\u6b21function\u7684\u6267\u884c\u8fc7\u7a0b\u4e2d, \u662f\u5426\u518d\u6b21\u53d1\u8d77\u4e86\u66f4\u65b0. \u6bcf\u4e00\u6b21\u8c03\u7528function\u90fd\u4f1a\u88ab\u91cd\u7f6e\nlet didScheduleRenderPhaseUpdateDuringThisPass: boolean = false;\n\n// \u5728\u672c\u6b21function\u7684\u6267\u884c\u8fc7\u7a0b\u4e2d, \u91cd\u65b0\u53d1\u8d77\u66f4\u65b0\u7684\u6700\u5927\u6b21\u6570\nconst RE_RENDER_LIMIT = 25;",lang:"js"}),a.a.createElement("p",null,"\u6bcf\u4e2a\u53d8\u91cf\u7684\u89e3\u91ca, \u53ef\u4ee5\u5bf9\u7167\u6e90\u7801\u4e2d\u7684\u82f1\u6587\u6ce8\u91ca, \u5176\u4e2d\u6700\u91cd\u8981\u7684\u6709:"),a.a.createElement("ol",null,a.a.createElement("li",null,a.a.createElement("code",null,"currentlyRenderingFiber"),": \u5f53\u524d\u6b63\u5728\u6784\u9020\u7684 fiber, \u7b49\u540c\u4e8e workInProgress"),a.a.createElement("li",null,a.a.createElement("code",null,"currentHook \u4e0e workInProgressHook"),": \u5206\u522b\u6307\u5411",a.a.createElement("code",null,"current.memoizedState"),"\u548c",a.a.createElement("code",null,"workInProgress.memoizedState"))),a.a.createElement("p",null,"\u6ce8: \u6709\u5173",a.a.createElement("code",null,"current"),"\u548c",a.a.createElement("code",null,"workInProgress"),"\u7684\u533a\u522b, \u8bf7\u56de\u987e",a.a.createElement(o["AnchorLink"],{to:"./fibertree-prepare#%E5%8F%8C%E7%BC%93%E5%86%B2%E6%8A%80%E6%9C%AF"},"\u53cc\u7f13\u51b2\u6280\u672f(double buffering)")),a.a.createElement("h3",{id:"renderwithhooks-\u51fd\u6570"},a.a.createElement(o["AnchorLink"],{to:"#renderwithhooks-\u51fd\u6570","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"renderWithHooks \u51fd\u6570"),a.a.createElement("p",null,a.a.createElement(o["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberHooks.old.js#L342-L476"},"renderWithHooks"),"\u6e90\u7801\u770b\u4f3c\u8f83\u957f, \u4f46\u662f\u53bb\u9664 dev \u540e\u4fdd\u7559\u4e3b\u5e72, \u903b\u8f91\u5341\u5206\u6e05\u6670. \u4ee5\u8c03\u7528",a.a.createElement("code",null,"function"),"\u4e3a\u5206\u754c\u70b9, \u903b\u8f91\u88ab\u5206\u4e3a 3 \u4e2a\u90e8\u5206:"),a.a.createElement(c["a"],{code:"// ...\u7701\u7565\u65e0\u5173\u4ee3\u7801\nexport function renderWithHooks<Props, SecondArg>(\n  current: Fiber | null,\n  workInProgress: Fiber,\n  Component: (p: Props, arg: SecondArg) => any,\n  props: Props,\n  secondArg: SecondArg,\n  nextRenderLanes: Lanes,\n): any {\n  // --------------- 1. \u8bbe\u7f6e\u5168\u5c40\u53d8\u91cf -------------------\n  renderLanes = nextRenderLanes; // \u5f53\u524d\u6e32\u67d3\u4f18\u5148\u7ea7\n  currentlyRenderingFiber = workInProgress; // \u5f53\u524dfiber\u8282\u70b9, \u4e5f\u5c31\u662ffunction\u7ec4\u4ef6\u5bf9\u5e94\u7684fiber\u8282\u70b9\n\n  // \u6e05\u9664\u5f53\u524dfiber\u7684\u9057\u7559\u72b6\u6001\n  workInProgress.memoizedState = null;\n  workInProgress.updateQueue = null;\n  workInProgress.lanes = NoLanes;\n\n  // --------------- 2. \u8c03\u7528function,\u751f\u6210\u5b50\u7ea7ReactElement\u5bf9\u8c61 -------------------\n  // \u6307\u5b9adispatcher, \u533a\u5206mount\u548cupdate\n  ReactCurrentDispatcher.current =\n    current === null || current.memoizedState === null\n      ? HooksDispatcherOnMount\n      : HooksDispatcherOnUpdate;\n  // \u6267\u884cfunction\u51fd\u6570, \u5176\u4e2d\u8fdb\u884c\u5206\u6790Hooks\u7684\u4f7f\u7528\n  let children = Component(props, secondArg);\n\n  // --------------- 3. \u91cd\u7f6e\u5168\u5c40\u53d8\u91cf,\u5e76\u8fd4\u56de -------------------\n  // \u6267\u884cfunction\u4e4b\u540e, \u8fd8\u539f\u88ab\u4fee\u6539\u7684\u5168\u5c40\u53d8\u91cf, \u4e0d\u5f71\u54cd\u4e0b\u4e00\u6b21\u8c03\u7528\n  renderLanes = NoLanes;\n  currentlyRenderingFiber = (null: any);\n\n  currentHook = null;\n  workInProgressHook = null;\n  didScheduleRenderPhaseUpdate = false;\n\n  return children;\n}",lang:"js"}),a.a.createElement("ol",null,a.a.createElement("li",null,"\u8c03\u7528",a.a.createElement("code",null,"function"),"\u524d: \u8bbe\u7f6e\u5168\u5c40\u53d8\u91cf, \u6807\u8bb0",a.a.createElement("code",null,"\u6e32\u67d3\u4f18\u5148\u7ea7"),"\u548c\u5f53\u524d",a.a.createElement("code",null,"fiber"),", \u6e05\u9664\u5f53\u524d",a.a.createElement("code",null,"fiber"),"\u7684\u9057\u7559\u72b6\u6001."),a.a.createElement("li",null,"\u8c03\u7528",a.a.createElement("code",null,"function"),": \u6784\u9020\u51fa",a.a.createElement("code",null,"Hooks"),"\u94fe\u8868, \u6700\u540e\u751f\u6210\u5b50\u7ea7",a.a.createElement("code",null,"ReactElement"),"\u5bf9\u8c61(",a.a.createElement("code",null,"children"),")."),a.a.createElement("li",null,"\u8c03\u7528",a.a.createElement("code",null,"function"),"\u540e: \u91cd\u7f6e\u5168\u5c40\u53d8\u91cf, \u8fd4\u56de",a.a.createElement("code",null,"children"),".",a.a.createElement("ul",null,a.a.createElement("li",null,"\u4e3a\u4e86\u4fdd\u8bc1\u4e0d\u540c\u7684",a.a.createElement("code",null,"function"),"\u8282\u70b9\u5728\u8c03\u7528\u65f6",a.a.createElement("code",null,"renderWithHooks"),"\u4e92\u4e0d\u5f71\u54cd, \u6240\u4ee5\u9000\u51fa\u65f6\u91cd\u7f6e\u5168\u5c40\u53d8\u91cf.")))),a.a.createElement("h2",{id:"\u8c03\u7528-function"},a.a.createElement(o["AnchorLink"],{to:"#\u8c03\u7528-function","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"\u8c03\u7528 function"),a.a.createElement("h3",{id:"hooks-\u6784\u9020"},a.a.createElement(o["AnchorLink"],{to:"#hooks-\u6784\u9020","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"Hooks \u6784\u9020"),a.a.createElement("p",null,"\u5728",a.a.createElement("code",null,"function"),"\u4e2d, \u5982\u679c\u4f7f\u7528\u4e86",a.a.createElement("code",null,"Hook api"),"(\u5982: ",a.a.createElement("code",null,"useEffect"),", ",a.a.createElement("code",null,"useState"),"), \u5c31\u4f1a\u521b\u5efa\u4e00\u4e2a\u4e0e\u4e4b\u5bf9\u5e94\u7684",a.a.createElement("code",null,"Hook"),"\u5bf9\u8c61, \u63a5\u4e0b\u6765\u91cd\u70b9\u5206\u6790\u8fd9\u4e2a\u521b\u5efa\u8fc7\u7a0b."),a.a.createElement("p",null,"\u6709\u5982\u4e0b demo:",a.a.createElement(o["Link"],{to:"https://codesandbox.io/s/hook-summary-wb7zz?fontsize=14&hidenavigation=1&theme=dark"},a.a.createElement("img",{src:"https://codesandbox.io/static/img/play-codesandbox.svg",alt:"Edit hook-summary"})))),a.a.createElement(r["default"],n["hook-summary-demo"].previewerProps,a.a.createElement(l,null)),a.a.createElement("div",{className:"markdown"},a.a.createElement("p",null,"\u5728",a.a.createElement("code",null,"function"),"\u7ec4\u4ef6\u4e2d, \u540c\u65f6\u4f7f\u7528\u4e86",a.a.createElement("code",null,"\u72b6\u6001Hook"),"\u548c",a.a.createElement("code",null,"\u526f\u4f5c\u7528Hook"),"."),a.a.createElement("p",null,"\u521d\u6b21\u6e32\u67d3\u65f6, \u903b\u8f91\u6267\u884c\u5230",a.a.createElement("code",null,"performUnitOfWork->beginWork->updateFunctionComponent->renderWithHooks"),"\u524d, \u5185\u5b58\u7ed3\u6784\u5982\u4e0b(\u672c\u8282\u91cd\u70b9\u662f",a.a.createElement("code",null,"Hook"),", \u6709\u5173",a.a.createElement("code",null,"fiber\u6811\u6784\u9020"),"\u8fc7\u7a0b\u53ef\u56de\u987e\u524d\u6587):"),a.a.createElement("p",null,a.a.createElement("img",{src:t("DcOI"),alt:""})),a.a.createElement("p",null,"\u5f53\u6267\u884c",a.a.createElement("code",null,"renderWithHooks"),"\u65f6, \u5f00\u59cb\u8c03\u7528",a.a.createElement("code",null,"function"),". \u672c\u4f8b\u4e2d, \u5728",a.a.createElement("code",null,"function"),"\u5185\u90e8, \u5171\u4f7f\u7528\u4e86 4 \u6b21",a.a.createElement("code",null,"Hook api"),", \u4f9d\u6b21\u8c03\u7528",a.a.createElement("code",null,"useState, useEffect, useState, useEffect"),"."),a.a.createElement("p",null,"\u800c",a.a.createElement("code",null,"useState, useEffect"),"\u5728",a.a.createElement("code",null,"fiber"),"\u521d\u6b21\u6784\u9020\u65f6\u5206\u522b\u5bf9\u5e94",a.a.createElement(o["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberHooks.old.js#L1113-L1136"},"mountState"),"\u548c",a.a.createElement(o["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberHooks.old.js#L1193-L1248"},"mountEffect->mountEffectImpl")),a.a.createElement(c["a"],{code:"function mountState<S>(\n  initialState: (() => S) | S,\n): [S, Dispatch<BasicStateAction<S>>] {\n  const hook = mountWorkInProgressHook();\n  // ...\u7701\u7565\u90e8\u5206\u672c\u8282\u4e0d\u8ba8\u8bba\n  return [hook.memoizedState, dispatch];\n}\n\nfunction mountEffectImpl(fiberFlags, hookFlags, create, deps): void {\n  const hook = mountWorkInProgressHook();\n  // ...\u7701\u7565\u90e8\u5206\u672c\u8282\u4e0d\u8ba8\u8bba\n}",lang:"js"}),a.a.createElement("p",null,"\u65e0\u8bba",a.a.createElement("code",null,"useState, useEffect"),", \u5185\u90e8\u90fd\u901a\u8fc7",a.a.createElement("code",null,"mountWorkInProgressHook"),"\u521b\u5efa\u4e00\u4e2a hook."),a.a.createElement("h3",{id:"\u94fe\u8868\u5b58\u50a8"},a.a.createElement(o["AnchorLink"],{to:"#\u94fe\u8868\u5b58\u50a8","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"\u94fe\u8868\u5b58\u50a8"),a.a.createElement("p",null,"\u800c",a.a.createElement(o["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberHooks.old.js#L531-L550"},"mountWorkInProgressHook"),"\u975e\u5e38\u7b80\u5355:"),a.a.createElement(c["a"],{code:"function mountWorkInProgressHook(): Hook {\n  const hook: Hook = {\n    memoizedState: null,\n\n    baseState: null,\n    baseQueue: null,\n    queue: null,\n\n    next: null,\n  };\n\n  if (workInProgressHook === null) {\n    // \u94fe\u8868\u4e2d\u9996\u4e2ahook\n    currentlyRenderingFiber.memoizedState = workInProgressHook = hook;\n  } else {\n    // \u5c06hook\u6dfb\u52a0\u5230\u94fe\u8868\u672b\u5c3e\n    workInProgressHook = workInProgressHook.next = hook;\n  }\n  return workInProgressHook;\n}",lang:"js"}),a.a.createElement("p",null,"\u903b\u8f91\u662f\u521b\u5efa",a.a.createElement("code",null,"Hook"),"\u5e76\u6302\u8f7d\u5230",a.a.createElement("code",null,"fiber.memoizedState"),"\u4e0a, \u591a\u4e2a",a.a.createElement("code",null,"Hook"),"\u4ee5\u94fe\u8868\u7ed3\u6784\u4fdd\u5b58."),a.a.createElement("p",null,"\u672c\u793a\u4f8b\u4e2d, ",a.a.createElement("code",null,"function"),"\u8c03\u7528\u4e4b\u540e\u5219\u4f1a\u521b\u5efa 4 \u4e2a",a.a.createElement("code",null,"hook"),", \u8fd9\u65f6\u7684\u5185\u5b58\u7ed3\u6784\u5982\u4e0b:"),a.a.createElement("p",null,a.a.createElement("img",{src:t("swyc"),alt:""})),a.a.createElement("p",null,"\u53ef\u4ee5\u770b\u5230: \u65e0\u8bba",a.a.createElement("code",null,"\u72b6\u6001Hook"),"\u6216",a.a.createElement("code",null,"\u526f\u4f5c\u7528Hook"),"\u90fd\u6309\u7167\u8c03\u7528\u987a\u5e8f\u5b58\u50a8\u5728",a.a.createElement("code",null,"fiber.memoizedState"),"\u94fe\u8868\u4e2d."),a.a.createElement("p",null,a.a.createElement("img",{src:t("e3ll"),alt:""})),a.a.createElement("h3",{id:"\u987a\u5e8f\u514b\u9686"},a.a.createElement(o["AnchorLink"],{to:"#\u987a\u5e8f\u514b\u9686","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"\u987a\u5e8f\u514b\u9686"),a.a.createElement("p",null,a.a.createElement("code",null,"fiber\u6811\u6784\u9020(\u5bf9\u6bd4\u66f4\u65b0)"),"\u9636\u6bb5, \u6267\u884c",a.a.createElement("code",null,"updateFunctionComponent->renderWithHooks"),"\u65f6\u518d\u6b21\u8c03\u7528",a.a.createElement("code",null,"function"),", ",a.a.createElement("code",null,"\u8c03\u7528function\u524d"),"\u7684\u5185\u5b58\u7ed3\u6784\u5982\u4e0b:"),a.a.createElement("p",null,a.a.createElement("img",{src:t("7tmu"),alt:""})),a.a.createElement("p",null,"\u6ce8\u610f: \u5728",a.a.createElement("code",null,"renderWithHooks"),"\u51fd\u6570\u4e2d\u5df2\u7ecf\u8bbe\u7f6e\u4e86",a.a.createElement("code",null,"workInProgress.memoizedState = null"),", \u7b49\u5f85\u8c03\u7528",a.a.createElement("code",null,"function"),"\u65f6\u91cd\u65b0\u8bbe\u7f6e."),a.a.createElement("p",null,"\u63a5\u4e0b\u6765\u8c03\u7528",a.a.createElement("code",null,"function"),", \u540c\u6837\u4f9d\u6b21\u8c03\u7528",a.a.createElement("code",null,"useState, useEffect, useState, useEffect"),". \u800c",a.a.createElement("code",null,"useState, useEffect"),"\u5728",a.a.createElement("code",null,"fiber"),"\u5bf9\u6bd4\u66f4\u65b0\u65f6\u5206\u522b\u5bf9\u5e94",a.a.createElement(o["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberHooks.old.js#L1138-L1142"},"updateState->updateReducer"),"\u548c",a.a.createElement(o["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberHooks.old.js#L1205-L1266"},"updateEffect->updateEffectImpl")),a.a.createElement(c["a"],{code:"// ----- \u72b6\u6001Hook --------\nfunction updateReducer<S, I, A>(\n  reducer: (S, A) => S,\n  initialArg: I,\n  init?: I => S,\n): [S, Dispatch<A>] {\n  const hook = updateWorkInProgressHook();\n  // ...\u7701\u7565\u90e8\u5206\u672c\u8282\u4e0d\u8ba8\u8bba\n}\n\n// ----- \u526f\u4f5c\u7528Hook --------\nfunction updateEffectImpl(fiberFlags, hookFlags, create, deps): void {\n  const hook = updateWorkInProgressHook();\n  // ...\u7701\u7565\u90e8\u5206\u672c\u8282\u4e0d\u8ba8\u8bba\n}",lang:"js"}),a.a.createElement("p",null,"\u65e0\u8bba",a.a.createElement("code",null,"useState, useEffect"),", \u5185\u90e8\u8c03\u7528",a.a.createElement("code",null,"updateWorkInProgressHook"),"\u83b7\u53d6\u4e00\u4e2a hook."),a.a.createElement(c["a"],{code:"function updateWorkInProgressHook(): Hook {\n  // 1. \u79fb\u52a8currentHook\u6307\u9488\n  let nextCurrentHook: null | Hook;\n  if (currentHook === null) {\n    const current = currentlyRenderingFiber.alternate;\n    if (current !== null) {\n      nextCurrentHook = current.memoizedState;\n    } else {\n      nextCurrentHook = null;\n    }\n  } else {\n    nextCurrentHook = currentHook.next;\n  }\n\n  // 2. \u79fb\u52a8workInProgressHook\u6307\u9488\n  let nextWorkInProgressHook: null | Hook;\n  if (workInProgressHook === null) {\n    nextWorkInProgressHook = currentlyRenderingFiber.memoizedState;\n  } else {\n    nextWorkInProgressHook = workInProgressHook.next;\n  }\n\n  if (nextWorkInProgressHook !== null) {\n    // \u6e32\u67d3\u65f6\u66f4\u65b0: \u672c\u8282\u4e0d\u8ba8\u8bba\n  } else {\n    currentHook = nextCurrentHook;\n    // 3. \u514b\u9686currentHook\u4f5c\u4e3a\u65b0\u7684workInProgressHook.\n    // \u968f\u540e\u903b\u8f91\u4e0emountWorkInProgressHook\u4e00\u81f4\n    const newHook: Hook = {\n      memoizedState: currentHook.memoizedState,\n\n      baseState: currentHook.baseState,\n      baseQueue: currentHook.baseQueue,\n      queue: currentHook.queue,\n\n      next: null, // \u6ce8\u610fnext\u6307\u9488\u662fnull\n    };\n    if (workInProgressHook === null) {\n      currentlyRenderingFiber.memoizedState = workInProgressHook = newHook;\n    } else {\n      workInProgressHook = workInProgressHook.next = newHook;\n    }\n  }\n  return workInProgressHook;\n}",lang:"js"}),a.a.createElement("p",null,a.a.createElement("code",null,"updateWorkInProgressHook"),"\u51fd\u6570\u903b\u8f91\u7b80\u5355: \u76ee\u7684\u662f\u4e3a\u4e86\u8ba9",a.a.createElement("code",null,"currentHook"),"\u548c",a.a.createElement("code",null,"workInProgressHook"),"\u4e24\u4e2a\u6307\u9488\u540c\u65f6\u5411\u540e\u79fb\u52a8."),a.a.createElement("ol",null,a.a.createElement("li",null,"\u7531\u4e8e",a.a.createElement("code",null,"renderWithHooks\u51fd\u6570"),"\u8bbe\u7f6e\u4e86",a.a.createElement("code",null,"workInProgress.memoizedState=null"),", \u6240\u4ee5",a.a.createElement("code",null,"workInProgressHook"),"\u521d\u59cb\u503c\u5fc5\u7136\u4e3a",a.a.createElement("code",null,"null"),", \u53ea\u80fd\u4ece",a.a.createElement("code",null,"currentHook"),"\u514b\u9686."),a.a.createElement("li",null,"\u800c\u4ece",a.a.createElement("code",null,"currentHook"),"\u514b\u9686\u800c\u6765\u7684",a.a.createElement("code",null,"newHook.next=null"),", \u8fdb\u800c\u5bfc\u81f4",a.a.createElement("code",null,"workInProgressHook"),"\u94fe\u8868\u9700\u8981\u5b8c\u5168\u91cd\u5efa.")),a.a.createElement("p",null,"\u6240\u4ee5",a.a.createElement("code",null,"function"),"\u6267\u884c\u5b8c\u6210\u4e4b\u540e, \u6709\u5173",a.a.createElement("code",null,"Hook"),"\u7684\u5185\u5b58\u7ed3\u6784\u5982\u4e0b:"),a.a.createElement("p",null,a.a.createElement("img",{src:t("iQCb"),alt:""})),a.a.createElement("p",null,"\u53ef\u4ee5\u770b\u5230:"),a.a.createElement("ol",null,a.a.createElement("li",null,"\u4ee5\u53cc\u7f13\u51b2\u6280\u672f\u4e3a\u57fa\u7840, \u5c06",a.a.createElement("code",null,"current.memoizedState"),"\u6309\u7167\u987a\u5e8f\u514b\u9686\u5230\u4e86",a.a.createElement("code",null,"workInProgress.memoizedState"),"\u4e2d."),a.a.createElement("li",null,a.a.createElement("code",null,"Hook"),"\u7ecf\u8fc7\u4e86\u4e00\u6b21\u514b\u9686, \u5185\u90e8\u7684\u5c5e\u6027(",a.a.createElement("code",null,"hook.memoizedState"),"\u7b49)\u90fd\u6ca1\u6709\u53d8\u52a8, \u6240\u4ee5\u5176\u72b6\u6001\u5e76\u4e0d\u4f1a\u4e22\u5931.")),a.a.createElement("p",null,a.a.createElement("img",{src:t("rX1P"),alt:""})),a.a.createElement("h2",{id:"\u603b\u7ed3"},a.a.createElement(o["AnchorLink"],{to:"#\u603b\u7ed3","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"\u603b\u7ed3"),a.a.createElement("p",null,"\u672c\u8282\u9996\u5148\u5f15\u5165\u4e86\u5b98\u65b9\u6587\u6863\u4e0a\u5bf9\u4e8e",a.a.createElement("code",null,"Hook"),"\u7684\u89e3\u91ca, \u4e86\u89e3",a.a.createElement("code",null,"Hook"),"\u7684\u7531\u6765, \u4ee5\u53ca",a.a.createElement("code",null,"Hook"),"\u76f8\u8f83\u4e8e",a.a.createElement("code",null,"class"),"\u7684\u4f18\u52bf. \u7136\u540e\u4ece",a.a.createElement("code",null,"fiber"),"\u89c6\u89d2\u5206\u6790\u4e86",a.a.createElement("code",null,"fiber"),"\u4e0e",a.a.createElement("code",null,"hook"),"\u7684\u5185\u5728\u5173\u7cfb, \u901a\u8fc7",a.a.createElement("code",null,"renderWithHooks"),"\u51fd\u6570, \u628a",a.a.createElement("code",null,"Hook"),"\u94fe\u8868\u6302\u8f7d\u5230\u4e86",a.a.createElement("code",null,"fiber.memoizedState"),"\u4e4b\u4e0a. \u5229\u7528",a.a.createElement("code",null,"fiber\u6811"),"\u5185\u90e8\u7684\u53cc\u7f13\u51b2\u6280\u672f, \u5b9e\u73b0\u4e86",a.a.createElement("code",null,"Hook"),"\u4ece",a.a.createElement("code",null,"current"),"\u5230",a.a.createElement("code",null,"workInProgress"),"\u8f6c\u79fb, \u8fdb\u800c\u5b9e\u73b0\u4e86",a.a.createElement("code",null,"Hook"),"\u72b6\u6001\u7684\u6301\u4e45\u5316."))))}));n["default"]=e=>{var n=a.a.useContext(o["context"]),t=n.demos;return a.a.useEffect((()=>{var n;null!==e&&void 0!==e&&null!==(n=e.location)&&void 0!==n&&n.hash&&o["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),a.a.createElement(u,{demos:t})}},e3ll:function(e,n,t){e.exports=t.p+"static/mount-fiber-memoizedstate.cef37509.png"},iQCb:function(e,n,t){e.exports=t.p+"static/update-after-renderwithhooks.a5a84006.png"},rX1P:function(e,n,t){e.exports=t.p+"static/update-fiber-memoizedstate.cb184d4f.png"},swyc:function(e,n,t){e.exports=t.p+"static/mount-after-renderwithhooks.afcf8a47.png"}}]);