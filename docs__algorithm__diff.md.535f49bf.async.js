(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[5],{GwIj:function(e,n,l){e.exports=l.p+"static/traverse2.a5a39d1b.png"},Pptb:function(e,n,l){e.exports=l.p+"static/before-traverse.71633a39.png"},o6gT:function(e,n,l){"use strict";l.r(n);var t=l("q1tI"),r=l.n(t),a=l("dEAq"),i=l("H1Ra"),c=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("h1",{id:"react-\u7b97\u6cd5\u4e4b\u8c03\u548c\u7b97\u6cd5"},r.a.createElement(a["AnchorLink"],{to:"#react-\u7b97\u6cd5\u4e4b\u8c03\u548c\u7b97\u6cd5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"React \u7b97\u6cd5\u4e4b\u8c03\u548c\u7b97\u6cd5"),r.a.createElement("h2",{id:"\u6982\u5ff5"},r.a.createElement(a["AnchorLink"],{to:"#\u6982\u5ff5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6982\u5ff5"),r.a.createElement("p",null,"\u8c03\u548c\u51fd\u6570(",r.a.createElement(a["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactChildFiber.old.js#L1274-L1410"},"\u6e90\u7801"),")\u662f\u5728",r.a.createElement("code",null,"fiber\u6811\u6784(\u5bf9\u6bd4\u66f4\u65b0)"),"\u8fc7\u7a0b\u4e2d\u5bf9",r.a.createElement("code",null,"\u65e7fiber\u8282\u70b9"),"\u4e0e",r.a.createElement("code",null,"\u65b0reactElement"),"\u8fdb\u884c\u6bd4\u8f83, \u5224\u5b9a",r.a.createElement("code",null,"\u65e7fiber\u8282\u70b9"),"\u662f\u5426\u53ef\u4ee5\u590d\u7528\u7684\u4e00\u4e2a\u6bd4\u8f83\u51fd\u6570."),r.a.createElement("p",null,"\u8c03\u548c\u51fd\u6570\u4ec5\u662f",r.a.createElement("code",null,"fiber\u6811\u6784\u9020"),"\u8fc7\u7a0b\u4e2d\u7684\u4e00\u4e2a\u73af\u8282, \u6240\u4ee5\u5728\u6df1\u5165\u7406\u89e3\u8fd9\u4e2a\u51fd\u6570\u4e4b\u524d, \u5efa\u8bae\u5bf9",r.a.createElement("code",null,"fiber\u6811\u6784\u9020"),"\u6709\u4e00\u4e2a\u5b8f\u89c2\u7684\u7406\u89e3(\u53ef\u4ee5\u53c2\u8003\u524d\u6587",r.a.createElement(a["Link"],{to:"../main/fibertree-create"},"fiber \u6811\u6784\u9020(\u521d\u6b21\u521b\u5efa)"),", ",r.a.createElement(a["Link"],{to:"../main/fibertree-update"},"fiber \u6811\u6784\u9020(\u5bf9\u6bd4\u66f4\u65b0)"),"), \u672c\u8282\u91cd\u70b9\u63a2\u8ba8\u5176\u7b97\u6cd5\u7684\u5b9e\u73b0\u7ec6\u8282."),r.a.createElement("p",null,"\u5b83\u7684\u4e3b\u8981\u4f5c\u7528:"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u7ed9\u65b0\u589e,\u79fb\u52a8,\u548c\u5220\u9664\u8282\u70b9\u8bbe\u7f6e",r.a.createElement("code",null,"fiber.flags"),"(\u65b0\u589e, \u79fb\u52a8: ",r.a.createElement("code",null,"Placement"),", \u5220\u9664: ",r.a.createElement("code",null,"Deletion"),")"),r.a.createElement("li",null,"\u5982\u679c\u662f\u9700\u8981\u5220\u9664\u7684",r.a.createElement("code",null,"fiber"),", ",r.a.createElement(a["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactChildFiber.old.js#L275-L294"},"\u9664\u4e86\u81ea\u8eab\u6253\u4e0a",r.a.createElement("code",null,"Deletion"),"\u4e4b\u5916, \u8fd8\u8981\u5c06\u5176\u6dfb\u52a0\u5230\u7236\u8282\u70b9\u7684",r.a.createElement("code",null,"effects"),"\u94fe\u8868\u4e2d"),"(\u6b63\u5e38\u526f\u4f5c\u7528\u961f\u5217\u7684\u5904\u7406\u662f\u5728",r.a.createElement("code",null,"completeWork"),"\u51fd\u6570, \u4f46\u662f\u8be5\u8282\u70b9(\u88ab\u5220\u9664)\u4f1a\u8131\u79bb",r.a.createElement("code",null,"fiber"),"\u6811, \u4e0d\u4f1a\u518d\u8fdb\u5165",r.a.createElement("code",null,"completeWork"),"\u9636\u6bb5, \u6240\u4ee5\u5728",r.a.createElement("code",null,"beginWork"),"\u9636\u6bb5\u63d0\u524d\u52a0\u5165\u526f\u4f5c\u7528\u961f\u5217).")),r.a.createElement("h2",{id:"\u7279\u6027"},r.a.createElement(a["AnchorLink"],{to:"#\u7279\u6027","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u7279\u6027"),r.a.createElement("p",null,"\u7b97\u6cd5\u590d\u6742\u5ea6\u4f4e, \u4ece\u4e0a\u81f3\u4e0b\u6bd4\u8f83\u6574\u4e2a\u6811\u5f62\u7ed3\u6784, \u65f6\u95f4\u590d\u6742\u5ea6\u88ab\u7f29\u77ed\u5230 O(n)"),r.a.createElement("h2",{id:"\u57fa\u672c\u539f\u7406"},r.a.createElement(a["AnchorLink"],{to:"#\u57fa\u672c\u539f\u7406","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u57fa\u672c\u539f\u7406"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u6bd4\u8f83\u5bf9\u8c61: ",r.a.createElement("code",null,"fiber"),"\u5bf9\u8c61\u4e0e",r.a.createElement("code",null,"ReactElement"),"\u5bf9\u8c61\u76f8\u6bd4\u8f83.",r.a.createElement("ul",null,r.a.createElement("li",null,"\u6ce8\u610f: \u6b64\u5904\u6709\u4e00\u4e2a\u8bef\u533a, \u5e76\u4e0d\u662f\u4e24\u68f5 fiber \u6811\u76f8\u6bd4\u8f83, \u800c\u662f",r.a.createElement("code",null,"\u65e7fiber"),"\u5bf9\u8c61\u4e0e",r.a.createElement("code",null,"\u65b0ReactElement"),"\u5bf9\u8c61\u5411\u6bd4\u8f83, \u7ed3\u679c\u751f\u6210\u65b0\u7684",r.a.createElement("code",null,"fiber\u5b50\u8282\u70b9"),"."),r.a.createElement("li",null,"\u53ef\u4ee5\u7406\u89e3\u4e3a\u8f93\u5165",r.a.createElement("code",null,"ReactElement"),", \u7ecf\u8fc7",r.a.createElement("code",null,"reconcileChildren()"),"\u4e4b\u540e, \u8f93\u51fa",r.a.createElement("code",null,"fiber"),"."))),r.a.createElement("li",null,"\u6bd4\u8f83\u65b9\u6848:",r.a.createElement("ul",null,r.a.createElement("li",null,"\u5355\u8282\u70b9\u6bd4\u8f83"),r.a.createElement("li",null,"\u53ef\u8fed\u4ee3\u8282\u70b9\u6bd4\u8f83")))),r.a.createElement("h3",{id:"\u5355\u8282\u70b9\u6bd4\u8f83"},r.a.createElement(a["AnchorLink"],{to:"#\u5355\u8282\u70b9\u6bd4\u8f83","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5355\u8282\u70b9\u6bd4\u8f83"),r.a.createElement("p",null,"\u5355\u8282\u70b9\u7684\u903b\u8f91\u6bd4\u8f83\u7b80\u660e, \u5148\u76f4\u63a5\u770b",r.a.createElement(a["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactChildFiber.old.js#L1135-L1233"},"\u6e90\u7801"),":"),r.a.createElement(i["a"],{code:"// \u53ea\u4fdd\u7559\u4e3b\u5e72\u903b\u8f91\nfunction reconcileSingleElement(\n  returnFiber: Fiber,\n  currentFirstChild: Fiber | null,\n  element: ReactElement,\n  lanes: Lanes,\n): Fiber {\n  const key = element.key;\n  let child = currentFirstChild;\n\n  while (child !== null) {\n    // currentFirstChild !== null, \u8868\u660e\u662f\u5bf9\u6bd4\u66f4\u65b0\u9636\u6bb5\n    if (child.key === key) {\n      // 1. key\u76f8\u540c, \u8fdb\u4e00\u6b65\u5224\u65ad child.elementType === element.type\n      switch (child.tag) {\n        // \u53ea\u770b\u6838\u5fc3\u903b\u8f91\n        default: {\n          if (child.elementType === element.type) {\n            // 1.1 \u5df2\u7ecf\u5339\u914d\u4e0a\u4e86, \u5982\u679c\u6709\u5144\u5f1f\u8282\u70b9, \u9700\u8981\u7ed9\u5144\u5f1f\u8282\u70b9\u6253\u4e0aDeletion\u6807\u8bb0\n            deleteRemainingChildren(returnFiber, child.sibling);\n            // 1.2 \u6784\u9020fiber\u8282\u70b9, \u65b0\u7684fiber\u5bf9\u8c61\u4f1a\u590d\u7528current.stateNode, \u5373\u53ef\u590d\u7528DOM\u5bf9\u8c61\n            const existing = useFiber(child, element.props);\n            existing.ref = coerceRef(returnFiber, child, element);\n            existing.return = returnFiber;\n            return existing;\n          }\n          break;\n        }\n      }\n      // Didn't match. \u7ed9\u5f53\u524d\u8282\u70b9\u70b9\u6253\u4e0aDeletion\u6807\u8bb0\n      deleteRemainingChildren(returnFiber, child);\n      break;\n    } else {\n      // 2. key\u4e0d\u76f8\u540c, \u5339\u914d\u5931\u8d25, \u7ed9\u5f53\u524d\u8282\u70b9\u6253\u4e0aDeletion\u6807\u8bb0\n      deleteChild(returnFiber, child);\n    }\n    child = child.sibling;\n  }\n\n  {\n    // ...\u7701\u7565\u90e8\u5206\u4ee3\u7801, \u53ea\u770b\u6838\u5fc3\u903b\u8f91\n  }\n\n  // \u65b0\u5efa\u8282\u70b9\n  const created = createFiberFromElement(element, returnFiber.mode, lanes);\n  created.ref = coerceRef(returnFiber, currentFirstChild, element);\n  created.return = returnFiber;\n  return created;\n}",lang:"js"}),r.a.createElement("ol",null,r.a.createElement("li",null,"\u5982\u679c\u662f\u65b0\u589e\u8282\u70b9, \u76f4\u63a5\u65b0\u5efa fiber, \u6ca1\u6709\u591a\u4f59\u7684\u903b\u8f91"),r.a.createElement("li",null,"\u5982\u679c\u662f\u5bf9\u6bd4\u66f4\u65b0",r.a.createElement("ul",null,r.a.createElement("li",null,"\u5982\u679c",r.a.createElement("code",null,"key"),"\u548c",r.a.createElement("code",null,"type"),"\u90fd\u76f8\u540c(\u5373: ",r.a.createElement("code",null,"ReactElement.key")," === ",r.a.createElement("code",null,"Fiber.key")," \u4e14 ",r.a.createElement("code",null,"Fiber.elementType === ReactElement.type"),"), \u5219\u590d\u7528"),r.a.createElement("li",null,"\u5426\u5219\u65b0\u5efa")))),r.a.createElement("p",null,"\u6ce8\u610f: \u590d\u7528\u8fc7\u7a0b\u662f\u8c03\u7528",r.a.createElement("code",null,"useFiber(child, element.props)"),"\u521b\u5efa",r.a.createElement("code",null,"\u65b0\u7684fiber"),"\u5bf9\u8c61, \u8fd9\u4e2a",r.a.createElement("code",null,"\u65b0fiber\u5bf9\u8c61.stateNode = currentFirstChild.stateNode"),", \u5373",r.a.createElement("code",null,"stateNode"),"\u5c5e\u6027\u5f97\u5230\u4e86\u590d\u7528, \u6545 DOM \u8282\u70b9\u5f97\u5230\u4e86\u590d\u7528."),r.a.createElement("h3",{id:"\u53ef\u8fed\u4ee3\u8282\u70b9\u6bd4\u8f83\u6570\u7ec4\u7c7b\u578b-symboliteratorfniteratorfn"},r.a.createElement(a["AnchorLink"],{to:"#\u53ef\u8fed\u4ee3\u8282\u70b9\u6bd4\u8f83\u6570\u7ec4\u7c7b\u578b-symboliteratorfniteratorfn","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u53ef\u8fed\u4ee3\u8282\u70b9\u6bd4\u8f83(\u6570\u7ec4\u7c7b\u578b, [Symbol.iterator]=fn,[@@iterator]=fn)"),r.a.createElement("p",null,"\u53ef\u8fed\u4ee3\u8282\u70b9\u6bd4\u8f83, \u5728",r.a.createElement(a["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactChildFiber.old.js#L1346-L1362"},"\u6e90\u7801\u4e2d"),"\u88ab\u5206\u4e3a\u4e86 2 \u4e2a\u90e8\u5206:"),r.a.createElement(i["a"],{code:"function reconcileChildFibers(\n  returnFiber: Fiber,\n  currentFirstChild: Fiber | null,\n  newChild: any,\n  lanes: Lanes,\n): Fiber | null {\n  if (isArray(newChild)) {\n    return reconcileChildrenArray(\n      returnFiber,\n      currentFirstChild,\n      newChild,\n      lanes,\n    );\n  }\n  if (getIteratorFn(newChild)) {\n    return reconcileChildrenIterator(\n      returnFiber,\n      currentFirstChild,\n      newChild,\n      lanes,\n    );\n  }\n}",lang:"js"}),r.a.createElement("p",null,"\u5176\u4e2d",r.a.createElement("code",null,"reconcileChildrenArray\u51fd\u6570"),"(\u9488\u5bf9\u6570\u7ec4\u7c7b\u578b)\u548c",r.a.createElement("code",null,"reconcileChildrenIterator"),"(\u9488\u5bf9\u53ef\u8fed\u4ee3\u7c7b\u578b)\u7684\u6838\u5fc3\u903b\u8f91\u51e0\u4e4e\u4e00\u81f4, \u4e0b\u6587\u5c06\u5206\u6790",r.a.createElement(a["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactChildFiber.old.js#L771-L924"},r.a.createElement("code",null,"reconcileChildrenArray()"),"\u51fd\u6570"),". \u5982\u679c\u662f\u65b0\u589e\u8282\u70b9, \u6240\u6709\u7684\u6bd4\u8f83\u903b\u8f91\u90fd\u65e0\u6cd5\u547d\u4e2d, \u53ea\u6709",r.a.createElement("code",null,"\u5bf9\u6bd4\u66f4\u65b0"),"\u8fc7\u7a0b, \u624d\u6709\u5b9e\u9645\u4f5c\u7528, \u6240\u4ee5\u4e0b\u6587\u91cd\u70b9\u5206\u6790",r.a.createElement("code",null,"\u5bf9\u6bd4\u66f4\u65b0"),"\u7684\u60c5\u51b5."),r.a.createElement(i["a"],{code:"function reconcileChildrenArray(\n  returnFiber: Fiber,\n  currentFirstChild: Fiber | null,\n  newChildren: Array<*>,\n  lanes: Lanes,\n): Fiber | null {\n  let resultingFirstChild: Fiber | null = null;\n  let previousNewFiber: Fiber | null = null;\n\n  let oldFiber = currentFirstChild;\n  let lastPlacedIndex = 0;\n  let newIdx = 0;\n  let nextOldFiber = null;\n  // 1. \u7b2c\u4e00\u6b21\u5faa\u73af: \u904d\u5386\u6700\u957f\u516c\u5171\u5e8f\u5217(key\u76f8\u540c), \u516c\u5171\u5e8f\u5217\u7684\u8282\u70b9\u90fd\u89c6\u4e3a\u53ef\u590d\u7528\n  for (; oldFiber !== null && newIdx < newChildren.length; newIdx++) {\n    // \u540e\u6587\u5206\u6790\n  }\n\n  if (newIdx === newChildren.length) {\n    // \u5982\u679cnewChildren\u5e8f\u5217\u88ab\u904d\u5386\u5b8c, \u90a3\u4e48oldFiber\u5e8f\u5217\u4e2d\u5269\u4f59\u8282\u70b9\u90fd\u89c6\u4e3a\u5220\u9664(\u6253\u4e0aDeletion\u6807\u8bb0)\n    deleteRemainingChildren(returnFiber, oldFiber);\n    return resultingFirstChild;\n  }\n\n  if (oldFiber === null) {\n    // \u5982\u679coldFiber\u5e8f\u5217\u88ab\u904d\u5386\u5b8c, \u90a3\u4e48newChildren\u5e8f\u5217\u4e2d\u5269\u4f59\u8282\u70b9\u90fd\u89c6\u4e3a\u65b0\u589e(\u6253\u4e0aPlacement\u6807\u8bb0)\n    for (; newIdx < newChildren.length; newIdx++) {\n      // \u540e\u6587\u5206\u6790\n    }\n    return resultingFirstChild;\n  }\n\n  // ==================\u5206\u5272\u7ebf==================\n  const existingChildren = mapRemainingChildren(returnFiber, oldFiber);\n\n  // 2. \u7b2c\u4e8c\u6b21\u5faa\u73af: \u904d\u5386\u5269\u4f59\u975e\u516c\u5171\u5e8f\u5217, \u4f18\u5148\u590d\u7528oldFiber\u5e8f\u5217\u4e2d\u7684\u8282\u70b9\n  for (; newIdx < newChildren.length; newIdx++) {}\n\n  if (shouldTrackSideEffects) {\n    // newChildren\u5df2\u7ecf\u904d\u5386\u5b8c, \u90a3\u4e48oldFiber\u5e8f\u5217\u4e2d\u5269\u4f59\u8282\u70b9\u90fd\u89c6\u4e3a\u5220\u9664(\u6253\u4e0aDeletion\u6807\u8bb0)\n    existingChildren.forEach(child => deleteChild(returnFiber, child));\n  }\n\n  return resultingFirstChild;\n}",lang:"js"}),r.a.createElement("p",null,r.a.createElement("code",null,"reconcileChildrenArray"),"\u51fd\u6570\u6e90\u7801\u770b\u4f3c\u5f88\u957f, \u68b3\u7406\u5176\u4e3b\u5e72\u4e4b\u540e, \u5176\u5b9e\u975e\u5e38\u6e05\u6670."),r.a.createElement("p",null,"\u901a\u8fc7\u5f62\u53c2, \u9996\u5148\u660e\u786e\u6bd4\u8f83\u5bf9\u8c61\u662f",r.a.createElement("code",null,"currentFirstChild: Fiber | null"),"\u548c",r.a.createElement("code",null,"newChildren: Array<*>"),":"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"currentFirstChild"),": \u662f\u4e00\u4e2a",r.a.createElement("code",null,"fiber"),"\u8282\u70b9, \u901a\u8fc7",r.a.createElement("code",null,"fiber.sibling"),"\u53ef\u4ee5\u5c06\u5144\u5f1f\u8282\u70b9\u5168\u90e8\u904d\u5386\u51fa\u6765. \u6240\u4ee5\u53ef\u4ee5\u5c06",r.a.createElement("code",null,"currentFirstChild"),"\u7406\u89e3\u4e3a\u94fe\u8868\u5934\u90e8, \u5b83\u4ee3\u8868\u4e00\u4e2a\u5e8f\u5217, \u6e90\u7801\u4e2d\u88ab\u8bb0\u4e3a",r.a.createElement("code",null,"oldFiber"),"."),r.a.createElement("li",null,r.a.createElement("code",null,"newChildren"),": \u662f\u4e00\u4e2a\u6570\u7ec4, \u5176\u4e2d\u5305\u542b\u4e86\u82e5\u5e72\u4e2a",r.a.createElement("code",null,"ReactElement"),"\u5bf9\u8c61. \u6240\u4ee5",r.a.createElement("code",null,"newChildren"),"\u4e5f\u4ee3\u8868\u4e00\u4e2a\u5e8f\u5217.")),r.a.createElement("p",null,"\u6240\u4ee5",r.a.createElement("code",null,"reconcileChildrenArray"),"\u5b9e\u9645\u5c31\u662f 2 \u4e2a\u5e8f\u5217\u4e4b\u95f4\u7684\u6bd4\u8f83(",r.a.createElement("code",null,"\u94fe\u8868oldFiber"),"\u548c",r.a.createElement("code",null,"\u6570\u7ec4newChildren"),"), \u6700\u540e\u8fd4\u56de\u5408\u7406\u7684",r.a.createElement("code",null,"fiber"),"\u5e8f\u5217."),r.a.createElement("p",null,"\u4e0a\u8ff0\u4ee3\u7801\u4e2d, \u4ee5\u6ce8\u91ca\u5206\u5272\u7ebf\u4e3a\u754c\u9650, \u6574\u4e2a\u6838\u5fc3\u903b\u8f91\u5206\u4e3a 2 \u6b65\u9aa4:"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u7b2c\u4e00\u6b21\u5faa\u73af: \u904d\u5386\u6700\u957f",r.a.createElement("code",null,"\u516c\u5171"),"\u5e8f\u5217(key \u76f8\u540c), \u516c\u5171\u5e8f\u5217\u7684\u8282\u70b9\u90fd\u89c6\u4e3a\u53ef\u590d\u7528",r.a.createElement("ul",null,r.a.createElement("li",null,"\u5982\u679c",r.a.createElement("code",null,"newChildren\u5e8f\u5217"),"\u88ab\u904d\u5386\u5b8c, \u90a3\u4e48",r.a.createElement("code",null,"oldFiber\u5e8f\u5217"),"\u4e2d\u5269\u4f59\u8282\u70b9\u90fd\u89c6\u4e3a\u5220\u9664(\u6253\u4e0a",r.a.createElement("code",null,"Deletion"),"\u6807\u8bb0)"),r.a.createElement("li",null,"\u5982\u679c",r.a.createElement("code",null,"oldFiber\u5e8f\u5217"),"\u88ab\u904d\u5386\u5b8c, \u90a3\u4e48",r.a.createElement("code",null,"newChildren\u5e8f\u5217"),"\u4e2d\u5269\u4f59\u8282\u70b9\u90fd\u89c6\u4e3a\u65b0\u589e(\u6253\u4e0a",r.a.createElement("code",null,"Placement"),"\u6807\u8bb0)"))),r.a.createElement("li",null,"\u7b2c\u4e8c\u6b21\u5faa\u73af: \u904d\u5386\u5269\u4f59",r.a.createElement("code",null,"\u975e\u516c\u5171"),"\u5e8f\u5217, \u4f18\u5148\u590d\u7528 oldFiber \u5e8f\u5217\u4e2d\u7684\u8282\u70b9",r.a.createElement("ul",null,r.a.createElement("li",null,"\u5728\u5bf9\u6bd4\u66f4\u65b0\u9636\u6bb5(\u975e\u521d\u6b21\u521b\u5efa",r.a.createElement("code",null,"fiber"),", \u6b64\u65f6",r.a.createElement("code",null,"shouldTrackSideEffects"),"\u88ab\u8bbe\u7f6e\u4e3atrue). \u7b2c\u4e8c\u6b21\u5faa\u73af\u904d\u5386\u5b8c\u6210\u4e4b\u540e, ",r.a.createElement("code",null,"oldFiber\u5e8f\u5217\u4e2d"),"\u6ca1\u6709\u5339\u914d\u4e0a\u7684\u8282\u70b9\u90fd\u89c6\u4e3a\u5220\u9664(\u6253\u4e0a",r.a.createElement("code",null,"Deletion"),"\u6807\u8bb0)")))),r.a.createElement("p",null,"\u5047\u8bbe\u6709\u5982\u4e0b\u56fe\u6240\u793a 2 \u4e2a\u521d\u59cb\u5316\u5e8f\u5217:"),r.a.createElement("p",null,r.a.createElement("img",{src:l("Pptb"),alt:""})),r.a.createElement("p",null,"\u63a5\u4e0b\u6765\u7b2c\u4e00\u6b21\u5faa\u73af, \u4f1a\u904d\u5386\u516c\u5171\u5e8f\u5217",r.a.createElement("code",null,"A,B"),", \u751f\u6210\u7684 fiber \u8282\u70b9",r.a.createElement("code",null,"fiber(A), fiber(B)"),"\u53ef\u4ee5\u590d\u7528."),r.a.createElement("p",null,r.a.createElement("img",{src:l("zwEL"),alt:""})),r.a.createElement("p",null,"\u6700\u540e\u7b2c\u4e8c\u6b21\u5faa\u73af, \u4f1a\u904d\u5386\u5269\u4f59\u5e8f\u5217",r.a.createElement("code",null,"E,C,X,Y"),":"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u751f\u6210\u7684 fiber \u8282\u70b9",r.a.createElement("code",null,"fiber(E), fiber(C)"),"\u53ef\u4ee5\u590d\u7528. \u5176\u4e2d",r.a.createElement("code",null,"fiber(C)"),"\u8282\u70b9\u53d1\u751f\u4e86\u4f4d\u79fb(\u6253\u4e0a",r.a.createElement("code",null,"Placement"),"\u6807\u8bb0)."),r.a.createElement("li",null,r.a.createElement("code",null,"fiber(X), fiber(Y)"),"\u662f\u65b0\u589e(\u6253\u4e0a",r.a.createElement("code",null,"Placement"),"\u6807\u8bb0)."),r.a.createElement("li",null,"\u540c\u65f6",r.a.createElement("code",null,"oldFiber"),"\u5e8f\u5217\u4e2d\u7684",r.a.createElement("code",null,"fiber(D)"),"\u8282\u70b9\u786e\u5b9a\u88ab\u5220\u9664(\u6253\u4e0a",r.a.createElement("code",null,"Deletion"),"\u6807\u8bb0).")),r.a.createElement("p",null,r.a.createElement("img",{src:l("GwIj"),alt:""})),r.a.createElement("p",null,"\u6574\u4e2a\u4e3b\u5e72\u903b\u8f91\u5c31\u4ecb\u7ecd\u5b8c\u4e86, \u63a5\u4e0b\u6765\u8d34\u4e0a\u5b8c\u6574\u6e90\u7801"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u7b2c\u4e00\u6b21\u5faa\u73af")),r.a.createElement(i["a"],{code:"// 1. \u7b2c\u4e00\u6b21\u5faa\u73af: \u904d\u5386\u6700\u957f\u516c\u5171\u5e8f\u5217(key\u76f8\u540c), \u516c\u5171\u5e8f\u5217\u7684\u8282\u70b9\u90fd\u89c6\u4e3a\u53ef\u590d\u7528\nfor (; oldFiber !== null && newIdx < newChildren.length; newIdx++) {\n  if (oldFiber.index > newIdx) {\n    nextOldFiber = oldFiber;\n    oldFiber = null;\n  } else {\n    nextOldFiber = oldFiber.sibling;\n  }\n  // new\u69fd\u4f4d\u548cold\u69fd\u4f4d\u8fdb\u884c\u6bd4\u8f83, \u5982\u679ckey\u4e0d\u540c, \u8fd4\u56denull\n  // key\u76f8\u540c, \u6bd4\u8f83type\u662f\u5426\u4e00\u81f4. type\u4e00\u81f4\u5219\u6267\u884cuseFiber(update\u903b\u8f91), type\u4e0d\u4e00\u81f4\u5219\u8fd0\u884ccreateXXX(insert\u903b\u8f91)\n  const newFiber = updateSlot(\n    returnFiber,\n    oldFiber,\n    newChildren[newIdx],\n    lanes,\n  );\n\n  if (newFiber === null) {\n    // \u5982\u679c\u8fd4\u56denull, \u8868\u660ekey\u4e0d\u540c. \u65e0\u6cd5\u6ee1\u8db3\u516c\u5171\u5e8f\u5217\u6761\u4ef6, \u9000\u51fa\u5faa\u73af\n    if (oldFiber === null) {\n      oldFiber = nextOldFiber;\n    }\n    break;\n  }\n  if (shouldTrackSideEffects) {\n    // \u82e5\u662f\u65b0\u589e\u8282\u70b9, \u5219\u7ed9\u8001\u8282\u70b9\u6253\u4e0aDeletion\u6807\u8bb0\n    if (oldFiber && newFiber.alternate === null) {\n      deleteChild(returnFiber, oldFiber);\n    }\n  }\n\n  // lastPlacedIndex \u8bb0\u5f55\u88ab\u79fb\u52a8\u7684\u8282\u70b9\u7d22\u5f15\n  // \u5982\u679c\u5f53\u524d\u8282\u70b9\u53ef\u590d\u7528, \u5219\u8981\u5224\u65ad\u4f4d\u7f6e\u662f\u5426\u79fb\u52a8.\n  lastPlacedIndex = placeChild(newFiber, lastPlacedIndex, newIdx);\n\n  // \u66f4\u65b0resultingFirstChild\u7ed3\u679c\u5e8f\u5217\n  if (previousNewFiber === null) {\n    resultingFirstChild = newFiber;\n  } else {\n    previousNewFiber.sibling = newFiber;\n  }\n  previousNewFiber = newFiber;\n  oldFiber = nextOldFiber;\n}",lang:"js"}),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u7b2c\u4e8c\u6b21\u5faa\u73af")),r.a.createElement(i["a"],{code:"// 1. \u5c06\u7b2c\u4e00\u6b21\u5faa\u73af\u540e, oldFiber\u5269\u4f59\u5e8f\u5217\u52a0\u5165\u5230\u4e00\u4e2amap\u4e2d. \u76ee\u7684\u662f\u4e3a\u4e86\u7b2c\u4e8c\u6b21\u5faa\u73af\u80fd\u987a\u5229\u7684\u627e\u5230\u53ef\u590d\u7528\u8282\u70b9\nconst existingChildren = mapRemainingChildren(returnFiber, oldFiber);\n\n// 2. \u7b2c\u4e8c\u6b21\u5faa\u73af: \u904d\u5386\u5269\u4f59\u975e\u516c\u5171\u5e8f\u5217, \u4f18\u5148\u590d\u7528oldFiber\u5e8f\u5217\u4e2d\u7684\u8282\u70b9\nfor (; newIdx < newChildren.length; newIdx++) {\n  const newFiber = updateFromMap(\n    existingChildren,\n    returnFiber,\n    newIdx,\n    newChildren[newIdx],\n    lanes,\n  );\n  if (newFiber !== null) {\n    if (shouldTrackSideEffects) {\n      if (newFiber.alternate !== null) {\n        // \u5982\u679cnewFiber\u662f\u901a\u8fc7\u590d\u7528\u521b\u5efa\u7684, \u5219\u6e05\u7406map\u4e2d\u5bf9\u5e94\u7684\u8001\u8282\u70b9\n        existingChildren.delete(newFiber.key === null ? newIdx : newFiber.key);\n      }\n    }\n    lastPlacedIndex = placeChild(newFiber, lastPlacedIndex, newIdx);\n    // \u66f4\u65b0resultingFirstChild\u7ed3\u679c\u5e8f\u5217\n    if (previousNewFiber === null) {\n      resultingFirstChild = newFiber;\n    } else {\n      previousNewFiber.sibling = newFiber;\n    }\n    previousNewFiber = newFiber;\n  }\n}\n// 3. \u5584\u540e\u5de5\u4f5c, \u7b2c\u4e8c\u6b21\u5faa\u73af\u5b8c\u6210\u4e4b\u540e, existingChildren\u4e2d\u5269\u4f59\u7684fiber\u8282\u70b9\u5c31\u662f\u5c06\u8981\u88ab\u5220\u9664\u7684\u8282\u70b9, \u6253\u4e0aDeletion\u6807\u8bb0\nif (shouldTrackSideEffects) {\n  existingChildren.forEach(child => deleteChild(returnFiber, child));\n}",lang:"js"}),r.a.createElement("h3",{id:"\u7ed3\u679c"},r.a.createElement(a["AnchorLink"],{to:"#\u7ed3\u679c","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u7ed3\u679c"),r.a.createElement("p",null,"\u65e0\u8bba\u662f\u5355\u8282\u70b9\u8fd8\u662f\u53ef\u8fed\u4ee3\u8282\u70b9\u7684\u6bd4\u8f83, \u6700\u7ec8\u7684\u76ee\u7684\u90fd\u662f\u751f\u6210\u4e0b\u7ea7\u5b50\u8282\u70b9. \u5e76\u5728",r.a.createElement("code",null,"reconcileChildren"),"\u8fc7\u7a0b\u4e2d, \u7ed9\u4e00\u4e9b\u6709\u526f\u4f5c\u7528\u7684\u8282\u70b9(\u65b0\u589e, \u5220\u9664, \u79fb\u52a8\u4f4d\u7f6e\u7b49)\u6253\u4e0a\u526f\u4f5c\u7528\u6807\u8bb0, \u7b49\u5f85 commit \u9636\u6bb5(\u53c2\u8003",r.a.createElement(a["Link"],{to:"../main/commit"},"fiber \u6811\u6e32\u67d3"),")\u7684\u5904\u7406."),r.a.createElement("h2",{id:"\u603b\u7ed3"},r.a.createElement(a["AnchorLink"],{to:"#\u603b\u7ed3","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u603b\u7ed3"),r.a.createElement("p",null,"\u672c\u8282\u4ecb\u7ecd\u4e86 React \u6e90\u7801\u4e2d, ",r.a.createElement("code",null,"fiber\u6784\u9020\u5faa\u73af"),"\u9636\u6bb5\u7528\u4e8e\u751f\u6210\u4e0b\u7ea7\u5b50\u8282\u70b9\u7684",r.a.createElement("code",null,"reconcileChildren"),"\u51fd\u6570(\u51fd\u6570\u4e2d\u7684\u7b97\u6cd5\u88ab\u79f0\u4e3a\u8c03\u548c\u7b97\u6cd5), \u5e76\u6f14\u793a\u4e86",r.a.createElement("code",null,"\u53ef\u8fed\u4ee3\u8282\u70b9\u6bd4\u8f83"),"\u7684\u56fe\u89e3\u793a\u4f8b. \u8be5\u7b97\u6cd5\u5341\u5206\u5de7\u5999, \u5176\u6838\u5fc3\u903b\u8f91\u628a",r.a.createElement("code",null,"newChildren\u5e8f\u5217"),"\u5206\u4e3a 2 \u6b65\u904d\u5386, \u5148\u904d\u5386\u516c\u5171\u5e8f\u5217, \u518d\u904d\u5386\u975e\u516c\u5171\u90e8\u5206, \u540c\u65f6\u590d\u7528",r.a.createElement("code",null,"oldFiber"),"\u5e8f\u5217\u4e2d\u7684\u8282\u70b9.")))}));n["default"]=e=>{var n=r.a.useContext(a["context"]),l=n.demos;return r.a.useEffect((()=>{var n;null!==e&&void 0!==e&&null!==(n=e.location)&&void 0!==n&&n.hash&&a["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(c,{demos:l})}},zwEL:function(e,n,l){e.exports=l.p+"static/traverse1.a0313cc2.png"}}]);