(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[11],{Ifnh:function(e,n,l){"use strict";l.r(n);var t=l("q1tI"),a=l.n(t),r=l("dEAq"),c=l("H1Ra"),i=a.a.memo((e=>{e.demos;return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"markdown"},a.a.createElement("h1",{id:"key-\u6709\u4ec0\u4e48\u4f5c\u7528-\u53ef\u4ee5\u7701\u7565\u5417"},a.a.createElement(r["AnchorLink"],{to:"#key-\u6709\u4ec0\u4e48\u4f5c\u7528-\u53ef\u4ee5\u7701\u7565\u5417","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"key \u6709\u4ec0\u4e48\u4f5c\u7528, \u53ef\u4ee5\u7701\u7565\u5417?"),a.a.createElement("p",null,"\u5728 react \u7ec4\u4ef6\u5f00\u53d1\u7684\u8fc7\u7a0b\u4e2d, ",a.a.createElement("code",null,"key"),"\u662f\u4e00\u4e2a\u5e38\u7528\u7684\u5c5e\u6027\u503c, \u591a\u7528\u4e8e\u5217\u8868\u5f00\u53d1. \u672c\u6587\u4ece\u6e90\u7801\u7684\u89d2\u5ea6, \u5206\u6790",a.a.createElement("code",null,"key"),"\u5728",a.a.createElement("code",null,"react"),"\u5185\u90e8\u662f\u5982\u4f55\u4f7f\u7528\u7684, ",a.a.createElement("code",null,"key"),"\u662f\u5426\u53ef\u4ee5\u7701\u7565."),a.a.createElement("h2",{id:"reactelement-\u5bf9\u8c61"},a.a.createElement(r["AnchorLink"],{to:"#reactelement-\u5bf9\u8c61","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"ReactElement \u5bf9\u8c61"),a.a.createElement("p",null,"\u6211\u4eec\u5728\u7f16\u7a0b\u65f6\u76f4\u63a5\u4e66\u5199\u7684",a.a.createElement("code",null,"jsx"),"\u4ee3\u7801, \u5b9e\u9645\u4e0a\u662f\u4f1a\u88ab\u7f16\u8bd1\u6210 ReactElement \u5bf9\u8c61, \u6240\u4ee5",a.a.createElement("code",null,"key"),"\u662f",a.a.createElement("code",null,"ReactElement\u5bf9\u8c61"),"\u7684\u4e00\u4e2a\u5c5e\u6027."),a.a.createElement("h3",{id:"\u6784\u9020\u51fd\u6570"},a.a.createElement(r["AnchorLink"],{to:"#\u6784\u9020\u51fd\u6570","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"\u6784\u9020\u51fd\u6570"),a.a.createElement("p",null,"\u5728\u628a",a.a.createElement("code",null,"jsx"),"\u8f6c\u6362\u6210",a.a.createElement("code",null,"ReactElement\u5bf9\u8c61"),"\u7684\u8bed\u6cd5\u65f6, \u6709\u4e00\u4e2a\u517c\u5bb9\u95ee\u9898. \u4f1a\u6839\u636e\u7f16\u8bd1\u5668\u7684\u4e0d\u540c\u7b56\u7565, \u7f16\u8bd1\u6210 2 \u79cd\u65b9\u6848."),a.a.createElement("ol",null,a.a.createElement("li",null,a.a.createElement("p",null,"\u6700\u65b0\u7684\u8f6c\u8bd1\u7b56\u7565: \u4f1a\u5c06",a.a.createElement("code",null,"jsx"),"\u8bed\u6cd5\u7684\u4ee3\u7801, \u8f6c\u8bd1\u6210",a.a.createElement("code",null,"jsx()"),"\u51fd\u6570\u5305\u88f9"),a.a.createElement("p",null,a.a.createElement("code",null,"jsx"),"\u51fd\u6570: \u53ea\u4fdd\u7559\u4e0e",a.a.createElement("code",null,"key"),"\u76f8\u5173\u7684\u4ee3\u7801(\u5176\u4f59\u6e90\u7801\u672c\u8282\u4e0d\u8ba8\u8bba)"),a.a.createElement(c["a"],{code:'/**\n * https://github.com/reactjs/rfcs/pull/107\n * @param {*} type\n * @param {object} props\n * @param {string} key\n */\nexport function jsx(type, config, maybeKey) {\n  let propName;\n\n  // 1. key\u7684\u9ed8\u8ba4\u503c\u662fnull\n  let key = null;\n\n  // Currently, key can be spread in as a prop. This causes a potential\n  // issue if key is also explicitly declared (ie. <div {...props} key="Hi" />\n  // or <div key="Hi" {...props} /> ). We want to deprecate key spread,\n  // but as an intermediary step, we will use jsxDEV for everything except\n  // <div {...props} key="Hi" />, because we aren\'t currently able to tell if\n  // key is explicitly declared to be undefined or not.\n  if (maybeKey !== undefined) {\n    key = \'\' + maybeKey;\n  }\n\n  if (hasValidKey(config)) {\n    // 2. \u5c06key\u8f6c\u6362\u6210\u5b57\u7b26\u4e32\n    key = \'\' + config.key;\n  }\n  // 3. \u5c06key\u4f20\u5165\u6784\u9020\u51fd\u6570\n  return ReactElement(\n    type,\n    key,\n    ref,\n    undefined,\n    undefined,\n    ReactCurrentOwner.current,\n    props,\n  );\n}',lang:"js"})),a.a.createElement("li",null,a.a.createElement("p",null,"\u4f20\u7edf\u7684\u8f6c\u8bd1\u7b56\u7565: \u4f1a\u5c06",a.a.createElement("code",null,"jsx"),"\u8bed\u6cd5\u7684\u4ee3\u7801, \u8f6c\u8bd1\u6210",a.a.createElement(r["Link"],{to:"https://github.com/facebook/react/blob/v17.0.2/packages/react/src/ReactElement.js#L126-L146"},"React.createElement()\u51fd\u6570\u5305\u88f9")),a.a.createElement("p",null,a.a.createElement("code",null,"React.createElement()\u51fd\u6570"),": \u53ea\u4fdd\u7559\u4e0e",a.a.createElement("code",null,"key"),"\u76f8\u5173\u7684\u4ee3\u7801(\u5176\u4f59\u6e90\u7801\u672c\u8282\u4e0d\u8ba8\u8bba)"),a.a.createElement(c["a"],{code:"/**\n * Create and return a new ReactElement of the given type.\n * See https://reactjs.org/docs/react-api.html#createelement\n */\nexport function createElement(type, config, children) {\n  let propName;\n\n  // Reserved names are extracted\n  const props = {};\n\n  let key = null;\n  let ref = null;\n  let self = null;\n  let source = null;\n\n  if (config != null) {\n    if (hasValidKey(config)) {\n      key = '' + config.key; // key\u8f6c\u6362\u6210\u5b57\u7b26\u4e32\n    }\n  }\n\n  return ReactElement(\n    type,\n    key,\n    ref,\n    self,\n    source,\n    ReactCurrentOwner.current,\n    props,\n  );\n}",lang:"js"}))),a.a.createElement("p",null,"\u53ef\u4ee5\u770b\u5230\u65e0\u8bba\u91c7\u53d6\u54ea\u79cd\u7f16\u8bd1\u65b9\u5f0f, \u6838\u5fc3\u903b\u8f91\u90fd\u662f\u4e00\u81f4\u7684:"),a.a.createElement("ol",null,a.a.createElement("li",null,a.a.createElement("code",null,"key"),"\u7684\u9ed8\u8ba4\u503c\u662f",a.a.createElement("code",null,"null")),a.a.createElement("li",null,"\u5982\u679c\u5916\u754c\u6709\u663e\u5f0f\u6307\u5b9a\u7684",a.a.createElement("code",null,"key"),", \u5219\u5c06",a.a.createElement("code",null,"key"),"\u8f6c\u6362\u6210\u5b57\u7b26\u4e32\u7c7b\u578b."),a.a.createElement("li",null,"\u8c03\u7528",a.a.createElement("code",null,"ReactElement"),"\u8fd9\u4e2a\u6784\u9020\u51fd\u6570, \u5e76\u4e14\u5c06",a.a.createElement("code",null,"key"),"\u4f20\u5165.")),a.a.createElement(c["a"],{code:"// ReactElement\u7684\u6784\u9020\u51fd\u6570: \u672c\u8282\u5c31\u5148\u53ea\u5173\u6ce8\u5176\u4e2d\u7684key\u5c5e\u6027\nconst ReactElement = function(type, key, ref, self, source, owner, props) {\n  const element = {\n    $$typeof: REACT_ELEMENT_TYPE,\n    type: type,\n    key: key,\n    ref: ref,\n    props: props,\n    _owner: owner,\n  };\n  return element;\n};",lang:"js"}),a.a.createElement("p",null,"\u6e90\u7801\u770b\u5230\u8fd9\u91cc, \u867d\u7136\u8fd8\u53ea\u662f\u4e2a\u76ae\u6bdb, \u4f46\u662f\u8d77\u7801\u77e5\u9053\u4e86",a.a.createElement("code",null,"key"),"\u7684\u9ed8\u8ba4\u503c\u662f",a.a.createElement("code",null,"null"),". \u6240\u4ee5\u4efb\u4f55\u4e00\u4e2a",a.a.createElement("code",null,"reactElement"),"\u5bf9\u8c61, \u5185\u90e8\u90fd\u662f\u6709",a.a.createElement("code",null,"key"),"\u503c\u7684, \u53ea\u662f\u4e00\u822c\u60c5\u51b5\u4e0b(\u5bf9\u4e8e\u5355\u8282\u70b9)\u5f88\u5c11\u663e\u5f0f\u53bb\u4f20\u5165\u4e00\u4e2a key."),a.a.createElement("h2",{id:"fiber-\u5bf9\u8c61"},a.a.createElement(r["AnchorLink"],{to:"#fiber-\u5bf9\u8c61","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"Fiber \u5bf9\u8c61"),a.a.createElement("p",null,a.a.createElement("code",null,"react"),"\u7684\u6838\u5fc3\u8fd0\u884c\u903b\u8f91, \u662f\u4e00\u4e2a\u4ece\u8f93\u5165\u5230\u8f93\u51fa\u7684\u8fc7\u7a0b(\u56de\u987e",a.a.createElement(r["Link"],{to:"../main/reconciler-workflow"},"reconciler \u8fd0\u4f5c\u6d41\u7a0b"),"). \u7f16\u7a0b\u76f4\u63a5\u64cd\u4f5c\u7684",a.a.createElement("code",null,"jsx"),"\u662f",a.a.createElement("code",null,"reactElement\u5bf9\u8c61"),",\u6211\u4eec(\u7a0b\u5e8f\u5458)\u7684\u6570\u636e\u6a21\u578b\u662f",a.a.createElement("code",null,"jsx"),", \u800c",a.a.createElement("code",null,"react\u5185\u6838"),"\u7684\u6570\u636e\u6a21\u578b\u662f",a.a.createElement("code",null,"fiber\u6811\u5f62\u7ed3\u6784"),". \u6240\u4ee5\u8981\u6df1\u5165\u8ba4\u8bc6",a.a.createElement("code",null,"key"),"\u8fd8\u9700\u8981\u4ece",a.a.createElement("code",null,"fiber"),"\u7684\u89c6\u89d2\u7ee7\u7eed\u6765\u770b."),a.a.createElement("p",null,a.a.createElement("code",null,"fiber"),"\u5bf9\u8c61\u662f\u5728",a.a.createElement("code",null,"fiber\u6811\u6784\u9020\u5faa\u73af"),"\u8fc7\u7a0b\u4e2d\u6784\u9020\u7684, \u5176\u6784\u9020\u51fd\u6570\u5982\u4e0b:"),a.a.createElement(c["a"],{code:"function FiberNode(\n  tag: WorkTag,\n  pendingProps: mixed,\n  key: null | string,\n  mode: TypeOfMode,\n) {\n  this.tag = tag;\n  this.key = key; // \u91cd\u70b9: key\u4e5f\u662f`fiber`\u5bf9\u8c61\u7684\u4e00\u4e2a\u5c5e\u6027\n\n  // ...\n  this.elementType = null;\n  this.type = null;\n  this.stateNode = null;\n  // ... \u7701\u7565\u65e0\u5173\u4ee3\u7801\n}",lang:"js"}),a.a.createElement("p",null,"\u53ef\u4ee5\u770b\u5230, ",a.a.createElement("code",null,"key"),"\u4e5f\u662f",a.a.createElement("code",null,"fiber"),"\u5bf9\u8c61\u7684\u4e00\u4e2a\u5c5e\u6027. \u8fd9\u91cc\u548c",a.a.createElement("code",null,"reactElement"),"\u7684\u60c5\u51b5\u6709\u6240\u4e0d\u540c:"),a.a.createElement("ol",null,a.a.createElement("li",null,a.a.createElement("code",null,"reactElement"),"\u4e2d\u7684",a.a.createElement("code",null,"key"),"\u662f\u7531",a.a.createElement("code",null,"jsx"),"\u7f16\u8bd1\u800c\u6765, ",a.a.createElement("code",null,"key"),"\u662f\u7531\u7a0b\u5e8f\u5458\u76f4\u63a5\u63a7\u5236\u7684(\u53ca\u65f6\u662f\u52a8\u6001\u751f\u6210, \u90a3\u4e5f\u662f\u76f4\u63a5\u63a7\u5236)"),a.a.createElement("li",null,a.a.createElement("code",null,"fiber"),"\u5bf9\u8c61\u662f\u7531",a.a.createElement("code",null,"react"),"\u5185\u6838\u5728\u8fd0\u884c\u65f6\u521b\u5efa\u7684, \u6240\u4ee5",a.a.createElement("code",null,"fiber.key"),"\u4e5f\u662f",a.a.createElement("code",null,"react"),"\u5185\u6838\u8fdb\u884c\u8bbe\u7f6e\u7684, \u7a0b\u5e8f\u5458\u6ca1\u6709\u76f4\u63a5\u63a7\u5236.")),a.a.createElement("p",null,"\u6ce8\u610f: ",a.a.createElement("code",null,"fiber.key"),"\u662f",a.a.createElement("code",null,"reactElement.key"),"\u7684\u62f7\u8d1d, \u4ed6\u4eec\u662f\u5b8c\u5168\u76f8\u7b49\u7684(\u5305\u62ec",a.a.createElement("code",null,"null"),"\u9ed8\u8ba4\u503c)."),a.a.createElement("p",null,"\u63a5\u4e0b\u6765\u5206\u6790",a.a.createElement("code",null,"fiber"),"\u521b\u5efa, \u5256\u6790",a.a.createElement("code",null,"key"),"\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u7684\u5177\u4f53\u4f7f\u7528\u60c5\u51b5."),a.a.createElement("p",null,a.a.createElement("code",null,"fiber"),"\u5bf9\u8c61\u7684\u521b\u5efa\u53d1\u751f\u5728",a.a.createElement("code",null,"fiber\u6811\u6784\u9020\u5faa\u73af"),"\u9636\u6bb5\u4e2d, \u5177\u4f53\u6765\u8bb2, \u662f\u5728",a.a.createElement("code",null,"reconcileChildren"),"\u8c03\u548c\u51fd\u6570\u4e2d\u8fdb\u884c\u521b\u5efa."),a.a.createElement("h2",{id:"reconcilechildren-\u8c03\u548c\u51fd\u6570"},a.a.createElement(r["AnchorLink"],{to:"#reconcilechildren-\u8c03\u548c\u51fd\u6570","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"reconcileChildren \u8c03\u548c\u51fd\u6570"),a.a.createElement("p",null,a.a.createElement("code",null,"reconcileChildren"),"\u662f",a.a.createElement("code",null,"react"),"\u4e2d\u7684\u4e00\u4e2a",a.a.createElement("code",null,"\u660e\u661f"),"\u51fd\u6570, \u6700\u70ed\u70b9\u7684\u95ee\u9898\u5c31\u662f",a.a.createElement("code",null,"diff\u7b97\u6cd5\u539f\u7406"),", \u4e8b\u5b9e\u4e0a, ",a.a.createElement("code",null,"key"),"\u7684\u4f5c\u7528\u5b8c\u5168\u5c31\u662f\u4e3a\u4e86",a.a.createElement("code",null,"diff\u7b97\u6cd5"),"\u670d\u52a1\u7684."),a.a.createElement("blockquote",null,a.a.createElement("p",null,"\u6ce8\u610f: \u672c\u8282\u53ea\u5206\u6790 key \u76f8\u5173\u7684\u903b\u8f91, \u5bf9\u4e8e\u8c03\u548c\u51fd\u6570\u7684\u7b97\u6cd5\u539f\u7406, \u8bf7\u56de\u987e\u7b97\u6cd5\u7ae0\u8282",a.a.createElement(r["Link"],{to:"../algorithm/diff"},"React \u7b97\u6cd5\u4e4b\u8c03\u548c\u7b97\u6cd5"))),a.a.createElement("p",null,"\u8c03\u548c\u51fd\u6570\u6e90\u7801(\u672c\u8282\u793a\u4f8b, \u53ea\u6458\u53d6\u4e86\u90e8\u5206\u4ee3\u7801):"),a.a.createElement(c["a"],{code:"function ChildReconciler(shouldTrackSideEffects) {\n  function reconcileChildFibers(\n    returnFiber: Fiber,\n    currentFirstChild: Fiber | null,\n    newChild: any,\n    lanes: Lanes,\n  ): Fiber | null {\n    // Handle object types\n    const isObject = typeof newChild === 'object' && newChild !== null;\n\n    if (isObject) {\n      switch (newChild.$$typeof) {\n        case REACT_ELEMENT_TYPE:\n          // newChild\u662f\u5355\u8282\u70b9\n          return placeSingleChild(\n            reconcileSingleElement(\n              returnFiber,\n              currentFirstChild,\n              newChild,\n              lanes,\n            ),\n          );\n      }\n    }\n    //  newChild\u662f\u591a\u8282\u70b9\n    if (isArray(newChild)) {\n      return reconcileChildrenArray(\n        returnFiber,\n        currentFirstChild,\n        newChild,\n        lanes,\n      );\n    }\n    // ...\n  }\n\n  return reconcileChildFibers;\n}",lang:"js"}),a.a.createElement("h3",{id:"\u5355\u8282\u70b9"},a.a.createElement(r["AnchorLink"],{to:"#\u5355\u8282\u70b9","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"\u5355\u8282\u70b9"),a.a.createElement("p",null,"\u8fd9\u91cc\u5148\u770b\u5355\u8282\u70b9\u7684\u60c5\u51b5",a.a.createElement("code",null,"reconcileSingleElement"),"(\u53ea\u4fdd\u7559\u4e0e",a.a.createElement("code",null,"key"),"\u6709\u5173\u7684\u903b\u8f91):"),a.a.createElement(c["a"],{code:"function reconcileSingleElement(\n  returnFiber: Fiber,\n  currentFirstChild: Fiber | null,\n  element: ReactElement,\n  lanes: Lanes,\n): Fiber {\n  const key = element.key;\n  let child = currentFirstChild;\n  while (child !== null) {\n    //\u91cd\u70b91: key\u662f\u5355\u8282\u70b9\u662f\u5426\u590d\u7528\u7684\u7b2c\u4e00\u5224\u65ad\u6761\u4ef6\n    if (child.key === key) {\n      switch (child.tag) {\n        default: {\n          if (child.elementType === element.type) {\n            // \u7b2c\u4e8c\u5224\u65ad\u6761\u4ef6\n            deleteRemainingChildren(returnFiber, child.sibling);\n            // \u8282\u70b9\u590d\u7528: \u8c03\u7528useFiber\n            const existing = useFiber(child, element.props);\n            existing.ref = coerceRef(returnFiber, child, element);\n            existing.return = returnFiber;\n            return existing;\n          }\n          break;\n        }\n      }\n      // Didn't match.\n      deleteRemainingChildren(returnFiber, child);\n      break;\n    }\n    child = child.sibling;\n  }\n  // \u91cd\u70b92: fiber\u8282\u70b9\u521b\u5efa, `key`\u662f\u968f\u7740`element`\u5bf9\u8c61\u88ab\u4f20\u5165`fiber`\u7684\u6784\u9020\u51fd\u6570\n  const created = createFiberFromElement(element, returnFiber.mode, lanes);\n  created.ref = coerceRef(returnFiber, currentFirstChild, element);\n  created.return = returnFiber;\n  return created;\n}",lang:"js"}),a.a.createElement("p",null,"\u53ef\u4ee5\u770b\u5230, \u5bf9\u4e8e\u5355\u8282\u70b9\u6765\u8bb2, \u6709 2 \u4e2a\u91cd\u70b9:"),a.a.createElement("ol",null,a.a.createElement("li",null,a.a.createElement("code",null,"key"),"\u662f\u5355\u8282\u70b9\u662f\u5426\u590d\u7528\u7684\u7b2c\u4e00\u5224\u65ad\u6761\u4ef6(\u7b2c\u4e8c\u5224\u65ad\u6761\u4ef6\u662f",a.a.createElement("code",null,"type"),"\u662f\u5426\u6539\u53d8).",a.a.createElement("ul",null,a.a.createElement("li",null,"\u5982\u679c",a.a.createElement("code",null,"key"),"\u4e0d\u540c, \u5176\u4ed6\u6761\u4ef6\u662f\u5b8c\u5168\u4e0d\u770b\u7684"))),a.a.createElement("li",null,"\u5728\u65b0\u5efa\u8282\u70b9\u65f6, ",a.a.createElement("code",null,"key"),"\u968f\u7740",a.a.createElement("code",null,"element"),"\u5bf9\u8c61\u88ab\u4f20\u5165",a.a.createElement("code",null,"fiber"),"\u7684\u6784\u9020\u51fd\u6570.")),a.a.createElement("p",null,"\u6240\u4ee5\u5230\u8fd9\u91cc\u624d\u662f",a.a.createElement("code",null,"key"),"\u7684\u6700\u6838\u5fc3\u4f5c\u7528, \u662f\u8c03\u548c\u51fd\u6570\u4e2d, \u9488\u5bf9\u5355\u8282\u70b9\u662f\u5426\u53ef\u4ee5\u590d\u7528\u7684",a.a.createElement("code",null,"\u7b2c\u4e00\u5224\u65ad\u6761\u4ef6"),"."),a.a.createElement("p",null,"\u5bf9\u4e8e\u5355\u8282\u70b9\u6765\u8bb2, ",a.a.createElement("code",null,"key"),"\u662f\u53ef\u4ee5\u7701\u7565\u7684, ",a.a.createElement("code",null,"react"),"\u5185\u90e8\u4f1a\u8bbe\u7f6e\u6210\u9ed8\u8ba4\u503c",a.a.createElement("code",null,"null"),". \u5728\u8fdb\u884c",a.a.createElement("code",null,"diff"),"\u65f6, \u7531\u4e8e",a.a.createElement("code",null,"null===null"),"\u4e3a",a.a.createElement("code",null,"true"),", \u524d\u540e",a.a.createElement("code",null,"render"),"\u7684",a.a.createElement("code",null,"key"),"\u662f\u4e00\u81f4\u7684, \u53ef\u4ee5\u8fdb\u884c\u590d\u7528\u6bd4\u8f83."),a.a.createElement("p",null,"\u5982\u679c\u5355\u8282\u70b9\u663e\u5f0f\u8bbe\u7f6e\u4e86",a.a.createElement("code",null,"key"),", \u4e14\u4e24\u6b21",a.a.createElement("code",null,"render"),"\u65f6\u7684",a.a.createElement("code",null,"key"),"\u5982\u679c\u4e0d\u4e00\u81f4, \u5219\u65e0\u6cd5\u590d\u7528."),a.a.createElement("h3",{id:"\u591a\u8282\u70b9"},a.a.createElement(r["AnchorLink"],{to:"#\u591a\u8282\u70b9","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"\u591a\u8282\u70b9"),a.a.createElement("p",null,"\u7ee7\u7eed\u67e5\u770b\u591a\u8282\u70b9\u76f8\u5173\u7684\u903b\u8f91:"),a.a.createElement(c["a"],{code:"function reconcileChildrenArray(\n  returnFiber: Fiber,\n  currentFirstChild: Fiber | null,\n  newChildren: Array<*>,\n  lanes: Lanes,\n): Fiber | null {\n  if (__DEV__) {\n    // First, validate keys.\n    let knownKeys = null;\n    for (let i = 0; i < newChildren.length; i++) {\n      const child = newChildren[i];\n      // 1. \u5728dev\u73af\u5883\u4e0b, \u6267\u884cwarnOnInvalidKey.\n      //  - \u5982\u679c\u6ca1\u6709\u8bbe\u7f6ekey, \u4f1a\u8b66\u544a\u63d0\u793a, \u5e0c\u671b\u80fd\u663e\u5f0f\u8bbe\u7f6ekey\n      //  - \u5982\u679ckey\u91cd\u590d, \u4f1a\u9519\u8bef\u63d0\u793a.\n      knownKeys = warnOnInvalidKey(child, knownKeys, returnFiber);\n    }\n  }\n\n  let resultingFirstChild: Fiber | null = null;\n  let previousNewFiber: Fiber | null = null;\n\n  let oldFiber = currentFirstChild;\n  let lastPlacedIndex = 0;\n  let newIdx = 0;\n  let nextOldFiber = null;\n  // \u7b2c\u4e00\u6b21\u5faa\u73af: \u53ea\u4f1a\u5728\u66f4\u65b0\u9636\u6bb5\u53d1\u751f\n  for (; oldFiber !== null && newIdx < newChildren.length; newIdx++) {\n    if (oldFiber.index > newIdx) {\n      nextOldFiber = oldFiber;\n      oldFiber = null;\n    } else {\n      nextOldFiber = oldFiber.sibling;\n    }\n    // 1. \u8c03\u7528updateSlot, \u5904\u7406\u516c\u5171\u5e8f\u5217\u4e2d\u7684fiber\n    const newFiber = updateSlot(\n      returnFiber,\n      oldFiber,\n      newChildren[newIdx],\n      lanes,\n    );\n    if (newFiber === null) {\n        // \u5982\u679c\u65e0\u6cd5\u590d\u7528, \u5219\u9000\u51fa\u516c\u5171\u5e8f\u5217\u7684\u904d\u5386\n        if (oldFiber === null) {\n          oldFiber = nextOldFiber;\n        }\n        break;\n     }\n  }\n\n  // \u7b2c\u4e8c\u6b21\u5faa\u73af\n  if (oldFiber === null) {\n    for (; newIdx < newChildren.length; newIdx++) {\n      // 2. \u8c03\u7528createChild\u76f4\u63a5\u521b\u5efa\u65b0fiber\n      const newFiber = createChild(returnFiber, newChildren[newIdx], lanes);\n    }\n    return resultingFirstChild;\n  }\n\n  for (; newIdx < newChildren.length; newIdx++) {\n    // 3. \u8c03\u7528updateFromMap\u5904\u7406\u975e\u516c\u5171\u5e8f\u5217\u4e2d\u7684fiber\n    const newFiber = updateFromMap(\n      existingChildren,\n      returnFiber,\n      newIdx,\n      newChildren[newIdx],\n      lanes,\n    );\n  }\n\n  return resultingFirstChild;\n}",lang:"js"}),a.a.createElement("p",null,"\u5728",a.a.createElement("code",null,"reconcileChildrenArray"),"\u4e2d, \u6709 3 \u5904\u8c03\u7528\u4e0e",a.a.createElement("code",null,"fiber"),"\u6709\u5173(\u5f53\u7136\u987a\u4fbf\u5c31\u548c",a.a.createElement("code",null,"key"),"\u6709\u5173\u4e86), \u5b83\u4eec\u5206\u522b\u662f:"),a.a.createElement("ol",null,a.a.createElement("li",null,a.a.createElement("p",null,a.a.createElement("code",null,"updateSlot")),a.a.createElement(c["a"],{code:"function updateSlot(\n  returnFiber: Fiber,\n  oldFiber: Fiber | null,\n  newChild: any,\n  lanes: Lanes,\n): Fiber | null {\n  const key = oldFiber !== null ? oldFiber.key : null;\n\n  if (typeof newChild === 'object' && newChild !== null) {\n    switch (newChild.$$typeof) {\n      case REACT_ELEMENT_TYPE: {\n        //\u91cd\u70b9: key\u7528\u4e8e\u662f\u5426\u590d\u7528\u7684\u7b2c\u4e00\u5224\u65ad\u6761\u4ef6\n        if (newChild.key === key) {\n          return updateElement(returnFiber, oldFiber, newChild, lanes);\n        } else {\n          return null;\n        }\n      }\n    }\n  }\n\n  return null;\n}",lang:"js"})),a.a.createElement("li",null,a.a.createElement("p",null,a.a.createElement("code",null,"createChild")),a.a.createElement(c["a"],{code:"function createChild(\n  returnFiber: Fiber,\n  newChild: any,\n  lanes: Lanes,\n): Fiber | null {\n  if (typeof newChild === 'object' && newChild !== null) {\n    switch (newChild.$$typeof) {\n      case REACT_ELEMENT_TYPE: {\n        // \u91cd\u70b9: \u8c03\u7528\u6784\u9020\u51fd\u6570\u8fdb\u884c\u521b\u5efa\n        const created = createFiberFromElement(\n          newChild,\n          returnFiber.mode,\n          lanes,\n        );\n        return created;\n      }\n    }\n  }\n\n  return null;\n}",lang:"js"})),a.a.createElement("li",null,a.a.createElement("p",null,a.a.createElement("code",null,"updateFromMap")),a.a.createElement(c["a"],{code:"function updateFromMap(\nexistingChildren: Map<string | number, Fiber>,\nreturnFiber: Fiber,\nnewIdx: number,\nnewChild: any,\nlanes: Lanes,\n): Fiber | null {\n    if (typeof newChild === 'object' && newChild !== null) {\n      switch (newChild.$$typeof) {\n        case REACT_ELEMENT_TYPE: {\n          //\u91cd\u70b9: key\u7528\u4e8e\u662f\u5426\u590d\u7528\u7684\u7b2c\u4e00\u5224\u65ad\u6761\u4ef6\n          const matchedFiber =\n            existingChildren.get(\n              newChild.key === null ? newIdx : newChild.key,\n            ) || null;\n          return updateElement(returnFiber, matchedFiber, newChild, lanes);\n        }\n    }\n    return null;\n }",lang:"js"}))),a.a.createElement("p",null,"\u9488\u5bf9\u591a\u8282\u70b9\u7684",a.a.createElement("code",null,"diff\u7b97\u6cd5"),"\u53ef\u4ee5\u5206\u4e3a3\u6b65\u9aa4(\u8bf7\u56de\u987e\u7b97\u6cd5\u7ae0\u8282",a.a.createElement(r["Link"],{to:"../algorithm/diff"},"React \u7b97\u6cd5\u4e4b\u8c03\u548c\u7b97\u6cd5"),"):"),a.a.createElement("ol",null,a.a.createElement("li",null,"\u7b2c\u4e00\u6b21\u5faa\u73af: \u6bd4\u8f83\u516c\u5171\u5e8f\u5217",a.a.createElement("ul",null,a.a.createElement("li",null,"\u4ece\u5de6\u5230\u53f3\u9010\u4e00\u904d\u5386, \u9047\u5230\u4e00\u4e2a\u65e0\u6cd5\u590d\u7528\u7684\u8282\u70b9\u5219\u9000\u51fa\u5faa\u73af."))),a.a.createElement("li",null,"\u7b2c\u4e8c\u6b21\u5faa\u73af: \u6bd4\u8f83\u975e\u516c\u5171\u5e8f\u5217",a.a.createElement("ul",null,a.a.createElement("li",null,"\u5728\u7b2c\u4e00\u6b21\u5faa\u73af\u7684\u57fa\u7840\u4e0a, \u5982\u679c",a.a.createElement("code",null,"oldFiber"),"\u961f\u5217\u904d\u5386\u5b8c\u4e86, \u8bc1\u660e",a.a.createElement("code",null,"newChildren"),"\u961f\u5217\u4e2d\u5269\u4f59\u7684\u5bf9\u8c61\u5168\u90e8\u90fd\u662f\u65b0\u589e."),a.a.createElement("li",null,"\u6b64\u65f6\u7ee7\u7eed\u904d\u5386\u5269\u4f59\u7684",a.a.createElement("code",null,"newChildren"),"\u961f\u5217\u5373\u53ef, \u6ca1\u6709\u989d\u5916\u7684",a.a.createElement("code",null,"diff"),"\u6bd4\u8f83."),a.a.createElement("li",null,"\u5728\u7b2c\u4e00\u6b21\u5faa\u73af\u7684\u57fa\u7840\u4e0a, \u5982\u679c",a.a.createElement("code",null,"oldFiber"),"\u961f\u5217\u6ca1\u6709\u904d\u5386\u5b8c, \u9700\u8981\u5c06",a.a.createElement("code",null,"oldFiber"),"\u961f\u5217\u4e2d\u5269\u4f59\u7684\u5bf9\u8c61\u90fd\u6dfb\u52a0\u5230\u4e00\u4e2a",a.a.createElement("code",null,"map"),"\u96c6\u5408\u4e2d, \u4ee5",a.a.createElement("code",null,"oldFiber.key"),"\u4f5c\u4e3a\u952e."),a.a.createElement("li",null,"\u6b64\u65f6\u5219\u5728\u904d\u5386\u5269\u4f59\u7684",a.a.createElement("code",null,"newChildren"),"\u961f\u5217\u65f6, \u9700\u8981\u7528",a.a.createElement("code",null,"newChild.key"),"\u5230",a.a.createElement("code",null,"map"),"\u96c6\u5408\u4e2d\u8fdb\u884c\u67e5\u627e, \u5982\u679c\u5339\u914d\u4e0a\u4e86, \u5c31\u5c06",a.a.createElement("code",null,"oldFiber"),"\u4ece",a.a.createElement("code",null,"map"),"\u4e2d\u53d6\u51fa\u6765, \u540c",a.a.createElement("code",null,"newChild"),"\u8fdb\u884c",a.a.createElement("code",null,"diff"),"\u6bd4\u8f83."))),a.a.createElement("li",null,"\u6e05\u7406\u5de5\u4f5c",a.a.createElement("ul",null,a.a.createElement("li",null,"\u5728\u7b2c\u4e8c\u6b21\u5faa\u73af\u7ed3\u675f\u540e, \u5982\u679c",a.a.createElement("code",null,"map"),"\u96c6\u5408\u4e2d\u8fd8\u6709\u5269\u4f59\u7684",a.a.createElement("code",null,"oldFiber"),",\u5219\u53ef\u4ee5\u8bc1\u660e\u8fd9\u4e9b",a.a.createElement("code",null,"oldFiber"),"\u90fd\u662f\u88ab\u5220\u9664\u7684\u8282\u70b9, \u9700\u8981\u6253\u4e0a\u5220\u9664\u6807\u8bb0.")))),a.a.createElement("p",null,"\u901a\u8fc7\u56de\u987e",a.a.createElement("code",null,"diff\u7b97\u6cd5"),"\u7684\u539f\u7406, \u53ef\u4ee5\u5f97\u5230",a.a.createElement("code",null,"key"),"\u5728\u591a\u8282\u70b9\u60c5\u51b5\u4e0b\u7684\u7279\u6027:"),a.a.createElement("ol",null,a.a.createElement("li",null,"\u65b0\u961f\u5217",a.a.createElement("code",null,"newChildren"),"\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5bf9\u8c61(\u5373",a.a.createElement("code",null,"reactElement"),"\u5bf9\u8c61)\u90fd\u9700\u8981\u540c\u65e7\u961f\u5217",a.a.createElement("code",null,"oldFiber"),"\u4e2d\u6709\u76f8\u540c",a.a.createElement("code",null,"key"),"\u503c\u7684\u5bf9\u8c61(\u5373",a.a.createElement("code",null,"oldFiber"),"\u5bf9\u8c61)\u8fdb\u884c\u662f\u5426\u53ef\u590d\u7528\u7684\u6bd4\u8f83. ",a.a.createElement("code",null,"key"),"\u5c31\u662f\u65b0\u65e7\u5bf9\u8c61\u80fd\u591f\u5bf9\u5e94\u8d77\u6765\u7684\u552f\u4e00\u6807\u8bc6."),a.a.createElement("li",null,"\u5982\u679c\u7701\u7565",a.a.createElement("code",null,"key"),"\u6216\u8005\u76f4\u63a5\u4f7f\u7528\u5217\u8868",a.a.createElement("code",null,"index"),"\u4f5c\u4e3a",a.a.createElement("code",null,"key"),", \u8868\u73b0\u662f\u4e00\u6837\u7684(",a.a.createElement("code",null,"key=null"),"\u65f6, \u4f1a\u91c7\u7528",a.a.createElement("code",null,"index"),"\u4ee3\u66ff",a.a.createElement("code",null,"key"),"\u8fdb\u884c\u6bd4\u8f83). \u5728\u65b0\u65e7\u5bf9\u8c61\u6bd4\u8f83\u65f6, \u53ea\u80fd\u6309\u7167",a.a.createElement("code",null,"index"),"\u987a\u5e8f\u8fdb\u884c\u6bd4\u8f83, \u590d\u7528\u7684\u6210\u529f\u7387\u5927\u5927\u964d\u4f4e, \u5927\u5217\u8868\u4f1a\u51fa\u73b0\u6027\u80fd\u95ee\u9898.",a.a.createElement("ul",null,a.a.createElement("li",null,"\u4f8b\u5982\u4e00\u4e2a\u6392\u5e8f\u7684\u573a\u666f: ",a.a.createElement("code",null,"oldFiber"),"\u961f\u5217\u6709100\u4e2a, ",a.a.createElement("code",null,"newChildren"),"\u961f\u5217\u6709100\u4e2a(\u4f46\u662f\u6253\u4e71\u4e86\u987a\u5e8f). \u7531\u4e8e\u6ca1\u6709\u8bbe\u7f6e",a.a.createElement("code",null,"key"),", \u5c31\u4f1a\u5bfc\u81f4",a.a.createElement("code",null,"newChildren"),"\u4e2d\u7684\u7b2cn\u4e2a\u5fc5\u7136\u8981\u548c",a.a.createElement("code",null,"oldFiber"),"\u961f\u5217\u4e2d\u7684\u7b2cn\u4e2a\u8fdb\u884c\u6bd4\u8f83, \u8fd9\u65f6\u5b83\u4eec\u7684",a.a.createElement("code",null,"key"),"\u5b8c\u5168\u4e00\u81f4(\u90fd\u662f",a.a.createElement("code",null,"null"),"), \u7531\u4e8e\u987a\u5e8f\u53d8\u4e86\u5bfc\u81f4",a.a.createElement("code",null,"props"),"\u4e0d\u540c, \u6240\u4ee5\u65b0\u7684",a.a.createElement("code",null,"fiber"),"\u5b8c\u5168\u8981\u8d70\u66f4\u65b0\u903b\u8f91(\u7406\u8bba\u4e0a\u6bd4\u65b0\u521b\u5efa\u4e00\u4e2a\u7684\u6027\u80fd\u8fd8\u8981\u8017)."),a.a.createElement("li",null,"\u540c\u6837\u662f\u6392\u5e8f\u573a\u666f\u53ef\u4ee5\u51fa\u73b0\u7684bug: \u4e0a\u9762\u7684\u573a\u666f\u53ea\u662f\u6027\u80fd\u5dee(\u53c8\u4e0d\u662f\u4e0d\u80fd\u7528), ",a.a.createElement("code",null,"key"),"\u4f7f\u7528\u4e0d\u5f53\u8fd8\u4f1a\u9020\u6210",a.a.createElement("code",null,"bug")),a.a.createElement("li",null,"\u8fd8\u662f\u4e0a\u8ff0\u6392\u5e8f\u573a\u666f, \u53ea\u662f\u5217\u8868\u4e2d\u7684\u6bcf\u4e00\u4e2a",a.a.createElement("code",null,"item"),"\u5185\u90e8\u53c8\u662f\u4e00\u4e2a\u7ec4\u4ef6, \u4e14\u5176\u4e2d\u67d0\u4e00\u4e2a",a.a.createElement("code",null,"item"),"\u4f7f\u7528\u4e86\u5c40\u90e8\u72b6\u6001(\u6bd4\u5982",a.a.createElement("code",null,"class\u7ec4\u4ef6"),"\u91cc\u9762\u7684",a.a.createElement("code",null,"state"),"). \u5f53\u7b2c\u4e8c\u6b21",a.a.createElement("code",null,"render"),"\u65f6, ",a.a.createElement("code",null,"fiber"),"\u5bf9\u8c61\u4e0d\u4f1a",a.a.createElement("code",null,"delete"),"\u53ea\u4f1a",a.a.createElement("code",null,"update"),"\u5bfc\u81f4\u65b0\u7ec4\u4ef6\u7684",a.a.createElement("code",null,"state"),"\u8fd8\u6cbf\u7528\u4e86\u4e0a\u4e00\u6b21\u76f8\u540c\u4f4d\u7f6e\u7684\u65e7\u7ec4\u4ef6\u7684",a.a.createElement("code",null,"state"),", \u9020\u6210\u4e86\u72b6\u6001\u6df7\u4e71.")))),a.a.createElement("h2",{id:"\u603b\u7ed3"},a.a.createElement(r["AnchorLink"],{to:"#\u603b\u7ed3","aria-hidden":"true",tabIndex:-1},a.a.createElement("span",{className:"icon icon-link"})),"\u603b\u7ed3"),a.a.createElement("p",null,"\u5728",a.a.createElement("code",null,"react"),"\u4e2d",a.a.createElement("code",null,"key"),"\u662f\u670d\u52a1\u4e8e",a.a.createElement("code",null,"diff\u7b97\u6cd5"),", \u5b83\u7684\u9ed8\u8ba4\u503c\u662f",a.a.createElement("code",null,"null"),", \u5728",a.a.createElement("code",null,"diff\u7b97\u6cd5"),"\u8fc7\u7a0b\u4e2d, \u65b0\u65e7\u8282\u70b9\u662f\u5426\u53ef\u4ee5\u590d\u7528, \u9996\u5148\u5c31\u4f1a\u5224\u5b9a",a.a.createElement("code",null,"key"),"\u662f\u5426\u76f8\u540c, \u5176\u540e\u624d\u4f1a\u8fdb\u884c\u5176\u4ed6\u6761\u4ef6\u7684\u5224\u5b9a. \u5728\u6e90\u7801\u4e2d, \u9488\u5bf9\u591a\u8282\u70b9(\u5373\u5217\u8868\u7ec4\u4ef6)\u5982\u679c\u76f4\u63a5\u5c06",a.a.createElement("code",null,"key"),"\u8bbe\u7f6e\u6210",a.a.createElement("code",null,"index"),"\u548c\u4e0d\u8bbe\u7f6e\u4efb\u4f55\u503c\u7684\u5904\u7406\u65b9\u6848\u662f\u4e00\u6837\u7684, \u5982\u679c\u4f7f\u7528\u4e0d\u5f53, \u8f7b\u5219\u9020\u6210\u6027\u80fd\u635f\u8017, \u91cd\u5219\u5f15\u8d77\u72b6\u6001\u6df7\u4e71\u9020\u6210bug.")))}));n["default"]=e=>{var n=a.a.useContext(r["context"]),l=n.demos;return a.a.useEffect((()=>{var n;null!==e&&void 0!==e&&null!==(n=e.location)&&void 0!==n&&n.hash&&r["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),a.a.createElement(i,{demos:l})}}}]);