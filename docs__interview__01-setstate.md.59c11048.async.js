(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[10],{MZF8:function(e,t,n){"use strict";var a=n("ogwx");n.d(t,"a",(function(){return a["b"]}));n("VCU9")},v9v0:function(e,t,n){"use strict";n.r(t);var a=n("q1tI"),l=n.n(a),r=n("dEAq"),o=n("Zxc8"),i=n("H1Ra"),c=l.a.memo((e=>{var t=e.demos,n=t["01-setstate-demo"].component;return l.a.createElement(l.a.Fragment,null,l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"markdown"},l.a.createElement("h1",{id:"react-\u4e2d-setstate-\u662f\u540c\u6b65\u8fd8\u662f\u5f02\u6b65"},l.a.createElement(r["AnchorLink"],{to:"#react-\u4e2d-setstate-\u662f\u540c\u6b65\u8fd8\u662f\u5f02\u6b65","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"React \u4e2d, setState \u662f\u540c\u6b65\u8fd8\u662f\u5f02\u6b65"),l.a.createElement("p",null,"\u6240\u8c13\u540c\u6b65\u8fd8\u662f\u5f02\u6b65\u6307\u7684\u662f\u8c03\u7528 setState \u4e4b\u540e\u662f\u5426\u9a6c\u4e0a\u80fd\u5f97\u5230\u6700\u65b0\u7684 state"),l.a.createElement("p",null,"\u4e0d\u4ec5\u4ec5\u662f",l.a.createElement("code",null,"setState"),"\u4e86, \u5728\u5bf9 function \u7c7b\u578b\u7ec4\u4ef6\u4e2d\u7684 hook \u8fdb\u884c\u64cd\u4f5c\u65f6\u4e5f\u662f\u4e00\u6837, \u6700\u7ec8\u51b3\u5b9a",l.a.createElement("code",null,"setState"),"\u662f\u540c\u6b65\u6e32\u67d3\u8fd8\u662f\u5f02\u6b65\u6e32\u67d3\u7684\u5173\u952e\u56e0\u7d20\u662f",l.a.createElement("code",null,"ReactFiberWorkLoop"),"\u5de5\u4f5c\u7a7a\u95f4\u7684\u6267\u884c\u4e0a\u4e0b\u6587."),l.a.createElement("p",null,"\u5177\u4f53\u4ee3\u7801\u5982\u4e0b:"),l.a.createElement(i["a"],{code:"export function scheduleUpdateOnFiber(\n  fiber: Fiber,\n  expirationTime: ExpirationTime,\n) {\n  const priorityLevel = getCurrentPriorityLevel();\n\n  if (expirationTime === Sync) {\n    if (\n      // Check if we're inside unbatchedUpdates\n      (executionContext & LegacyUnbatchedContext) !== NoContext &&\n      // Check if we're not already rendering\n      (executionContext & (RenderContext | CommitContext)) === NoContext\n    ) {\n      performSyncWorkOnRoot(root);\n    } else {\n      ensureRootIsScheduled(root);\n      schedulePendingInteractions(root, expirationTime);\n      if (executionContext === NoContext) {\n        // Flush the synchronous work now, unless we're already working or inside\n        // a batch. This is intentionally inside scheduleUpdateOnFiber instead of\n        // scheduleCallbackForFiber to preserve the ability to schedule a callback\n        // without immediately flushing it. We only do this for user-initiated\n        // updates, to preserve historical behavior of legacy mode.\n        flushSyncCallbackQueue();\n      }\n    }\n  } else {\n    // Schedule a discrete update but only if it's not Sync.\n    if (\n      (executionContext & DiscreteEventContext) !== NoContext &&\n      // Only updates at user-blocking priority or greater are considered\n      // discrete, even inside a discrete event.\n      (priorityLevel === UserBlockingPriority ||\n        priorityLevel === ImmediatePriority)\n    ) {\n      // This is the result of a discrete event. Track the lowest priority\n      // discrete update per root so we can flush them early, if needed.\n      if (rootsWithPendingDiscreteUpdates === null) {\n        rootsWithPendingDiscreteUpdates = new Map([[root, expirationTime]]);\n      } else {\n        const lastDiscreteTime = rootsWithPendingDiscreteUpdates.get(root);\n        if (\n          lastDiscreteTime === undefined ||\n          lastDiscreteTime > expirationTime\n        ) {\n          rootsWithPendingDiscreteUpdates.set(root, expirationTime);\n        }\n      }\n    }\n    // Schedule other updates after in case the callback is sync.\n    ensureRootIsScheduled(root);\n    schedulePendingInteractions(root, expirationTime);\n  }\n}",lang:"js"}),l.a.createElement("p",null,"\u53ef\u4ee5\u770b\u5230, \u662f\u5426\u540c\u6b65\u6e32\u67d3\u8c03\u5ea6\u51b3\u5b9a\u4ee3\u7801\u662f",l.a.createElement("code",null,"flushSyncCallbackQueue()"),". \u8fdb\u5165\u8be5\u5206\u652f\u7684\u6761\u4ef6:"),l.a.createElement("ol",null,l.a.createElement("li",null,"\u5fc5\u987b\u662f",l.a.createElement("code",null,"legacy\u6a21\u5f0f"),", ",l.a.createElement("code",null,"concurrent"),"\u6a21\u5f0f\u4e0b",l.a.createElement("code",null,"expirationTime"),"\u4e0d\u4f1a\u4e3a",l.a.createElement("code",null,"Sync")),l.a.createElement("li",null,l.a.createElement("code",null,"executionContext === NoContext"),", \u6267\u884c\u4e0a\u4e0b\u6587\u5fc5\u987b\u8981\u4e3a\u7a7a.")),l.a.createElement("p",null,"\u4e24\u4e2a\u6761\u4ef6\u7f3a\u4e00\u4e0d\u53ef."),l.a.createElement("h2",{id:"\u7ed3\u8bba"},l.a.createElement(r["AnchorLink"],{to:"#\u7ed3\u8bba","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u7ed3\u8bba"),l.a.createElement("p",null,"\u540c\u6b65:"),l.a.createElement("ol",null,l.a.createElement("li",null,"\u9996\u5148\u5728",l.a.createElement("code",null,"legacy\u6a21\u5f0f"),"\u4e0b"),l.a.createElement("li",null,"\u5728\u6267\u884c\u4e0a\u4e0b\u6587\u4e3a\u7a7a\u7684\u65f6\u5019\u53bb\u8c03\u7528",l.a.createElement("code",null,"setState"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u53ef\u4ee5\u4f7f\u7528\u5f02\u6b65\u8c03\u7528\u5982",l.a.createElement("code",null,"setTimeout"),", ",l.a.createElement("code",null,"Promise"),", ",l.a.createElement("code",null,"MessageChannel"),"\u7b49"),l.a.createElement("li",null,"\u53ef\u4ee5\u76d1\u542c\u539f\u751f\u4e8b\u4ef6, \u6ce8\u610f\u4e0d\u662f\u5408\u6210\u4e8b\u4ef6, \u5728\u539f\u751f\u4e8b\u4ef6\u7684\u56de\u8c03\u51fd\u6570\u4e2d\u6267\u884c setState \u5c31\u662f\u540c\u6b65\u7684")))),l.a.createElement("p",null,"\u5f02\u6b65:"),l.a.createElement("ol",null,l.a.createElement("li",null,"\u5982\u679c\u662f\u5408\u6210\u4e8b\u4ef6\u4e2d\u7684\u56de\u8c03, ",l.a.createElement("code",null,"executionContext |= DiscreteEventContext"),", \u6240\u4ee5\u4e0d\u4f1a\u8fdb\u5165, \u6700\u7ec8\u8868\u73b0\u51fa\u5f02\u6b65"),l.a.createElement("li",null,"concurrent \u6a21\u5f0f\u4e0b\u90fd\u4e3a\u5f02\u6b65")),l.a.createElement("h2",{id:"\u6f14\u793a\u793a\u4f8b"},l.a.createElement(r["AnchorLink"],{to:"#\u6f14\u793a\u793a\u4f8b","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u6f14\u793a\u793a\u4f8b")),l.a.createElement(o["default"],t["01-setstate-demo"].previewerProps,l.a.createElement(n,null)),l.a.createElement("div",{className:"markdown"},l.a.createElement("p",null,"\u5728\u770b\u4e00\u4e2a concurrent \u6a21\u5f0f\u4e0b\u7684\u4f8b\u5b50, \u76f8\u540c\u7684\u4ee3\u7801\u90fd\u4e3a\u5f02\u6b65 render:"),l.a.createElement("p",null,l.a.createElement(r["Link"],{to:"https://codesandbox.io/s/boring-faraday-m7jtx?fontsize=14&hidenavigation=1&theme=dark"},l.a.createElement("img",{src:"https://codesandbox.io/static/img/play-codesandbox.svg",alt:"Edit boring-faraday-m7jtx"}))))))}));t["default"]=e=>{var t=l.a.useContext(r["context"]),n=t.demos;return l.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&r["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),l.a.createElement(c,{demos:n})}}}]);